<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">åŸ‹ç‚¹ | å­¦ä¹ ç¬”è®°</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/festudy/blog/monitor"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="åŸ‹ç‚¹ | å­¦ä¹ ç¬”è®°"><meta data-rh="true" name="description" content="monitor"><meta data-rh="true" property="og:description" content="monitor"><meta data-rh="true" property="og:image" content="https://i.imgur.com/mErPwqL.png"><meta data-rh="true" name="twitter:image" content="https://i.imgur.com/mErPwqL.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-10-20T11:16:01.000Z"><meta data-rh="true" property="article:author" content="https://github.com/chovrio"><meta data-rh="true" property="article:tag" content="cli"><link data-rh="true" rel="icon" href="/festudy/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/festudy/blog/monitor"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/festudy/blog/monitor" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/festudy/blog/monitor" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/festudy/blog/rss.xml" title="å­¦ä¹ ç¬”è®° RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/festudy/blog/atom.xml" title="å­¦ä¹ ç¬”è®° Atom Feed"><link rel="stylesheet" href="/festudy/assets/css/styles.0ceaaa7e.css">
<link rel="preload" href="/festudy/assets/js/runtime~main.75b24d9c.js" as="script">
<link rel="preload" href="/festudy/assets/js/main.90c4655c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/festudy/"><div class="navbar__logo"><img src="/festudy/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/festudy/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">æ‚ä¸ƒæ‚å…«</b></a><a class="navbar__item navbar__link" href="/festudy/docs/å‰è¨€">å­¦ä¹ ç¬”è®°</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/festudy/blog">åšå®¢æ–‡ç« </a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/chovrio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/festudy/blog/vue">Vueæºç è§£è¯»â€”â€”createApp</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/festudy/blog/httpåè®®">HTTPåè®®</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/festudy/blog/github action ci">ä¸€ä¸ªç®€å•çš„ Github Action ä½¿ç”¨æ•™ç¨‹</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/festudy/blog/cli">ä»é›¶å¼€å‘ä¸€æ¬¾è‡ªå·±çš„è„šæ‰‹æ¶</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/festudy/blog/monitor">åŸ‹ç‚¹</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://i.imgur.com/mErPwqL.png"><header><h1 class="title_f1Hy" itemprop="headline">åŸ‹ç‚¹</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-10-20T11:16:01.000Z" itemprop="datePublished">October 20, 2023</time> Â· <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/chovrio" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/chovrio.png" alt="chovrio"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/chovrio" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">chovrio</span></a></div><small class="avatar__subtitle" itemprop="description">æ— </small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å‰è¨€">å‰è¨€<a href="#å‰è¨€" class="hash-link" aria-label="Direct link to å‰è¨€" title="Direct link to å‰è¨€">â€‹</a></h2><p>ä»¥å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œæ‰‹å†™åŸ‹ç‚¹ sdk åŒ…ã€‚æœ€è¿‘å¶å°”å‘ç°è¿˜æœ‰äººåœ¨æ”¶è—ï¼Œä»”ç»†æƒ³æƒ³å¾ˆè´§ä¸å¯¹æ¿ï¼Œæ–‡ç« å¯¹åŸ‹ç‚¹çš„æå†™å¾ˆæµ…ï¼Œä¹Ÿåªæœ‰å‡ ç§åœºæ™¯çš„å¤„ç†ã€‚å¤§éƒ¨åˆ†å…¶å®æ˜¯è‡ªå·±å¯¹å‰ç«¯å·¥ç¨‹åŒ–çš„ä¸€ç§åº”ç”¨ï¼Œæœ€è¿‘åˆæ‚Ÿäº†ï¼Œå‡†å¤‡é›†æ€å¹¿ç›Š(å„æ–¹å‚è€ƒ)ï¼Œè¯•ç€æ­å»ºä¸€ä¸ªçœŸæ­£çš„åŸ‹ç‚¹ç³»ç»Ÿã€‚æŒ‰é“ç†æ¥è¯´åº”è¯¥å…ˆæŠŠè‡ªå·±è„‘æµ·ä¸­çš„æ•´ä½“æ„æ€ç”»ä¸‹æ¥ï¼Œä½†æ˜¯æˆ‘å¹¶ä¸ç¡®å®šè¿™ä¸ªé¡¹ç›®åšåˆ°æœ€åæ˜¯ä»€ä¹ˆæ ·å­(å¹³æ—¶è‡ªå·±å†™ä¸œè¥¿æ€»æ˜¯å¾ˆå‘æ•£)ï¼Œä¹Ÿä¸ç¡®å®šå®ƒæœ€åèƒ½ä¸èƒ½ &quot;ç«£å·¥&quot;ï¼Œå°±æ‰“ç®—åšåˆ°å“ªå„¿å†™åˆ°å“ªå„¿äº†ã€‚</p><p>å¤§éƒ¨åˆ†å†…å®¹æ˜¯ lib åŒ…ï¼Œå› ä¸º client å’Œ server æ„Ÿè§‰æ²¡æœ‰å¤ªå¤§ä»·å€¼ï¼Œclient åªæ˜¯ä¸€ä¸ªåå°ç³»ç»Ÿæ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œserver æˆ‘è‡ªå·±å†™çš„éƒ½ä¸€å¨ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚ä¸è¿‡ä¼šå¯¹æ•´ä¸ªé¡¹ç›®åšä¸€äº›ä¼˜åŒ–ã€‚</p><p>æƒ³åšä¸€ä¸ªæ— ä¾µå…¥çš„åŸ‹ç‚¹(å¯¹ç”¨æˆ·)ï¼Œæœ‰ä¾µå…¥(å¯¹å¼€å‘)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¼€å‘è¿›ç¨‹">å¼€å‘è¿›ç¨‹<a href="#å¼€å‘è¿›ç¨‹" class="hash-link" aria-label="Direct link to å¼€å‘è¿›ç¨‹" title="Direct link to å¼€å‘è¿›ç¨‹">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1ç›‘å¬æµè§ˆå™¨-load-è¡Œä¸ºä¸ŠæŠ¥åŸºæœ¬æ•°æ®">1.ç›‘å¬æµè§ˆå™¨ load è¡Œä¸ºï¼Œä¸ŠæŠ¥åŸºæœ¬æ•°æ®<a href="#1ç›‘å¬æµè§ˆå™¨-load-è¡Œä¸ºä¸ŠæŠ¥åŸºæœ¬æ•°æ®" class="hash-link" aria-label="Direct link to 1.ç›‘å¬æµè§ˆå™¨ load è¡Œä¸ºï¼Œä¸ŠæŠ¥åŸºæœ¬æ•°æ®" title="Direct link to 1.ç›‘å¬æµè§ˆå™¨ load è¡Œä¸ºï¼Œä¸ŠæŠ¥åŸºæœ¬æ•°æ®">â€‹</a></h3><p>ä¸‹é¢ä»£ç å¤§ä½“æ€è·¯æ¥è‡ª<code>ç®€ä¹¦</code>ï¼Œåœ¨çœ‹ä»£ç ä¹‹å‰æˆ‘ä»¬å…ˆæ¥ç®€å•è¯´è¯´ä¸¤ä¸ªä¸œè¥¿</p><ol><li><code>load</code> å’Œ <code>DOMContentLoaded</code></li></ol><blockquote><p>DOMContentLoaded:å½“ HTML æ–‡æ¡£å®Œå…¨è§£æï¼Œä¸”æ‰€æœ‰å»¶è¿Ÿè„šæœ¬ä¸‹è½½å’Œæ‰§è¡Œå®Œæ¯•åï¼Œä¼šè§¦å‘ DOMContentLoaded äº‹ä»¶ã€‚å®ƒä¸ä¼šç­‰å¾…å›¾ç‰‡ã€å­æ¡†æ¶å’Œå¼‚æ­¥è„šæœ¬ç­‰å…¶ä»–å†…å®¹å®ŒæˆåŠ è½½ã€‚
load: åœ¨æ•´ä¸ªé¡µé¢åŠæ‰€æœ‰ä¾èµ–èµ„æºå¦‚æ ·å¼è¡¨å’Œå›¾ç‰‡éƒ½å·²å®ŒæˆåŠ è½½æ—¶è§¦å‘</p></blockquote><ol start="2"><li>performance</li></ol><blockquote><p>ç”¨äºè·å–åˆ°å½“å‰é¡µé¢ä¸­ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ æ¯”å¦‚ä¸€äº›æ—¶é—´ï¼Œèµ„æºåŠ è½½æƒ…å†µç­‰ç­‰</p></blockquote><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;load&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PerformanceObserver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> entries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEntriesByType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;navigation&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> navigationEntry </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> entries</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">navigationEntry </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">PerformanceNavigationTiming</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> navigationEntry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\u7f51\u9875\u91cd\u5b9a\u5411\u7684\u8017\u65f6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">redirectEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">redirectStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AppCache&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\u68c0\u67e5\u672c\u5730\u7f13\u5b58\u7684\u8017\u65f6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">domainLookupStart </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fetchStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;DNS&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;DNS\u67e5\u8be2\u7684\u8017\u65f6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">domainLookupEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">domainLookupStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;TCP&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;TCP\u8fde\u63a5\u7684\u8017\u65f6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connectEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connectStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Waiting(TTFB)&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\u4ece\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u5230\u63a5\u6536\u5230\u54cd\u5e94\u7684\u65f6\u95f4 / Time To First Byte&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseStart </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">requestStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Content Download&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\u4e0b\u8f7d\u670d\u52a1\u7aef\u8fd4\u56de\u6570\u636e\u7684\u65f6\u95f4&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;HTTP Total Time&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http\u8bf7\u6c42\u603b\u8017\u65f6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">requestStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;DOMContentLoaded&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dom\u52a0\u8f7d\u5b8c\u6210\u7684\u65f6\u95f4&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">domContentLoadedEventEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Loaded&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          desc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\u9875\u9762load\u7684\u603b\u8017\u65f6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loadEventEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// åªå¯¹25%çš„ç”¨æˆ·è¿›è¡Œä¸ŠæŠ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.75</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">href</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          u </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userAgent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;?&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">tracker</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">BASE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/data</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          app</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;shakespeare-performance&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ua</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> u</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          stats_ttfb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseStart </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">requestStart</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          stats_domLoaded</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">domContentLoadedEventEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          stats_loaded</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loadEventEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin">console</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> entryTypes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;navigation&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨åˆ°çš„ä¸€äº›æ—¶é—´</p><blockquote><p>Redirect(ç½‘é¡µé‡å®šå‘è€—æ—¶) = redirectEnd(é‡å®šå‘ç»“æŸæ—¶é—´) - redirectStart(é‡å®šå‘å¼€å§‹æ—¶é—´)</p></blockquote><blockquote><p>AppCache(æ£€æŸ¥æœ¬åœ°ç¼“å­˜çš„è€—æ—¶) = domainLookupStart(åŸŸåå¼€å§‹è§£æçš„æ—¶é—´) - fetchStart(æµè§ˆå™¨å·²ç»å‡†å¤‡å¥½å»ä½¿ç”¨ HTTP è¯·æ±‚æŠ“å–æ–‡æ¡£çš„æ—¶é—´)</p></blockquote><blockquote><p>DNS(DNS æŸ¥è¯¢çš„è€—æ—¶) = domainLookupEnd(è§£æåŸŸåç»“æŸçš„æ—¶é—´) - domainLookupStart(åŸŸåå¼€å§‹è§£æçš„æ—¶é—´)</p></blockquote><blockquote><p>TCP(TCP è¿æ¥çš„è€—æ—¶) = connectEnd(ç½‘ç»œé“¾æ¥å»ºç«‹çš„æ—¶é—´èŠ‚ç‚¹) - connectStart(è¯·æ±‚è¿æ¥è¢«å‘é€åˆ°ç½‘ç»œçš„æ—¶é—´)</p></blockquote><blockquote><p>Waiting(TTFB)(ä»å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åˆ°æ¥æ”¶åˆ°å“åº”çš„æ—¶é—´ / Time To First Byte) = responseStart(æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´) - requestStart(è¯·æ±‚å¼€å§‹çš„æ—¶é—´)</p></blockquote><blockquote><p>Content Download(ä¸‹è½½æœåŠ¡ç«¯è¿”å›æ•°æ®çš„æ—¶é—´) = responseEnd(æ¥æ”¶åˆ°æœ€åä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´) - responseStart(æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´)</p></blockquote><blockquote><p>HTTP Total Time(http è¯·æ±‚æ€»è€—æ—¶) = responseEnd(æ¥æ”¶åˆ°æœ€åä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´) - requestStart(è¯·æ±‚å¼€å§‹çš„æ—¶é—´)</p></blockquote><blockquote><p>DOMContentLoaded(DOM åŠ è½½å®Œæˆçš„æ—¶é—´) = domContentLoadedEventEnd(DOMContentLoaded äº‹ä»¶ç»“æŸçš„æ—¶é—´) - navigationStart(å¼€å§‹å¯¼èˆªçš„æ—¶é—´)</p></blockquote><blockquote><p>Loaded(load äº‹ä»¶ç»“æŸçš„æ—¶é—´) = loadEventEnd(load äº‹ä»¶ç»“æŸçš„æ—¶é—´) - navigationStart(å¼€å§‹å¯¼èˆªçš„æ—¶é—´)</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2å¼‚å¸¸æ•è·çš„æ–¹æ³•">2.å¼‚å¸¸æ•è·çš„æ–¹æ³•<a href="#2å¼‚å¸¸æ•è·çš„æ–¹æ³•" class="hash-link" aria-label="Direct link to 2.å¼‚å¸¸æ•è·çš„æ–¹æ³•" title="Direct link to 2.å¼‚å¸¸æ•è·çš„æ–¹æ³•">â€‹</a></h3><p><a href="https://juejin.cn/post/7172072612430872584#heading-11" target="_blank" rel="noopener noreferrer">æœ‰æ‰€å‚è€ƒçš„å¥½æ–‡</a></p><p>å…·ä½“çš„ä¾‹å­å°±ä¸ä¸¾äº†ï¼Œåªæ˜¯æƒ³è®°å½•ä¸‹èƒ½æ€ä¹ˆä½¿ç”¨ï¼Œä»¥ä¸‹æ‰€æœ‰ç»“è®ºæ¥è‡ª vite + react ç¯å¢ƒï¼Œvue æš‚ä¸è€ƒè™‘æµ‹è¯•(ä¸æ˜¯ vue ä¸å¥½ç”¨ï¼Œåªæ˜¯æˆ‘æ‡’ ğŸ˜ª ç›´æ¥ç”¨åå°é¡¹ç›®æµ‹è¯•çš„)</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-trycatch">2.1 try/catch<a href="#21-trycatch" class="hash-link" aria-label="Direct link to 2.1 try/catch" title="Direct link to 2.1 try/catch">â€‹</a></h4><ul><li>å¯ä»¥æ•è·å¸¸è§„è¿è¡Œçš„é”™è¯¯</li><li>ä¸å¯ä»¥æ•è·è¯­æ³•é”™è¯¯</li><li>ä¸å¯ä»¥æ•è·å¼‚æ­¥é”™è¯¯</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-windowonerror">2.2 window.onerror<a href="#22-windowonerror" class="hash-link" aria-label="Direct link to 2.2 window.onerror" title="Direct link to 2.2 window.onerror">â€‹</a></h4><ul><li>å¯ä»¥æ•è·å¸¸è§„é”™è¯¯</li><li>å¯ä»¥æ•è·å¼‚å¸¸é”™è¯¯</li><li>ä¸å¯ä»¥æ•è·èµ„æºé”™è¯¯</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="23-windowaddeventlistener-æ³¨æ„å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º-trueæ•è·">2.3 window.addEventListener æ³¨æ„å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true(æ•è·)<a href="#23-windowaddeventlistener-æ³¨æ„å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º-trueæ•è·" class="hash-link" aria-label="Direct link to 2.3 window.addEventListener æ³¨æ„å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true(æ•è·)" title="Direct link to 2.3 window.addEventListener æ³¨æ„å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true(æ•è·)">â€‹</a></h4><p><code>error</code>ï¼šæ•è·ä¸€èˆ¬é”™è¯¯</p><ul><li>å¯ä»¥æ•è·èµ„æºé”™è¯¯</li><li>å¯ä»¥æ•è·å¸¸è§„é”™è¯¯</li><li>ä¸å¯ä»¥æ•è·è¯­æ³•é”™è¯¯</li><li>ä¸å¯ä»¥æ•è·å¼‚æ­¥é”™è¯¯</li><li>å¯ä»¥æ•è· react ç»„ä»¶å†…æŠ›å‡ºçš„é”™è¯¯é”™è¯¯(vite dev æˆ–è®¸å‡½æ•°ç»„ä»¶çš„åŸå› ?)</li><li>å¯¹äº script æ ‡ç­¾å‡ºç°çš„èµ„æºé”™è¯¯æ— æ³•æ•è·(åŠ¨æ€æ·»åŠ çš„æƒ…å†µ)ï¼Œå¦‚æœæ˜¯é¦–å± js å‡ºé”™çš„è¯å¯ä»¥æ•è·ï¼Œ</li><li>å¯¹äºåŠ¨æ€ link å’Œ img æ ‡ç­¾çš„èµ„æºé—®é¢˜éƒ½å¯ä»¥æ•è·</li></ul><p><code>unhandledrejection</code>ï¼šæ•è· promise å¼‚å¸¸</p><ul><li>å¯ä»¥æ•è· promise å¼‚å¸¸</li><li>ä¸å¯ä»¥æ•è·å¸¸è§„é”™è¯¯</li><li>ä¸å¯ä»¥æ•è·è¯­æ³•é”™è¯¯</li><li>å¯ä»¥æ•è· xhr ã€fetch å¼‚å¸¸</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3è·¯ç”±ä¸ŠæŠ¥">3.è·¯ç”±ä¸ŠæŠ¥<a href="#3è·¯ç”±ä¸ŠæŠ¥" class="hash-link" aria-label="Direct link to 3.è·¯ç”±ä¸ŠæŠ¥" title="Direct link to 3.è·¯ç”±ä¸ŠæŠ¥">â€‹</a></h3><p>ä¸€èˆ¬æ¥è¯´è·¯ç”±åˆ†ä¸ºä¸¤ç§<code>å“ˆå¸Œè·¯ç”±</code>å’Œ<code>æ™®é€š(æµè§ˆå™¨)è·¯ç”±</code>ï¼Œè¿™é‡Œæˆ‘ä»¬åªè€ƒè™‘ react è·¯ç”±ç¯å¢ƒï¼Œå¦‚æœå¯¹æ™®é€šè·¯ç”±ç›‘å¬æ„Ÿå…´è¶£çš„å¯ä»¥ä»¥å‰çš„<a href="https://juejin.cn/post/7198910507515035707" target="_blank" rel="noopener noreferrer">æ°´æ–‡</a></p><p>ä½†æ˜¯æ€è·¯ä¸Šéƒ½æ˜¯å¤§å·®ä¸å·®çš„ï¼Œéƒ½éœ€è¦æ”¹å†™ <code>histroy</code> åŸç”Ÿå‡½æ•°ï¼Œæ´¾å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œ<code>react router</code> åº•å±‚ä¹Ÿæ˜¯è¿™æ ·å®ç°çš„</p><p>ä½†æ˜¯æˆ‘ä»¬ç”¨äº†æ¡†æ¶è·¯ç”±æ¯”å¦‚<code>react</code>æˆ–è€…<code>vue</code>çš„ä»–ä»¬éƒ½æœ‰è‡ªå·±çš„è·¯ç”±ç›‘å¬ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è·¯ç”±ç›‘å¬çš„å›è°ƒä¸­ä¸ŠæŠ¥æ•°æ®ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™æ ·ç¨å¾®æœ‰ç‚¹éº»çƒ¦ã€‚å½“ç„¶å¦‚æœæ˜¯æ•´ä¸ªç³»ç»Ÿååˆ†å®Œå–„çš„æƒ…å†µä¸‹ï¼Œå°è£…æˆä¸€ä¸ªå†…éƒ¨çš„ hooks åº“çš„è¯å°±éå¸¸é¦™äº†ã€‚</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> useEffect </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> useHistory </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react-router-dom&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tracker </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;../lib/tracker&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRouteTracker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> history </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useHistory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tracker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;page&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> location</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        referrer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">referrer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å› ä¸º <code>react-router-dom</code> åº•å±‚ä¹Ÿæ˜¯æ”¹å†™çš„æµè§ˆå™¨æœ¬èº«çš„ apiï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åŸ‹ç‚¹çš„é€»è¾‘é‡Œé¢ç›´æ¥ä¿®æ”¹çš„è¯ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬é‡å†™äº†æµè§ˆå™¨åŸæœ¬çš„<code>history</code>ä¸Šçš„ä¸¤ä¸ªå‡½æ•°<code>pushState</code>å’Œ<code>replaceState</code>,ä½¿ç”¨ <code>react-router-dom</code> æ—¶å®ƒå»è°ƒç”¨è¿™ä¸ªä¸¤ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå‡½æ•°çš„é€»è¾‘å’Œå®ƒæœ¬èº«åšçš„å¤„ç†ä¸ä¸€æ ·äº†ï¼Œå¯¼è‡´æ•´ä¸ªé¡µé¢å´©æºƒã€‚</p><p>å¥½åƒæœ‰ç‚¹ç©ºæ´ï¼Œä½†åˆæ‰¾ä¸åˆ°ä»€ä¹ˆå¥½çš„ä¾‹å­ï¼Œ(çœ‹çœ‹æ˜å¤©æœ‰æ²¡æœ‰æ—¶é—´çœ‹çœ‹æºç é€»è¾‘å§ ğŸ˜¥)</p><p>è¿™æ˜¯ä¸€ç§ <code>AOP(åˆ‡ç‰‡)</code> ç¼–ç¨‹æ€æƒ³ï¼Œåœ¨ <code>vue 2.x</code> è¿˜åœ¨é‡‡ç”¨ Object.defineProperty çš„æ—¶å€™ï¼Œæ•°ç»„èº«ä¸Šçš„ä¸€äº›æ–¹æ³•è°ƒç”¨(splice,unshift,push...)åï¼Œæ–°å¢æ•°æ®æ˜¯ä¸å¸¦æœ‰å“åº”å¼çš„ï¼Œå°±æ˜¯é‡‡ç”¨ <code>AOP</code> çš„æ€æƒ³é‡å†™äº†é‚£äº›æ–¹æ³•ã€‚</p><p>å› ä¸ºæˆ‘æƒ³åšçš„æ˜¯åŸ‹ç‚¹é€»è¾‘å°½å¯èƒ½å°‘çš„ä¾µå…¥ä»£ç ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è¿›è¡Œæ‰‹åŠ¨çš„åŸ‹ç‚¹ä¸ŠæŠ¥ï¼Œæ‰€ä»¥æˆ‘åœ¨å…¨å±€æŒ‚è½½äº† <a href="https://github.com/chovrio/monitor/blob/main/packages/lib/src/core/index.ts#L44" target="_blank" rel="noopener noreferrer">tracker</a> å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ post æ–¹æ³•è¿›è¡Œä¸ŠæŠ¥ã€‚</p><p>æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬åŒæ ·åœ¨å…¨å±€çš„ <code>window</code> ä¸ŠæŒ‚è½½ä¸€ä¸ªå‡½æ•°ç”¨æ¥æ”¹å†™ <code>react-router-dom</code> æ”¹å†™åçš„å‡½æ•°(å› ä¸ºæˆ‘ä»¬æ”¹å†™çš„é€»è¾‘éå¸¸ç®€å•ï¼Œä¸ä¼šå½±å“åˆ° react çš„å†…éƒ¨æ‰§è¡Œçš„)ï¼Œç„¶ååœ¨ <code>routerç»„ä»¶(hash browser)</code> ä¸‹çš„ç¬¬ä¸€ä¸ªç»„ä»¶çš„<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è·¯ç”±æ”¹å˜çš„æ—¶å€™è¿›è¡Œä¸ŠæŠ¥äº†(react)ã€‚åŸç”Ÿè·¯ç”±åœ¨ä½ çš„ç¬¬ä¸€ä¸ª <code>script</code> ä¸­è°ƒç”¨å°±å¯ä»¥äº†ã€‚vue æ²¡è¯•è¿‡ï¼Œä½†æ˜¯åº”è¯¥ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> createHistoryEvent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">keyof</span><span class="token plain"> History</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> origin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">origin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dispatchEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;trackerHistory&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;pushState&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHistoryEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;pushState&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;replaceState&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHistoryEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;replaceState&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;pushState&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;replaceState&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;popstate&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> newUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">href</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tracker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/route/change&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        newUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿™é‡Œåªä¿®æ”¹äº† <code>history</code> çš„å‡½æ•°ï¼Œå› ä¸ºæˆ‘åˆšåˆšæ‰å‘ç° <code>react-router-dom</code> çš„ <code>å“ˆå¸Œè·¯ç”±</code> å¥½åƒä¹Ÿæ˜¯åŸºäºæ”¹å†™ <code>histroy</code> å®ç°çš„(ç¬¬äºŒæ¬¡ç«‹ flagï¼Œæ˜å¤©æ™šä¸Šçœ‹çœ‹ <code>react-router-dom</code> çš„æºç ï¼Œå°±ä¸ç”¨å†™ monitor äº†)</p><p>ä¸è¿‡ç›‘å¬ hash è·¯ç”±çš„æ”¹å˜ä¹Ÿæ˜¯éå¸¸å®¹æ˜“çš„</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;hashchange&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> newUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">newURL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> oldUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">oldURL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tracker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/route/hashchange&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hashchange&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oldUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4æ•°æ®ä¸ŠæŠ¥">4.æ•°æ®ä¸ŠæŠ¥<a href="#4æ•°æ®ä¸ŠæŠ¥" class="hash-link" aria-label="Direct link to 4.æ•°æ®ä¸ŠæŠ¥" title="Direct link to 4.æ•°æ®ä¸ŠæŠ¥">â€‹</a></h3><p>è¿™ä¸€å—åˆ†ä¸ºä¸¤éƒ¨åˆ†å†…å®¹ï¼Œæ€ä¹ˆä¸ŠæŠ¥ï¼Œä¸ŠæŠ¥æ—¶æœºã€‚æœ‰ä¸€ä¸ªå®è·µå¯ä»¥å¾ˆå¥½çš„è§£é‡Šè¿™ä¸¤ä¸ªå†…å®¹ï¼Œåœ¨å‘é€æ•°æ®åŸ‹ç‚¹è¯·æ±‚çš„çš„æ—¶å€™æ€»æ˜¯ä½¿ç”¨ 1 <!-- -->*<!-- --> 1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡ã€‚</p><p>è¿™æ ·åšæœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>æ²¡æœ‰è·¨åŸŸé—®é¢˜ï¼Œget è¯·æ±‚</li><li>ä¸ä¼šé˜»å¡é¡µé¢åŠ è½½ï¼Œä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒ</li><li>åœ¨æ‰€æœ‰å›¾ç‰‡ä¸­ï¼Œä½“ç§¯æœ€å°(PNG/JPG)ã€‚</li></ul><p>æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼Œå¯è·¨åŸŸï¼Œå½±å“ä½ï¼Œä½“ç§¯å°ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦åšçš„æ•°æ®ä¸ŠæŠ¥ä¹Ÿè¦å…¼é¡¾è¿™å‡ ç§æƒ…å†µ</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="41-æ€ä¹ˆä¸ŠæŠ¥">4.1 æ€ä¹ˆä¸ŠæŠ¥<a href="#41-æ€ä¹ˆä¸ŠæŠ¥" class="hash-link" aria-label="Direct link to 4.1 æ€ä¹ˆä¸ŠæŠ¥" title="Direct link to 4.1 æ€ä¹ˆä¸ŠæŠ¥">â€‹</a></h4><p>ä¸ŠæŠ¥å°±æ„å‘³ç€è¦å‘é€ç½‘ç»œè¯·æ±‚ï¼ŒåŒæ—¶æˆ‘ä»¬è¦å…¼é¡¾ä¸Šé¢çš„è¦æ±‚ï¼Œè·¨åŸŸå‹å¥½ä»¥åŠä½“ç§¯å°ã€‚æˆ‘ä»¬è¿™é‡Œå¹¶ä¸é‡‡ç”¨ fetch æˆ–è€…ä¸Šé¢è¯´çš„èµ„æºæ ‡ç­¾æ¥å®ç°ç½‘ç»œè¯·æ±‚ï¼Œè€Œæ˜¯é‡‡ç”¨ <code>navigator.sendBeacon</code> æ¥å®ç°ï¼Œè¿™ä¸ª api æ˜¯æµè§ˆå™¨æ–°çš„ä¸€ä¸ªè¯·æ±‚ç­–ç•¥ï¼Œå®ƒæ˜¯ä¸€ä¸ª post è¯·æ±‚ä¸”åªæ”¯æŒ post è¯·æ±‚ã€‚å¦‚æœè¯·æ±‚çš„ content-type ç±»å‹æ˜¯ application/x-www-form-urlencoded,Â multipart/form-data, Â text/plainï¼Œ
å®ƒä¸éœ€è¦ä¸€ä¸ª option é¢„æ£€è¯·æ±‚æ¥æ£€æŸ¥ corsï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥è·¨åŸŸï¼Œä¸éœ€è¦ä»»ä½•è®¾ç½®ã€‚æˆ‘ä»¬æƒ³è¦ä¼ é€’ä¸€ä¸ª json å¯¹è±¡é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ text/plain æ ¼å¼ç„¶åæœåŠ¡ç«¯é‚£è¾¹ä½¿ç”¨<code>JSON.parse</code> è§£ææˆ json å°±è¡Œäº†ã€‚ä¸‹é¢æ˜¯ç®€å•å°è£…çš„ä¸ŠæŠ¥å‡½æ•°ã€‚</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Tracker</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">reportTracker</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">assign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> time</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;text/plain&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> blob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Blob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sendBeacon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#00009f">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">BASE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/tracker</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="42-ä¸ŠæŠ¥æ—¶æœº">4.2 ä¸ŠæŠ¥æ—¶æœº<a href="#42-ä¸ŠæŠ¥æ—¶æœº" class="hash-link" aria-label="Direct link to 4.2 ä¸ŠæŠ¥æ—¶æœº" title="Direct link to 4.2 ä¸ŠæŠ¥æ—¶æœº">â€‹</a></h4><p>åœ¨ä¹‹å‰æˆ‘ä»¬åœ¨é¡µé¢é¦–å±æ¸²æŸ“çš„æ—¶å€™ç»Ÿè®¡äº†ä¸€äº›æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ•°æ®ç»Ÿè®¡å®Œæˆä¹‹åå°±ç«‹é©¬å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå¯èƒ½ä¼šå½±å“åˆ°å®¢æˆ·ç«¯ä¸€äº›å…¶å®ƒèµ„æºçš„åŠ è½½é€Ÿåº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸ŠæŠ¥æ—¶æœºã€‚å¤§éƒ¨äººåº”è¯¥éƒ½äº†è§£è¿‡æµè§ˆå™¨çš„æ¸²æŸ“æµç¨‹å§ã€‚æµè§ˆå™¨çš„ä¸€å¸§ä¼šæ‰§è¡Œå¾ˆå¤šä»»åŠ¡ã€‚å¤§è‡´æœ‰ä¸‹é¢è¿™äº›ã€‚</p><ul><li>äº‹ä»¶å¾ªç¯æ‰§è¡Œå®Œå¾®ä»»åŠ¡åï¼Œåˆ¤æ–­ document æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå¦‚æœéœ€è¦å°±è¿›è¡Œæ›´æ–°</li><li>åˆ¤æ–­ resize å’Œ scroll äº‹ä»¶æ˜¯å¦å‘ç”Ÿï¼Œå¦‚æœæœ‰å°±æ‰§è¡Œå›è°ƒã€‚</li><li>åˆ¤æ–­æ˜¯å¦è§¦å‘äº†åª’ä½“æŸ¥è¯¢</li><li>æ›´æ–°åŠ¨ç”»å¹¶å‘é€äº‹ä»¶</li><li>åˆ¤æ–­æ˜¯å¦æœ‰å…¨å±äº‹ä»¶</li><li>æ‰§è¡Œ <code>requestAnimationFrame</code> å›è°ƒ</li><li>æ‰§è¡Œ <code>IntersectionObserver</code> å›è°ƒ</li><li>æ›´æ–°é¡µé¢</li><li>å¦‚æœä¸€å¸§ä¸­è¿˜æœ‰ç©ºé—²ï¼Œæ‰§è¡Œ<code>requestIdleCallback</code>å›è°ƒ</li></ul><p>ä»ä¸Šé¢è¿™äº›é˜¶æ®µæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ requestIdleCallbackï¼Œå› ä¸ºå®ƒçš„ä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œä¹Ÿä¸ä¼šé˜»å¡æµè§ˆå™¨çš„æ¸²æŸ“ã€‚ç¨å¾®æ”¹åŠ¨äº†ä¸‹ MDN ä¸Šçš„ä¾‹å­å°è£…äº†ä¸‹ã€‚</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FlushQueue</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> queue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  taskHandle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function-variable function" style="color:#d73a49">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> runTaskQueue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">IdleRequestCallback</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">timeRemaining</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">didTimeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">shift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">taskHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">requestIdleCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">runTaskQueue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">taskHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">requestIdleCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">runTaskQueue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> FlushQueue</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åªéœ€è¦å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œç„¶åæŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡(å‡½æ•°)åŠ å…¥é˜Ÿåˆ—å³å¯ã€‚</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/festudy/blog/tags/cli">cli</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/åŸ‹ç‚¹.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/festudy/blog/cli"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">ä»é›¶å¼€å‘ä¸€æ¬¾è‡ªå·±çš„è„šæ‰‹æ¶</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/festudy/blog/tracker sdk"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">æ‰‹å†™å‰ç«¯åŸ‹ç‚¹sdk</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#å‰è¨€" class="table-of-contents__link toc-highlight">å‰è¨€</a></li><li><a href="#å¼€å‘è¿›ç¨‹" class="table-of-contents__link toc-highlight">å¼€å‘è¿›ç¨‹</a><ul><li><a href="#1ç›‘å¬æµè§ˆå™¨-load-è¡Œä¸ºä¸ŠæŠ¥åŸºæœ¬æ•°æ®" class="table-of-contents__link toc-highlight">1.ç›‘å¬æµè§ˆå™¨ load è¡Œä¸ºï¼Œä¸ŠæŠ¥åŸºæœ¬æ•°æ®</a></li><li><a href="#2å¼‚å¸¸æ•è·çš„æ–¹æ³•" class="table-of-contents__link toc-highlight">2.å¼‚å¸¸æ•è·çš„æ–¹æ³•</a></li><li><a href="#3è·¯ç”±ä¸ŠæŠ¥" class="table-of-contents__link toc-highlight">3.è·¯ç”±ä¸ŠæŠ¥</a></li><li><a href="#4æ•°æ®ä¸ŠæŠ¥" class="table-of-contents__link toc-highlight">4.æ•°æ®ä¸ŠæŠ¥</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/festudy/docs/å‰è¨€">ç¬”è®°</a></li><li class="footer__item"><a class="footer__link-item" href="/festudy/blog">blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/festudy/">none</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.chovrio.club" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/chovrio" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/festudy/assets/js/runtime~main.75b24d9c.js"></script>
<script src="/festudy/assets/js/main.90c4655c.js"></script>
</body>
</html>