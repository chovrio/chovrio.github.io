"use strict";(self.webpackChunkfe_study=self.webpackChunkfe_study||[]).push([[821],{2294:r=>{r.exports=JSON.parse('{"blogPosts":[{"id":"vue","metadata":{"permalink":"/festudy/blog/vue","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/Vue\u6e90\u7801\u89e3\u8bfb\uff08\u4e00\uff09createApp.md","source":"@site/blog/Vue\u6e90\u7801\u89e3\u8bfb\uff08\u4e00\uff09createApp.md","title":"Vue\u6e90\u7801\u89e3\u8bfb\u2014\u2014createApp","description":"\u521b\u5efaApp\u5b9e\u4f8b\u7684\u65f6\u5019\u53d1\u751f\u4e86\u4ec0\u4e48","date":"2023-09-28T09:34:51.000Z","formattedDate":"September 28, 2023","tags":[{"label":"vue","permalink":"/festudy/blog/tags/vue"}],"readingTime":9.285,"hasTruncateMarker":false,"authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"frontMatter":{"title":"Vue\u6e90\u7801\u89e3\u8bfb\u2014\u2014createApp","description":"\u521b\u5efaApp\u5b9e\u4f8b\u7684\u65f6\u5019\u53d1\u751f\u4e86\u4ec0\u4e48","slug":"vue","authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"tags":["vue"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"nextItem":{"title":"HTTP\u534f\u8bae","permalink":"/festudy/blog/http\u534f\u8bae"}},"content":"## Vue \u6e90\u7801\u7ed3\u6784\\r\\n\\r\\n**version \u7248\u672c 3.3.0-beta.1**\\r\\n\\r\\npackages\\r\\n\\r\\n```tex\\r\\n\u251c\u2500\u2500 compiler-core // \u62bd\u8c61\u8bed\u6cd5\u6811\u548c\u6e32\u67d3\u6865\u63a5\u5b9e\u73b0\u7684\u6838\u5fc3\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 compiler-dom // \u63d0\u4f9b\u5c06\u6a21\u677f\u7f16\u8bd1\u6210\u6d4f\u89c8\u5668\u539f\u751f DOM \u5143\u7d20\u6e32\u67d3\u51fd\u6570\u7684\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 compiler-sfc // \u63d0\u4f9b\u5c06\u5355\u6587\u4ef6\u7ec4\u4ef6\uff08Vue \u5355\u6587\u4ef6\u7ec4\u4ef6\uff0c\u5373 .vue \u6587\u4ef6\uff09\u89e3\u6790\u6210 JavaScript \u5bf9\u8c61\u7684\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 compiler-ssr // \u63d0\u4f9b\u5728\u670d\u52a1\u7aef\u6e32\u67d3 (SSR) \u671f\u95f4\u7528\u4e8e\u7f16\u8bd1\u548c\u5448\u73b0 Vue \u7ec4\u4ef6\u7684\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 dts-test // \u63d0\u4f9b\u7c7b\u578b\u5b9a\u4e49\u6587\u4ef6\u6d4b\u8bd5\u5de5\u5177\u3002\\r\\n\u251c\u2500\u2500 reactivity // \u63d0\u4f9b\u5185\u90e8\u54cd\u5e94\u5f0f\u7cfb\u7edf\u7684\u5b9e\u73b0\uff0c\u652f\u6301\u5728\u5bf9\u8c61\u72b6\u6001\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u81ea\u52a8\u66f4\u65b0\u76f8\u5173\u89c6\u56fe\u3002\\r\\n\u251c\u2500\u2500 runtime-core // \u63d0\u4f9b Vue \u8fd0\u884c\u65f6\u7684\u6838\u5fc3\u5b9e\u73b0\uff0c\u5305\u62ec vnode \u548c patch \u7b49\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 runtime-dom // \u63d0\u4f9b Vue \u8fd0\u884c\u65f6\u4e0e\u6d4f\u89c8\u5668 DOM \u7684\u4ea4\u4e92\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 runtime-test // \u63d0\u4f9b\u8fd0\u884c\u65f6\u6d4b\u8bd5\u5de5\u5177\u3002\\r\\n\u251c\u2500\u2500 server-renderer // \u63d0\u4f9b\u5c06 Vue \u7ec4\u4ef6\u5448\u73b0\u4e3a\u5b57\u7b26\u4e32\u7684\u670d\u52a1\u7aef\u6e32\u67d3\u5f15\u64ce\u3002\\r\\n\u251c\u2500\u2500 sfc-playground // \u63d0\u4f9b\u5355\u6587\u4ef6\u7ec4\u4ef6\u5728\u7ebf\u7f16\u8f91\u5668\u7684\u5b9e\u73b0\u3002\\r\\n\u251c\u2500\u2500 shared  // \u6536\u96c6 packages \u4e4b\u95f4\u53ef\u5171\u4eab\u7684\u5de5\u5177\u5e93\u3002\\r\\n\u251c\u2500\u2500 size-check // \u63d0\u4f9b\u7528\u4e8e\u68c0\u67e5\u4ee3\u7801\u5927\u5c0f\u5e76\u751f\u6210\u5386\u53f2\u8bb0\u5f55\u7684\u5de5\u5177\u3002\\r\\n\u251c\u2500\u2500 template-explorer // \u63d0\u4f9b\u7528\u4e8e\u67e5\u770b\u548c\u5206\u6790 Vue.js \u6a21\u677f\u7684\u5728\u7ebf\u5de5\u5177\u3002\\r\\n\u251c\u2500\u2500 vue // \u63d0\u4f9b\u96c6\u6210\u4e86 runtime-core \u548c runtime-dom \u7684\u5b8c\u6574\u5305\uff08Vue.js\uff09\u3002\\r\\n\u251c\u2500\u2500 vue-compat // \u63d0\u4f9b\u5411\u540e\u517c\u5bb9\u6027\u652f\u6301\u7684\u5b9e\u73b0\u3002\\r\\n\u2514\u2500\u2500 global.d.ts\\r\\n```\\r\\n\\r\\n\u6bd4\u8f83\u6838\u5fc3\u7684\u5305:\\r\\n\\r\\n- compiler-core\\r\\n- compiler-dom\\r\\n- runtime-core\\r\\n- runtime-dom\\r\\n- reactivity\\r\\n\\r\\n## Vue \u6a21\u677f\u7f16\u8bd1\\r\\n\\r\\n\u5728\u4ecb\u7ecd createApp \u8fd9\u4e2a\u51fd\u6570\u4e4b\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u4e86\u89e3\u4ee5\u4e0b Vue \u7684\u6a21\u677f\u7f16\u8bd1\u7684\u7ed3\u679c\\r\\n\\r\\n\u4e0b\u9762\u662f\u6211\u7684\u76ee\u5f55\u7ed3\u6784\\r\\n\\r\\n![image-20230422213310644](./img/vue/1_createApp/1-0.png)\\r\\n\\r\\n```vue\\r\\n// App-options.vue \u914d\u7f6e\u5f0fApi\\r\\n<template>\\r\\n  <div>\u6211\u662f{{ name }}\u73b0\u5728{{ age }}</div>\\r\\n</template>\\r\\n<script lang=\\"ts\\">\\r\\nexport default {\\r\\n  data() {\\r\\n    return {\\r\\n      name: \\"\u62fe\u53c1\\",\\r\\n      age: 20,\\r\\n    };\\r\\n  },\\r\\n};\\r\\n<\/script>\\r\\n// App-setup.vue \u7ec4\u5408\u5f0fApi\u8bed\u6cd5\u7cd6\\r\\n<template>\\r\\n  <div>\u6211\u662f{{ name }}\u73b0\u5728{{ age }}</div>\\r\\n</template>\\r\\n<script lang=\\"ts\\" setup>\\r\\nconst { ref } = Vue;\\r\\nconst name = ref(\\"\u62fe\u53c1\\");\\r\\nconst age = ref(20);\\r\\n<\/script>\\r\\n// App-composition.vue \u7ec4\u5408\u5f0fApi\\r\\n<template>\\r\\n  <div>\u6211\u662f{{ name }}\u73b0\u5728{{ age }}</div>\\r\\n</template>\\r\\n<script lang=\\"ts\\">\\r\\nconst { ref } = Vue;\\r\\nexport default {\\r\\n  setup() {\\r\\n    const name = ref(\\"\u62fe\u53c1\\");\\r\\n    const age = ref(20);\\r\\n    return {\\r\\n      name,\\r\\n      age,\\r\\n    };\\r\\n  },\\r\\n};\\r\\n<\/script>\\r\\n```\\r\\n\\r\\n\u8fd9\u4e09\u4e2a\u6587\u4ef6\u88ab\u7f16\u8bd1\u540e\u7684\u7ed3\u679c\u5982\u4e0b\\r\\n\\r\\n![image-20230422213541326](./img/vue/1_createApp/1-1.png)\\r\\n\\r\\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7ec4\u5408\u5f0f Api \u548c\u54cd\u5e94\u5f0f Api \u7684 vue \u5355\u6587\u4ef6\u7f16\u8bd1\u540e\u7ed3\u679c\u5176\u5b9e\u662f\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\u7684\uff0csetup \u548c data \u5b83\u4eec\u7684\u672c\u8d28\u662f\u4e00\u6837\u7684\u77e5\u8bc6\u540d\u5b57\u4e0d\u4e00\u6837\u800c\u5df2\u3002\\r\\n\\r\\n![image-20230422213846761](./img/vue/1_createApp/1-2.png)\\r\\n\\r\\n`__file`\u5c31\u662f\u5f53\u524d\u6587\u4ef6\u7684\u672c\u5730\u5730\u5740\uff0c`render`\u662f\u6e32\u67d3\u51fd\u6570\uff0c\u672c\u8d28\u4e0a\u662f\u8c03\u7528\u4e86`/packages/compiler-sfc`\u5c06\u5355\u6587\u4ef6\u7ec4\u4ef6\uff08Vue \u5355\u6587\u4ef6\u7ec4\u4ef6\uff0c\u5373 .vue \u6587\u4ef6\uff09\u89e3\u6790\u6210 JavaScript \u5bf9\u8c61\u3002\\r\\n\\r\\n\u4e0b\u9762\u6211\u4eec\u5c31\u91c7\u7528`setup`\u8bed\u6cd5\u7cd6\u7684\u6587\u4ef6\u6765\u770b\u770b createApp \u8fd9\u4e2a\u51fd\u6570\u5728\u4f20\u5165\u4e86 App.vue \u5355\u6587\u4ef6\u7f16\u8bd1\u540e\u5bf9\u8c61\u540e\u5230\u5e95\u505a\u4e86\u4ec0\u4e48\u3002\\r\\n\\r\\n## createApp\\r\\n\\r\\n\u6839\u636e\u65ad\u70b9\u6211\u4eec\u53ef\u4ee5\u627e\u5230`createApp`\u8fd9\u4e2a\u51fd\u6570\u88ab\u5b9a\u4e49\u5728\u4e86`/packages/runtime-dom/src/index.ts`\u7684\u7b2c 65 \u884c\u5de6\u53f3\uff0c\u5b83\u8c03\u7528\u4e86`ensureRenderer`\u8fd9\u4e2a\u65b9\u6cd5\uff0c`ensureRenderer`\u6709\u8fd4\u56de\u4e86\u4e00\u4e2a`createApp`\u65b9\u6cd5\uff0c\u901a\u8fc7\u8fd4\u56de\u7684`createApp`\u65b9\u6cd5\uff0c\u518d\u4f20\u5165\u6211\u4eec\u4f20\u5165\u7684`App`\u6a21\u677f\uff0c\u521b\u5efa\u597d\u4e86\u6211\u4eec\u7684`app`\u5e94\u7528\u3002\\r\\n\\r\\n```ts\\r\\n// https://github.com/vuejs/core/blob/main/packages/runtime-dom/src/index.ts#L65\\r\\nexport const createApp = ((...args) => {\\r\\n  const app = ensureRenderer().createApp(...args);\\r\\n  // \u8fd9\u91cc\u628a\u5f00\u53d1\u73af\u5883\u4e0b\u7684\u8c03\u8bd5\u4ee3\u7801\u548c \u5bf9 app \u7684 mount \u65b9\u6cd5\u7684\u91cd\u5199\u5168\u5220\u9664\u4e86\uff0c\u540e\u9762\u4f1a\u8bb2\\r\\n  return app;\\r\\n}) as CreateAppFunction<Element>;\\r\\n```\\r\\n\\r\\n### ensureRenderer \u51fd\u6570\\r\\n\\r\\n\u8fd9\u4e2a\u51fd\u6570\u7684\u5927\u4f53\u903b\u8f91\u6bd4\u8f83\u7b80\u5355\\r\\n\\r\\n```ts\\r\\n// renderder\u662f\u5728\u4e0a\u9762\u5b9a\u4e49\u7684\u6ca1\u6709\u521d\u59cb\u503c\\r\\nlet renderer: Renderer<Element | ShadowRoot> | HydrationRenderer;\\r\\n// https://github.com/vuejs/core/blob/main/packages/runtime-dom/src/index.ts#L41\\r\\nfunction ensureRenderer() {\\r\\n  // renderer \u5b58\u5728\u5c31\u8fd4\u56de\u4e0d\u5b58\u5728\u5c31\u521b\u5efa\u4e00\u4e2a\\r\\n  return (\\r\\n    renderer ||\\r\\n    (renderer = createRenderer<Node, Element | ShadowRoot>(rendererOptions))\\r\\n  );\\r\\n}\\r\\n```\\r\\n\\r\\n`createRenderer`\u8fd9\u4e2a\u51fd\u6570\u6765\u81ea\u4e8e`/packages/runtime-core`\uff0c\u4f20\u5165\u7684\u53c2\u6570`rendererOptions`\u5219\u662f\u5728`/packages/runtime-dom/src/index.ts`\u4e0b\u5b9a\u4e49\u597d\u4e86\\r\\n\\r\\n```ts\\r\\n/*\\r\\n\\t1.extend\u5176\u5b9e\u5c31\u662f Object.assign \u7528\u4e8e\u5408\u5e76\u4e24\u4e2a\u5bf9\u8c61\\r\\n\\t2.nodeOps\uff1a\u5b58\u50a8\u64cd\u4f5c\u548c\u83b7\u53d6\u8282\u70b9\u7684\u51fd\u6570\u7684\u5bf9\u8c61\\r\\n\\t3.patchProp\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u66f4\u65b0\u8282\u70b9\uff0c\u56e0\u4e3a\u5b83\u4ec5\u4ec5\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e3a\u4e86\u5408\u5e76\u5f97\u7528\u5bf9\u8c61\u5305\u88f9\\r\\n*/\\r\\nconst rendererOptions = /*#__PURE__*/ extend({ patchProp }, nodeOps);\\r\\n```\\r\\n\\r\\n\u4f20\u5165\u4e86 rendererOptions \u8fd9\u4e2a\u53c2\u6570\u7ed9 createRenderer \u540e\uff0ccreateRenderer \u53c8\u8c03\u7528\u4e86\u53e6\u4e00\u4e2a\u51fd\u6570`baseCreateRenderer`,\u4e0b\u9762\u662f baseCreateRenderer \u7684\u4e00\u4e9b\u5173\u952e\u4ee3\u7801\\r\\n\\r\\n```ts\\r\\n// https://github.com/vuejs/core/blob/main/packages/runtime-core/src/renderer.ts#L313\\r\\n/**\\r\\n * \u539f\u51fd\u6570\u4e2d\u662f\u4f7f\u7528\u4e86\u51fd\u6570\u91cd\u8f7d\uff0c\u5c31\u4e24\u79cd\u7c7b\u578b\uff0c\u5b58\u5728\u521b\u5efa\u6c34\u548c\u51fd\u6570\uff0c\u8fd4\u56de\u6c34\u548c\u540e\u7684renderer\uff0c\\r\\n * \u4e0d\u5b58\u5728\u6c34\u548c\u51fd\u6570\uff0c\u8fd4\u56de\u666e\u901arenderer\uff0c\u6211\u4eec\u8fd9\u91cc\u7684\u60c5\u51b5\u662f\u6ca1\u6709\u4f20\u5165\u521b\u5efa\u6c34\u548c\u51fd\u6570\uff0c\\r\\n * \u7b80\u5355\u63d0\u4e00\u5634\uff0c\u6c34\u548c\u662fSSR\u6e32\u67d3\u7684\u5173\u952e\\r\\n */\\r\\nfunction baseCreateRenderer(options, createHydrationFns? = undefined) {\\r\\n  // render\u51fd\u6570\u7684\u4f5c\u7528\u662f\u5c06vnode(\u865a\u62dfDOM\u8282\u70b9)\u6e32\u67d3\u5230\u6307\u5b9a\u7684container(\u771f\u5b9eDOM\u5bb9\u5668)\u4e2d\\r\\n  const render: RootRenderFunction = (vnode, container, isSVG) => {\\r\\n    // \u5982\u679c\u865a\u62dfDOM\u8282\u70b9\u4e3anull\\r\\n    if (vnode == null) {\\r\\n      // \u4e14\u5bb9\u5668\u4e0a\u5df2\u7ecf\u6302\u8f7d\u4e86_vnode(\u4e4b\u524d\u6e32\u67d3\u51fa\u6765\u7684\u865a\u62dfDOM)\\r\\n      if (container._vnode) {\\r\\n        // \u5378\u8f7d\u6389\u4e4b\u524d\u6302\u8f7d\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u7684unmount\u5728baseCreateRenderer\u51fd\u6570\u5185\uff0c\u6211\u7ed9\u5220\u6389\u4e86\\r\\n        unmount(container._vnode, null, null, true);\\r\\n      }\\r\\n    }\\r\\n    // \u5982\u679cvnode\u4e0d\u4e3anull\\r\\n    else {\\r\\n      // \u901a\u8fc7patch\u51fd\u6570\u5c06\u5bb9\u5668\u4e0a\u7684\u65e7\u7684_vnode\u4e0e\u6700\u65b0\u7684vnode\u8fdb\u884c\u6bd4\u8f83\\r\\n      // \u5982\u679c\u4e00\u6837\u5c31\u76f4\u63a5return\uff0c\u4e0d\u4e00\u6837\u5c31\u5c06\u6700\u65b0\u7684\u6e32\u67d3\u5230container\\r\\n      patch(\\r\\n        container._vnode || null,\\r\\n        vnode,\\r\\n        container,\\r\\n        null,\\r\\n        null,\\r\\n        null,\\r\\n        isSVG\\r\\n      );\\r\\n    }\\r\\n    // \u6267\u884c\u9884\u5148\u6e32\u67d3\u51fd\u6570\u961f\u5217\u4e2d\u7684\u51fd\u6570(\u4f8b\u5982watch\u56de\u8c03\u51fd\u6570)\\r\\n    flushPreFlushCbs();\\r\\n    // \u6267\u884c\u540e\u7f6e\u6e32\u67d3\u51fd\u6570\u961f\u5217\u4e2d\u7684\u56de\u8c03\u51fd\u6570(\u4f8b\u5982$nextTick)\\r\\n    flushPostFlushCbs();\\r\\n    // \u66f4\u65b0_vnode\u6307\u5411\\r\\n    container._vnode = vnode;\\r\\n  };\\r\\n  // \u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u538b\u6839\u5c31\u6ca1\u4f7f\u7528SSR\u6e32\u67d3\uff0c\u6240\u4ee5\u4e0b\u9762\u4e24\u4e2a\u90fd\u662fundefined\\r\\n  let hydrate: ReturnType<typeof createHydrationFunctions>[0] | undefined;\\r\\n  let hydrateNode: ReturnType<typeof createHydrationFunctions>[1] | undefined;\\r\\n  return {\\r\\n    render,\\r\\n    hydrate,\\r\\n    createApp: createAppAPI(render, hydrate),\\r\\n  };\\r\\n}\\r\\n```\\r\\n\\r\\n### createAppAPI\\r\\n\\r\\n\u8fd9\u4e2a\u51fd\u6570\u662f\u4e00\u4e2a\u9ad8\u9636\u51fd\u6570\uff0c\u5b83\u8fd4\u56de\u6211\u4eec\u771f\u6b63\u7684`createApp`\u51fd\u6570\\r\\n\\r\\n```ts\\r\\n// https://github.com/vuejs/core/blob/main/packages/runtime-core/src/apiCreateApp.ts#L199\\r\\nexport function createAppAPI<HostElement>(\\r\\n  render: RootRenderFunction<HostElement>,\\r\\n  hydrate?: RootHydrateFunction\\r\\n): CreateAppFunction<HostElement> {\\r\\n  // \u8fd4\u56de\u771f\u6b63\u7684createApp\u51fd\u6570 \u53c2\u6570\u662f\u6839\u7ec4\u4ef6\u548c\u5b83\u7684props\u53c2\u6570\u6ca1\u6709\u5c31\u4e3anull\\r\\n  return function createApp(rootComponent, rootProps = null) {\\r\\n    // \u5982\u679c\u6839\u7ec4\u4ef6\u662f\u51fd\u6570\u7ec4\u4ef6\u5c31\u4f7f\u7528extend\u5c06\u5b83\u653e\u5728\u4e00\u4e2a\u5bf9\u8c61\u91cc\u9762\\r\\n    if (!isFunction(rootComponent)) {\\r\\n      rootComponent = extend({}, rootComponent)\\r\\n    }\\r\\n    /** \u521b\u5efa\u6839\u7ec4\u4ef6\u4e0a\u4e0b\u6587 */\\r\\n    const context = createAppContext()\\r\\n    const app: App = (context.app = {\\r\\n        // \u7701\u7565\u4e00\u5927\u5768....\\r\\n        // \u5c31\u662fapp\u5bf9\u8c61\uff0cmount\u65b9\u6cd5\u5c31\u5728\u91cc\u9762\\r\\n    }\\r\\n    /** __COMPAT__ \u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u7528\u4e8e\u6807\u8bb0\u662f\u5426\u5904\u4e8e\u517c\u5bb9\u6a21\u5f0f */\\r\\n    if (__COMPAT__) {\\r\\n      /**\\r\\n       * \u5728\u517c\u5bb9\u6a21\u5f0f\u4e0b\u4e3aapp\u5b89\u88c5\u4e00\u4e9b\u5c5e\u6027($attrs\u548c$listeners)\\r\\n       * \u4e3acontext\u52a0\u5165compatConfig\u7684\u5c5e\u6027\\r\\n       * \u4e3b\u8981\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9vue2\\r\\n       */\\r\\n      installAppCompatProperties(app, context, render)\\r\\n    }\\r\\n    return app\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n![image-20230423105721466](./img/vue/1_createApp/1-3.png)\\r\\n\\r\\n\u73b0\u5728\u6211\u4eec\u5c31\u628a CSR(\u5ba2\u6237\u7aef\u6e32\u67d3\u7684 createApp \u6d41\u7a0b\u8d70\u901a\u4e86)\\r\\n\\r\\n### mount \u65b9\u6cd5\\r\\n\\r\\n\u6700\u540e\u518d\u4ecb\u7ecd\u4e00\u4e0b app \u5bf9\u8c61\u91cc\u9762\u7684 mount \u65b9\u6cd5\\r\\n\\r\\n```ts\\r\\n/** \u6807\u8bc6\u7ec4\u4ef6\u662f\u5426\u6302\u8f7d */\\r\\nlet isMounted = false\\r\\nconst app: App = (context.app = {\\r\\n    ...\\r\\n    mount(\\r\\n    \\trootContainer: HostElement,\\r\\n        isHydrate?: boolean,\\r\\n        isSVG?: boolean\\r\\n    ): any {\\r\\n    \\t// \u6ca1\u6709\u6302\u8f7d\u5c31\u521b\u5efa\u865a\u62dfDOM \u53c2\u6570\u662f\u6839\u7ec4\u4ef6\u548cprops\u53c2\u6570(\u5c31\u662fcreateApp\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570)\\r\\n        if (!isMounted) {\\r\\n          const vnode = createVNode(\\r\\n            rootComponent as ConcreteComponent,\\r\\n            rootProps\\r\\n          )\\r\\n\\t\\tvnode.appContext = context\\r\\n          /** \u5224\u65ad\u662f\u5426\u662f\u670d\u52a1\u7aef\u6e32\u67d3 */\\r\\n          if (isHydrate && hydrate) {\\r\\n            hydrate(vnode as VNode<Node, Element>, rootContainer as any)\\r\\n          } else {\\r\\n          /** \u4e0d\u662f\u5c31\u8c03\u7528render\u51fd\u6570\uff0c\u8fd9\u91cc\u7684render\u51fd\u6570\u662f\u6211\u4eec\u4e4b\u524d\u4f20\u5165\u7684 */\\r\\n            render(vnode, rootContainer, isSVG)\\r\\n          }\\r\\n          /** render\u6210\u529f\u540e\u7ec4\u4ef6\u6302\u8f7d\u6210\u529f */\\r\\n    \\tisMounted = true\\r\\n        /** \u6807\u8bc6\u521b\u5efa\u7684Vue\u5b9e\u4f8b\u7684\u6839\u5bb9\u5668 */\\r\\n        app._container = rootContainer\\r\\n        /** __vue__app\u6307\u5411vue\u7ec4\u4ef6\u5b9e\u4f8b \u5305\u542b\u865a\u62dfDOM\u548c\u5176\u4ed6\u5c5e\u6027\u6bd4\u5982mount unmount.... */\\r\\n    \\t(rootContainer as any).__vue_app__ = app\\r\\n    \\t// \u8fd4\u56deApp\u5e94\u7528\u5b9e\u4f8b\u7684\u5e94\u7528\uff0c\u4e0a\u9762\u5b58\u5728\u5f88\u591a\u65b9\u6cd5\\r\\n    \\treturn getExposeProxy(vnode.component!) || vnode.component!.proxy\\r\\n\\t}\\r\\n    ...\\r\\n\\t}\\r\\n})\\r\\n```\\r\\n\\r\\n![image-20230423120847058](./img/vue/1_createApp/1-4.png)"},{"id":"/http\u534f\u8bae","metadata":{"permalink":"/festudy/blog/http\u534f\u8bae","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/http\u534f\u8bae.md","source":"@site/blog/http\u534f\u8bae.md","title":"HTTP\u534f\u8bae","description":"HTTP\u534f\u8bae\u662f\u4ec0\u4e48\uff1f","date":"2023-09-28T09:34:51.000Z","formattedDate":"September 28, 2023","tags":[],"readingTime":13.675,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"prevItem":{"title":"Vue\u6e90\u7801\u89e3\u8bfb\u2014\u2014createApp","permalink":"/festudy/blog/vue"},"nextItem":{"title":"\u4e00\u4e2a\u7b80\u5355\u7684 Github Action \u4f7f\u7528\u6559\u7a0b","permalink":"/festudy/blog/github action ci"}},"content":"## HTTP\u534f\u8bae\u662f\u4ec0\u4e48\uff1f\\r\\n\\r\\n***\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\\\\***\uff08HTTP\uff09\u662f\u4e00\u4e2a\u7528\u4e8e\u4f20\u8f93\u8d85\u5a92\u4f53\u6587\u6863\uff08\u4f8b\u5982 HTML\uff09\u7684[\u5e94\u7528\u5c42](https://zh.wikipedia.org/wiki/\u5e94\u7528\u5c42)\u534f\u8bae\u3002\u5b83\u662f\u4e3a Web \u6d4f\u89c8\u5668\u4e0e Web \u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u800c\u8bbe\u8ba1\u7684\uff0c\u4f46\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5176\u4ed6\u76ee\u7684\u3002HTTP \u9075\u5faa\u7ecf\u5178\u7684[\u5ba2\u6237\u7aef\u2014\u670d\u52a1\u7aef\u6a21\u578b](https://zh.wikipedia.org/wiki/\u4e3b\u5f9e\u5f0f\u67b6\u69cb)\uff0c\u5ba2\u6237\u7aef\u6253\u5f00\u4e00\u4e2a\u8fde\u63a5\u4ee5\u53d1\u51fa\u8bf7\u6c42\uff0c\u7136\u540e\u7b49\u5f85\u76f4\u5230\u6536\u5230\u670d\u52a1\u5668\u7aef\u54cd\u5e94\u3002HTTP \u662f[\u65e0\u72b6\u6001\u534f\u8bae](http://zh.wikipedia.org/wiki/\u65e0\u72b6\u6001\u534f\u8bae)\uff0c\u8fd9\u610f\u5473\u7740\u670d\u52a1\u5668\u4e0d\u4f1a\u5728\u4e24\u4e2a\u8bf7\u6c42\u4e4b\u95f4\u4fdd\u7559\u4efb\u4f55\u6570\u636e\uff08\u72b6\u6001\uff09\u3002\\r\\n\\r\\n## HTTP \u7684\u57fa\u672c\u6027\u8d28\\r\\n\\r\\n### HTTP \u662f\u7b80\u5355\u7684\\r\\n\\r\\n\u867d\u7136\u4e0b\u4e00\u4ee3 HTTP/2 \u534f\u8bae\u5c06 HTTP \u6d88\u606f\u5c01\u88c5\u5230\u4e86\u5e27\uff08frame\uff09\u4e2d\uff0cHTTP \u5927\u4f53\u4e0a\u8fd8\u662f\u88ab\u8bbe\u8ba1\u5f97\u7b80\u5355\u6613\u8bfb\u3002HTTP \u62a5\u6587\u80fd\u591f\u88ab\u4eba\u8bfb\u61c2\uff0c\u8fd8\u5141\u8bb8\u7b80\u5355\u6d4b\u8bd5\uff0c\u964d\u4f4e\u4e86\u95e8\u69db\uff0c\u5bf9\u65b0\u4eba\u5f88\u53cb\u597d\u3002\\r\\n\\r\\n### HTTP \u662f\u53ef\u6269\u5c55\u7684\\r\\n\\r\\n\u5728 HTTP/1.0 \u4e2d\u51fa\u73b0\u7684 [HTTP \u6807\u5934\uff08header\uff09](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)\u8ba9\u534f\u8bae\u6269\u5c55\u53d8\u5f97\u975e\u5e38\u5bb9\u6613\u3002\u53ea\u8981\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u5c31\u65b0\u6807\u5934\u8fbe\u6210\u8bed\u4e49\u4e00\u81f4\uff0c\u65b0\u529f\u80fd\u5c31\u53ef\u4ee5\u88ab\u8f7b\u677e\u52a0\u5165\u8fdb\u6765\u3002\\r\\n\\r\\n### HTTP \u662f\u65e0\u72b6\u6001\uff0c\u6709\u4f1a\u8bdd\u7684\\r\\n\\r\\nHTTP \u662f\u65e0\u72b6\u6001\u7684\uff1a\u5728\u540c\u4e00\u4e2a\u8fde\u63a5\u4e2d\uff0c\u4e24\u4e2a\u6267\u884c\u6210\u529f\u7684\u8bf7\u6c42\u4e4b\u95f4\u662f\u6ca1\u6709\u5173\u7cfb\u7684\u3002\u8fd9\u5c31\u5e26\u6765\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u7528\u6237\u6ca1\u6709\u529e\u6cd5\u5728\u540c\u4e00\u4e2a\u7f51\u7ad9\u4e2d\u8fdb\u884c\u8fde\u7eed\u7684\u4ea4\u4e92\uff0c\u6bd4\u5982\u5728\u4e00\u4e2a\u7535\u5546\u7f51\u7ad9\u91cc\uff0c\u7528\u6237\u628a\u67d0\u4e2a\u5546\u54c1\u52a0\u5165\u5230\u8d2d\u7269\u8f66\uff0c\u5207\u6362\u4e00\u4e2a\u9875\u9762\u540e\u518d\u6b21\u6dfb\u52a0\u4e86\u5546\u54c1\uff0c\u8fd9\u4e24\u6b21\u6dfb\u52a0\u5546\u54c1\u7684\u8bf7\u6c42\u4e4b\u95f4\u6ca1\u6709\u5173\u8054\uff0c\u6d4f\u89c8\u5668\u65e0\u6cd5\u77e5\u9053\u7528\u6237\u6700\u7ec8\u9009\u62e9\u4e86\u54ea\u4e9b\u5546\u54c1\u3002\u800c\u4f7f\u7528 HTTP \u7684\u6807\u5934\u6269\u5c55\uff0cHTTP Cookie \u5c31\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u628a Cookie \u6dfb\u52a0\u5230\u6807\u5934\u4e2d\uff0c\u521b\u5efa\u4e00\u4e2a\u4f1a\u8bdd\u8ba9\u6bcf\u6b21\u8bf7\u6c42\u90fd\u80fd\u5171\u4eab\u76f8\u540c\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u8fbe\u6210\u76f8\u540c\u7684\u72b6\u6001\u3002\\r\\n\\r\\n\u6ce8\u610f\uff0cHTTP \u672c\u8d28\u662f\u65e0\u72b6\u6001\u7684\uff0c\u4f7f\u7528 Cookie \u53ef\u4ee5\u521b\u5efa\u6709\u72b6\u6001\u7684\u4f1a\u8bdd\u3002\\r\\n\\r\\n### HTTP \u548c\u8fde\u63a5\\r\\n\\r\\n\u4e00\u4e2a\u8fde\u63a5\u662f\u7531\u4f20\u8f93\u5c42\u6765\u63a7\u5236\u7684\uff0c\u8fd9\u4ece\u6839\u672c\u4e0a\u4e0d\u5c5e\u4e8e HTTP \u7684\u8303\u56f4\u3002HTTP \u5e76\u4e0d\u9700\u8981\u5176\u5e95\u5c42\u7684\u4f20\u8f93\u5c42\u534f\u8bae\u662f\u9762\u5411\u8fde\u63a5\u7684\uff0c\u53ea\u9700\u8981\u5b83\u662f\u53ef\u9760\u7684\uff0c\u6216\u4e0d\u4e22\u5931\u6d88\u606f\u7684\uff08\u81f3\u5c11\u8fd4\u56de\u9519\u8bef\uff09\u3002\u5728\u4e92\u8054\u7f51\u4e2d\uff0c\u6709\u4e24\u4e2a\u6700\u5e38\u7528\u7684\u4f20\u8f93\u5c42\u534f\u8bae\uff1aTCP \u662f\u53ef\u9760\u7684\uff0c\u800c UDP \u4e0d\u662f\u3002\u56e0\u6b64\uff0cHTTP \u4f9d\u8d56\u4e8e\u9762\u5411\u8fde\u63a5\u7684 TCP \u8fdb\u884c\u6d88\u606f\u4f20\u9012\uff0c\u4f46\u8fde\u63a5\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\u3002\\r\\n\\r\\n\u5728\u5ba2\u6237\u7aef\uff08\u901a\u5e38\u6307\u6d4f\u89c8\u5668\uff09\u4e0e\u670d\u52a1\u5668\u80fd\u591f\u4ea4\u4e92\uff08\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u54cd\u5e94\uff09\u4e4b\u524d\uff0c\u5fc5\u987b\u5728\u8fd9\u4e24\u8005\u95f4\u5efa\u7acb\u4e00\u4e2a TCP \u94fe\u63a5\uff0c\u6253\u5f00\u4e00\u4e2a TCP \u8fde\u63a5\u9700\u8981\u591a\u6b21\u5f80\u8fd4\u4ea4\u6362\u6d88\u606f\uff08\u56e0\u6b64\u8017\u65f6\uff09\u3002HTTP/1.0 \u9ed8\u8ba4\u4e3a\u6bcf\u4e00\u5bf9 HTTP \u8bf7\u6c42/\u54cd\u5e94\u90fd\u6253\u5f00\u4e00\u4e2a\u5355\u72ec\u7684 TCP \u8fde\u63a5\u3002\u5f53\u9700\u8981\u8fde\u7eed\u53d1\u8d77\u591a\u4e2a\u8bf7\u6c42\u65f6\uff0c\u8fd9\u79cd\u6a21\u5f0f\u6bd4\u591a\u4e2a\u8bf7\u6c42\u5171\u4eab\u540c\u4e00\u4e2a TCP \u94fe\u63a5\u66f4\u4f4e\u6548\u3002\\r\\n\\r\\n\u4e3a\u4e86\u51cf\u8f7b\u8fd9\u4e9b\u7f3a\u9677\uff0cHTTP/1.1 \u5f15\u5165\u4e86\u6d41\u6c34\u7ebf\uff08\u88ab\u8bc1\u660e\u96be\u4ee5\u5b9e\u73b0\uff09\u548c\u6301\u4e45\u8fde\u63a5\u7684\u6982\u5ff5\uff1a\u5e95\u5c42\u7684 TCP \u8fde\u63a5\u53ef\u4ee5\u901a\u8fc7 [`Connection`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Connection) \u6807\u5934\u6765\u88ab\u90e8\u5206\u63a7\u5236\u3002HTTP/2 \u5219\u53d1\u5c55\u5f97\u66f4\u8fdc\uff0c\u901a\u8fc7\u5728\u4e00\u4e2a\u8fde\u63a5\u590d\u7528\u6d88\u606f\u7684\u65b9\u5f0f\u6765\u8ba9\u8fd9\u4e2a\u8fde\u63a5\u59cb\u7ec8\u4fdd\u6301\u4e3a\u6696\u8fde\u63a5\u3002\\r\\n\\r\\n\u4e3a\u4e86\u66f4\u597d\u7684\u9002\u5408 HTTP\uff0c\u8bbe\u8ba1\u4e00\u79cd\u66f4\u597d\u4f20\u8f93\u534f\u8bae\u7684\u8fdb\u7a0b\u4e00\u76f4\u5728\u8fdb\u884c\u3002Google \u5c31\u7814\u53d1\u4e86\u4e00\u79cd\u4ee5 UDP \u4e3a\u57fa\u7840\uff0c\u80fd\u63d0\u4f9b\u66f4\u53ef\u9760\u66f4\u9ad8\u6548\u7684\u4f20\u8f93\u534f\u8bae [QUIC](https://en.wikipedia.org/wiki/QUIC)\u3002\\r\\n\\r\\n### \u6ce8\u610f\u70b9\uff1a\\r\\n\\r\\n- `HTTP`\u9650\u5236\u6bcf\u6b21\u8fde\u63a5\u53ea\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u5904\u7406\u5b8c\u5ba2\u6237\u7684\u8bf7\u6c42\uff0c\u5e76\u6536\u5230\u5ba2\u6237\u7684\u5e94\u7b54\u540e\uff0c\u5373\u65ad\u5f00\u8fde\u63a5\\r\\n\\r\\n- `HTTP`\u662f\u5a92\u4f53\u72ec\u7acb\u7684\uff0c\u53ea\u8981\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u77e5\u9053\u5982\u4f55\u5904\u7406\u7684\u6570\u636e\u5185\u5bb9\uff0c\u4efb\u4f55\u7c7b\u578b\u7684\u6570\u636e\u90fd\u53ef\u4ee5\u901a\u8fc7HTTP\u53d1\u9001\\r\\n\\r\\n- `HTTP`\u662f\u65e0\u72b6\u6001\u7684\uff0c\u534f\u8bae\u5bf9\u4e8e\u4e8b\u52a1\u5904\u7406\u6ca1\u6709\u8bb0\u5fc6\u80fd\u529b\u3002\u7f3a\u5c11\u72b6\u6001\u610f\u5473\u7740\u5982\u679c\u540e\u7eed\u5904\u7406\u9700\u8981\u524d\u9762\u7684\u4fe1\u606f\uff0c\u5219\u5b83\u5fc5\u987b\u91cd\u4f20\uff0c\u8fd9\u6837\u53ef\u80fd\u5bfc\u81f4\u6bcf\u6b21\u8fde\u63a5\u4f20\u9001\u7684\u6570\u636e\u91cf\u589e\u5927\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5728\u670d\u52a1\u5668\u4e0d\u9700\u8981\u5148\u524d\u4fe1\u606f\u65f6\u5b83\u7684\u5e94\u7b54\u5c31\u8f83\u5feb\u3002\\r\\n\\r\\n## HTTP\u62a5\u6587\\r\\n\\r\\n### \u8bf7\u6c42\u62a5\u6587\\r\\n\\r\\n- \u8bf7\u6c42\u884c\\r\\n  - \u8bf7\u6c42\u884c\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a**\u8bf7\u6c42\u65b9\u6cd5**\u3001**\u8bf7\u6c42URL**\uff08\u4e0d\u5305\u62ec\u57df\u540d | \u3001**HTTP\u534f\u8bae\u7248\u672c**\\r\\n- \u901a\u7528\u4fe1\u606f\u5934\\r\\n- \u8bf7\u6c42\u5934\\r\\n- \u5b9e\u4f53\u5934\\r\\n- \u62a5\u6587\u4e3b\u4f53\\r\\n\\r\\n### \u54cd\u5e94\u62a5\u6587\\r\\n\\r\\n- \u72b6\u6001\u884c\\r\\n- \u901a\u7528\u4fe1\u606f\u5934\\r\\n- \u54cd\u5e94\u5934\\r\\n- \u5b9e\u4f53\u5934\\r\\n- \u62a5\u6587\u4e3b\u4f53\\r\\n\\r\\n## HTTP\u8bf7\u6c42\u65b9\u5f0f\\r\\n\\r\\n- GET\\r\\n\\r\\n\u3000\u3000\u4f20\u9012\u53c2\u6570\u957f\u5ea6\u53d7\u9650\u5236\uff0c\u56e0\u4e3a\u4f20\u9012\u7684\u53c2\u6570\u662f\u76f4\u63a5\u8868\u793a\u5728\u5730\u5740\u680f\u4e2d\uff0c\u800c\u7279\u5b9a\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u5bf9url\u7684\u957f\u5ea6\u662f\u6709\u9650\u5236\u7684\u3002\\r\\n\\r\\n\u3000\u3000\u6240\u4ee5\uff0cGET\u4e0d\u9002\u5408\u7528\u6765\u4f20\u9012\u79c1\u5bc6\u6570\u636e\uff0c\u4e5f\u4e0d\u9002\u5408\u62ff\u6765\u4f20\u9012\u5927\u91cf\u6570\u636e\u3002\\r\\n\\r\\n\u3000\u3000\u4f46\u4e00\u822c\u7684HTTP\u8bf7\u6c42\u5927\u591a\u90fd\u662fGET\u3002\\r\\n\\r\\n- POST\\r\\n\\r\\n\u3000\u3000POST\u628a\u4f20\u9012\u7684\u6570\u636e\u5c01\u88c5\u5728HTTP\u8bf7\u6c42\u6570\u636e\u4e2d\uff0c\u4ee5\u540d\u79f0/\u503c\u7684\u5f62\u5f0f\u51fa\u73b0\uff0c\u53ef\u4ee5\u4f20\u8f93\u5927\u91cf\u6570\u636e\uff0c\u5bf9\u6570\u636e\u91cf\u6ca1\u6709\u9650\u5236\uff0c\u4e5f\u4e0d\u4f1a\u663e\u793a\u5728URL\u4e2d\u3002\u8868\u5355\u7684\u63d0\u4ea4\u7528\u7684\u662fPOST\u3002\\r\\n\\r\\n- HEAD\\r\\n\\r\\n\u3000\u3000HEAD\u8ddfGET\u76f8\u4f3c\uff0c\u4e0d\u8fc7\u670d\u52a1\u7aef\u63a5\u6536\u5230HEAD\u8bf7\u6c42\u65f6\u53ea\u8fd4\u56de\u54cd\u5e94\u5934\uff0c\u4e0d\u53d1\u9001\u54cd\u5e94\u5185\u5bb9\u3002\u6240\u4ee5\uff0c\u5982\u679c\u53ea\u9700\u8981\u67e5\u770b\u67d0\u4e2a\u9875\u9762\u7684\u72b6\u6001\u65f6\uff0c\u7528HEAD\u66f4\u9ad8\u6548\uff0c\u56e0\u4e3a\u7701\u53bb\u4e86\u4f20\u8f93\u9875\u9762\u5185\u5bb9\u7684\u65f6\u95f4\u3002\\r\\n\\r\\n- DELETE\\r\\n\\r\\n\u3000\u3000\u5220\u9664\u67d0\u4e00\u4e2a\u8d44\u6e90\u3002\\r\\n\\r\\n- OPTIONS\\r\\n\\r\\n\u3000\u3000\u7528\u4e8e\u83b7\u53d6\u5f53\u524dURL\u6240\u652f\u6301\u7684\u65b9\u6cd5\u3002\u82e5\u8bf7\u6c42\u6210\u529f\uff0c\u4f1a\u5728HTTP\u5934\u4e2d\u5305\u542b\u4e00\u4e2a\u540d\u4e3a\u201cAllow\u201d\u7684\u5934\uff0c\u503c\u662f\u6240\u652f\u6301\u7684\u65b9\u6cd5\uff0c\u5982\u201cGET, POST\u201d\u3002\\r\\n\\r\\n- PUT\\r\\n\\r\\n\u3000\u3000\u628a\u4e00\u4e2a\u8d44\u6e90\u5b58\u653e\u5728\u6307\u5b9a\u7684\u4f4d\u7f6e\u4e0a\u3002\\r\\n\\r\\n\u3000\u3000\u672c\u8d28\u4e0a\u6765\u8bb2\uff0c PUT\u548cPOST\u6781\u4e3a\u76f8\u4f3c\uff0c\u90fd\u662f\u5411\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e\uff0c\u4f46\u5b83\u4eec\u4e4b\u95f4\u6709\u4e00\u4e2a\u91cd\u8981\u533a\u522b\uff0cPUT\u901a\u5e38\u6307\u5b9a\u4e86\u8d44\u6e90\u7684\u5b58\u653e\u4f4d\u7f6e\uff0c\u800cPOST\u5219\u6ca1\u6709\uff0cPOST\u7684\u6570\u636e\u5b58\u653e\u4f4d\u7f6e\u7531\u670d\u52a1\u5668\u81ea\u5df1\u51b3\u5b9a\u3002\\r\\n\\r\\n- TRACE\\r\\n\\r\\n\u3000\u3000\u56de\u663e\u670d\u52a1\u5668\u6536\u5230\u7684\u8bf7\u6c42\uff0c\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u6216\u8bca\u65ad\u3002\\r\\n\\r\\n- CONNECT\\r\\n\\r\\n\u3000\u3000CONNECT\u65b9\u6cd5\u662fHTTP/1.1\u534f\u8bae\u9884\u7559\u7684\uff0c\u80fd\u591f\u5c06\u8fde\u63a5\u6539\u4e3a\u7ba1\u9053\u65b9\u5f0f\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002\u901a\u5e38\u7528\u4e8eSSL\u52a0\u5bc6\u670d\u52a1\u5668\u7684\u94fe\u63a5\u4e0e\u975e\u52a0\u5bc6\u7684HTTP\u4ee3\u7406\u670d\u52a1\u5668\u7684\u901a\u4fe1\u3002\\r\\n\\r\\n## \u5e38\u7528\u8bf7\u6c42\u5934\u4fe1\u606f\\r\\n\\r\\n**\u8bf7\u6c42\u5934\u90e8\u7531\u5173\u952e\u5b57/\u503c\u5bf9\u7ec4\u6210\uff0c\u6bcf\u884c\u4e00\u5bf9**\\r\\n\\r\\n### \u5178\u578b\u7684\u8bf7\u6c42\u5934\u6709\uff1a\\r\\n\\r\\n\u25cf User-Agent\uff1a\u4ea7\u751f\u8bf7\u6c42\u7684\u6d4f\u89c8\u5668\u7c7b\u578b;\\r\\n\\r\\n\u25cf Accept\uff1a\u5ba2\u6237\u7aef\u53ef\u8bc6\u522b\u7684\u54cd\u5e94\u5185\u5bb9\u7c7b\u578b\u5217\u8868;\u661f\u53f7 \u201c * \u201d \u7528\u4e8e\u6309\u8303\u56f4\u5c06\u7c7b\u578b\u5206\u7ec4\uff0c\u7528 \u201c */* \u201d \u6307\u793a\u53ef\u63a5\u53d7\u5168\u90e8\u7c7b\u578b\uff0c\u7528\u201c type/* \u201d\u6307\u793a\u53ef\u63a5\u53d7 type \u7c7b\u578b\u7684\u6240\u6709\u5b50\u7c7b\u578b; \u6bd4\u5982 Accept\uff1atext/xml\uff08application/json\uff09\u8868\u793a\u5e0c\u671b\u63a5\u53d7\u5230\u7684\u662fxml\uff08json\uff09\u7c7b\u578b\u3002\\r\\n\\r\\n\u25cf Accept-Language\uff1a\u5ba2\u6237\u7aef\u53ef\u63a5\u53d7\u7684\u81ea\u7136\u8bed\u8a00;\\r\\n\\r\\n\u25cf Accept-Encoding\uff1a\u5ba2\u6237\u7aef\u53ef\u63a5\u53d7\u7684\u7f16\u7801\u538b\u7f29\u683c\u5f0f;\\r\\n\\r\\n\u25cf Accept-Charset\uff1a\u53ef\u63a5\u53d7\u7684\u5e94\u7b54\u7684\u5b57\u7b26\u96c6;\\r\\n\\r\\n\u25cf Host\uff1a\u8bf7\u6c42\u7684\u4e3b\u673a\u540d\uff0c\u5141\u8bb8\u591a\u4e2a\u57df\u540d\u540c\u5904\u4e00\u4e2aIP \u5730\u5740\uff0c\u5373\u865a\u62df\u4e3b\u673a;\\r\\n\\r\\n\u25cf connection\uff1a\u8fde\u63a5\u65b9\u5f0f(close \u6216 keepalive);\\r\\n\\r\\n\u25cf Cookie\uff1a\u5b58\u50a8\u4e8e\u5ba2\u6237\u7aef\u6269\u5c55\u5b57\u6bb5\uff0c\u5411\u540c\u4e00\u57df\u540d\u7684\u670d\u52a1\u7aef\u53d1\u9001\u5c5e\u4e8e\u8be5\u57df\u7684cookie;\\r\\n\\r\\n\u25cf Content-Type\uff1a\u53d1\u9001\u7aef\u53d1\u9001\u7684\u5b9e\u4f53\u6570\u636e\u7684\u6570\u636e\u7c7b\u578b\u3002 \u6bd4\u5982\uff0cContent-Type\uff1atext/html\uff08application/json\uff09\u8868\u793a\u53d1\u9001\u7684\u662fhtml\u7c7b\u578b\u3002\\r\\n\\r\\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa90ec2b2edf46cb8de233c0b944b118~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)\\r\\n\\r\\n### Content-Type\uff1a\\r\\n\\r\\n| Content-Type                      | \u89e3\u91ca                                                         |\\r\\n| --------------------------------- | ------------------------------------------------------------ |\\r\\n| text/html                         | html\u683c\u5f0f                                                     |\\r\\n| text/plain                        | \u7eaf\u6587\u672c\u683c\u5f0f                                                   |\\r\\n| text/css                          | CSS\u683c\u5f0f                                                      |\\r\\n| text/javascript                   | js\u683c\u5f0f                                                       |\\r\\n| image/gif                         | gif\u56fe\u7247\u683c\u5f0f                                                  |\\r\\n| image/jpeg                        | jpg\u56fe\u7247\u683c\u5f0f                                                  |\\r\\n| image/png                         | png\u56fe\u7247\u683c\u5f0f                                                  |\\r\\n| application/x-www-form-urlencoded | POST\u4e13\u7528\uff1a\u666e\u901a\u7684\u8868\u5355\u63d0\u4ea4\u9ed8\u8ba4\u662f\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u3002form\u8868\u5355\u6570\u636e\u88ab\u7f16\u7801\u4e3akey/value\u683c\u5f0f\u53d1\u9001\u5230\u670d\u52a1\u5668\u3002 |\\r\\n| application/json                  | POST\u4e13\u7528\uff1a\u7528\u6765\u544a\u8bc9\u670d\u52a1\u7aef\u6d88\u606f\u4e3b\u4f53\u662f\u5e8f\u5217\u5316\u540e\u7684 JSON \u5b57\u7b26\u4e32     |\\r\\n| text/xml                          | POST\u4e13\u7528\uff1a\u53d1\u9001xml\u6570\u636e                                        |\\r\\n| multipart/form-data               | POST\u4e13\u7528\uff1a\u4e0b\u9762\u8bb2\u89e3                                           |\\r\\n\\r\\n**multipart/form-data**\u7528\u4ee5\u652f\u6301\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5728 POST \u8bf7\u6c42\u4e2d\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20\u7b49\u529f\u80fd\\r\\n\\r\\n\u8bf7\u6c42\u4f53\uff1a\\r\\n\\r\\nGET\u6ca1\u6709\u8bf7\u6c42\u6570\u636e\uff0cPOST\u6709\u3002\\r\\n\\r\\n\u4e0e\u8bf7\u6c42\u6570\u636e\u76f8\u5173\u7684\u6700\u5e38\u4f7f\u7528\u7684\u8bf7\u6c42\u5934\u662f Content-Type \u548c Content-Length \u3002\\r\\n\\r\\n## \u72b6\u6001\u7801\u53ca\u5206\u7c7b\\r\\n\\r\\n#### \u72b6\u6001\u7801\uff1a\u75313\u4f4d\u6570\u5b57\u7ec4\u6210\uff0c\u7b2c\u4e00\u4e2a\u6570\u5b57\u5b9a\u4e49\u4e86\u54cd\u5e94\u7684\u7c7b\u522b\\r\\n\\r\\n1xx\uff1a\u6307\u793a\u4fe1\u606f\uff0c\u8868\u793a\u8bf7\u6c42\u5df2\u63a5\u6536\uff0c\u7ee7\u7eed\u5904\u7406\\r\\n\\r\\n2xx\uff1a\u6210\u529f\uff0c\u8868\u793a\u8bf7\u6c42\u5df2\u88ab\u6210\u529f\u63a5\u53d7\uff0c\u5904\u7406\u3002\\r\\n\\r\\n- 200 OK\uff1a\u5ba2\u6237\u7aef\u8bf7\u6c42\u6210\u529f\\r\\n- 204 No Content\uff1a\u65e0\u5185\u5bb9\u3002\u670d\u52a1\u5668\u6210\u529f\u5904\u7406\uff0c\u4f46\u672a\u8fd4\u56de\u5185\u5bb9\u3002\u4e00\u822c\u7528\u5728\u53ea\u662f\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u4fe1\u606f\uff0c\u800c\u670d\u52a1\u5668\u4e0d\u7528\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u4ec0\u4e48\u4fe1\u606f\u7684\u60c5\u51b5\u3002\u4e0d\u4f1a\u5237\u65b0\u9875\u9762\u3002\\r\\n- 206 Partial Content\uff1a\u670d\u52a1\u5668\u5df2\u7ecf\u5b8c\u6210\u4e86\u90e8\u5206GET\u8bf7\u6c42\uff08\u5ba2\u6237\u7aef\u8fdb\u884c\u4e86\u8303\u56f4\u8bf7\u6c42\uff09\u3002\u54cd\u5e94\u62a5\u6587\u4e2d\u5305\u542bContent-Range\u6307\u5b9a\u8303\u56f4\u7684\u5b9e\u4f53\u5185\u5bb9\\r\\n\\r\\n3xx\uff1a\u91cd\u5b9a\u5411\\r\\n\\r\\n- 301 Moved Permanently\uff1a\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u5df2\u7ecf\u6c38\u4e45\u7684\u642c\u5230\u4e86\u5176\u4ed6\u4f4d\u7f6e\u3002\\r\\n- 302 Found\uff1a\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u4e34\u65f6\u642c\u5230\u4e86\u5176\u4ed6\u4f4d\u7f6e\\r\\n- 303 See Other\uff1a\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u5e94\u4f7f\u7528GET\u5b9a\u5411\u83b7\u53d6\u8bf7\u6c42\u8d44\u6e90\u3002303\u529f\u80fd\u4e0e302\u4e00\u6837\uff0c\u533a\u522b\u53ea\u662f303\u660e\u786e\u5ba2\u6237\u7aef\u5e94\u8be5\u4f7f\u7528GET\u8bbf\u95ee\\r\\n- 307 Temporary Redirect\uff1a\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u548c302\u6709\u7740\u76f8\u540c\u542b\u4e49\u3002POST\u4e0d\u4f1a\u53d8\u6210GET\\r\\n- 304 Not Modified\uff1a\u8868\u793a\u5ba2\u6237\u7aef\u53d1\u9001\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\uff08GET\u65b9\u6cd5\u8bf7\u6c42\u62a5\u6587\u4e2d\u7684IF\u2026\uff09\u65f6\uff0c\u6761\u4ef6\u4e0d\u6ee1\u8db3\u3002\u8fd4\u56de304\u65f6\uff0c\u4e0d\u5305\u542b\u4efb\u4f55\u54cd\u5e94\u4e3b\u4f53\u3002\u867d\u7136304\u88ab\u5212\u5206\u57283XX\uff0c\u4f46\u548c\u91cd\u5b9a\u5411\u4e00\u6bdb\u94b1\u5173\u7cfb\u90fd\u6ca1\u6709\\r\\n\\r\\n**\u4e00\u4e2a304\u7684\u4f7f\u7528\u573a\u666f\uff1a** \u7f13\u5b58\u670d\u52a1\u5668\u5411\u670d\u52a1\u5668\u8bf7\u6c42\u67d0\u4e00\u4e2a\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u62a5\u6587\u5177\u6709\u8fd9\u6837\u7684\u5b57\u6bb5\uff1aLast-Modified:Wed,7 Sep 2011 09:23:24\uff0c\u7f13\u5b58\u5668\u4f1a\u4fdd\u5b58\u8fd9\u4e2a\u8d44\u6e90\u7684\u540c\u65f6\uff0c\u4fdd\u5b58\u5b83\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002\u4e0b\u6b21\u7528\u6237\u5411\u7f13\u5b58\u5668\u8bf7\u6c42\u8fd9\u4e2a\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u7f13\u5b58\u5668\u9700\u8981\u786e\u5b9a\u8fd9\u4e2a\u8d44\u6e90\u662f\u65b0\u7684\uff0c\u90a3\u4e48\u5b83\u4f1a\u5411\u539f\u59cb\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2aHTTP\u8bf7\u6c42\uff08GET\u65b9\u6cd5\uff09\uff0c\u5e76\u5728\u8bf7\u6c42\u5934\u90e8\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u5b57\u6bb5\uff1aIf-Modified-Since:Wed,7 Sep 2011 09:23:24\uff0c\u8fd9\u4e2a\u503c\u5c31\u662f\u4e0a\u6b21\u670d\u52a1\u5668\u53d1\u9001\u7684\u54cd\u5e94\u62a5\u6587\u4e2d\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002\\r\\n\\r\\n\u5047\u8bbe\u8fd9\u4e2a\u8d44\u6e90\u6ca1\u6709\u88ab\u4fee\u6539\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\u62a5\u6587\uff1a\\r\\n\\r\\n```http\\r\\n    HTTP/1.1 304 Not Modified\\r\\n    Date\uff1aSat, 15 Oct 2011 15:39:29\\r\\n    (\u7a7a\u884c)                                      \\r\\n    (\u7a7a\u54cd\u5e94\u4f53)\\r\\n```\\r\\n\\r\\n\\r\\n\\r\\n## \u5185\u5bb9\u7c7b\u578b\u548c\u7f51\u7edc\u6587\u4ef6\u7c7b\u578b\\r\\n\\r\\n- `text/html` \uff1a HTML\u683c\u5f0f\\r\\n- `text/plain` \uff1a\u7eaf\u6587\u672c\u683c\u5f0f\\r\\n- `text/xml` \uff1a XML\u683c\u5f0f\\r\\n- `image/gif` \uff1agif\u56fe\u7247\u683c\u5f0f\\r\\n- `image/jpeg` \uff1ajpg\u56fe\u7247\u683c\u5f0f\\r\\n- `image/png`\uff1apng\u56fe\u7247\u683c\u5f0f\\r\\n\\r\\n-  `application/xhtml+xml` \uff1aXHTML\u683c\u5f0f\\r\\n\\r\\n- `application/xml`\uff1a XML\u6570\u636e\u683c\u5f0f\\r\\n\\r\\n- `application/atom+xml` \uff1aAtom XML\u805a\u5408\u683c\u5f0f\\r\\n\\r\\n- `application/json`\uff1a JSON\u6570\u636e\u683c\u5f0f\\r\\n\\r\\n- `application/pdf`\uff1apdf\u683c\u5f0f\\r\\n\\r\\n- `application/msword` \uff1a Word\u6587\u6863\u683c\u5f0f\\r\\n\\r\\n- `application/octet-stream` \uff1a \u4e8c\u8fdb\u5236\u6d41\u6570\u636e\uff08\u5982\u5e38\u89c1\u7684\u6587\u4ef6\u4e0b\u8f7d\uff09\\r\\n\\r\\n- `application/x-www-form-urlencoded` \uff1a `<form encType=\u201d\u201d>`\u4e2d\u9ed8\u8ba4\u7684encType\uff0cform\u8868\u5355\u6570\u636e\u88ab\u7f16\u7801\u4e3akey/value\u683c\u5f0f\u53d1\u9001\u5230\u670d\u52a1\u5668\uff08\u8868\u5355\u9ed8\u8ba4\u7684\u63d0\u4ea4\u6570\u636e\u7684\u683c\u5f0f\uff09\\r\\n\\r\\n\\r\\n\\r\\nhttps\u534f\u8bae\u5b9e\u9645\u4e0a\u548chttp\u534f\u8bae"},{"id":"github action ci","metadata":{"permalink":"/festudy/blog/github action ci","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/\u4e00\u4e2a\u7b80\u5355\u7684GitHub Action\u4f7f\u7528\u6559\u7a0b.md","source":"@site/blog/\u4e00\u4e2a\u7b80\u5355\u7684GitHub Action\u4f7f\u7528\u6559\u7a0b.md","title":"\u4e00\u4e2a\u7b80\u5355\u7684 Github Action \u4f7f\u7528\u6559\u7a0b","description":"\u4e00\u4e2a\u7b80\u5355\u7684 Github Action \u4f7f\u7528\u6559\u7a0b","date":"2023-09-28T09:34:51.000Z","formattedDate":"September 28, 2023","tags":[{"label":"cli","permalink":"/festudy/blog/tags/cli"}],"readingTime":5.185,"hasTruncateMarker":false,"authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"frontMatter":{"title":"\u4e00\u4e2a\u7b80\u5355\u7684 Github Action \u4f7f\u7528\u6559\u7a0b","description":"\u4e00\u4e2a\u7b80\u5355\u7684 Github Action \u4f7f\u7528\u6559\u7a0b","slug":"github action ci","authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"tags":["cli"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"HTTP\u534f\u8bae","permalink":"/festudy/blog/http\u534f\u8bae"},"nextItem":{"title":"\u4ece\u96f6\u5f00\u53d1\u4e00\u6b3e\u81ea\u5df1\u7684\u811a\u624b\u67b6","permalink":"/festudy/blog/cli"}},"content":"## \u7b80\u4ecb\\n\\n- \u4f1a\u5e26\u4f60\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u4e2a\u4eba\u535a\u5ba2\uff1f\\n\\n- \u4f7f\u7528`docusaurus` + `Github Pages` + `Github Action` + `vercel`\\n\\n## \u8fc7\u7a0b\\n\\n1. \u5728\u5408\u9002\u7684\u4f4d\u7f6e\u521d\u59cb\u5316`docusaurus`\u9879\u76ee\uff0c`my-website-demo`\u662f\u9879\u76ee\u540d\u79f0\uff0c\u53ef\u81ea\u5b9a\u4e49\\n\\n```shell\\npnpm dlx create-docusaurus@latest my-website-demo classic\\nnpx create-docusaurus@latest my-website-demo classic\\n\\ncd my-website-demo\\ncode .\\n```\\n\\n2. \u8fd0\u884c`pnpm start`\u67e5\u770b\u6548\u679c\\n\\n![image-20230721231649676](./img/github-action/image-20230721231649676.png)\\n\\n3. \u5c06\u672c\u5730\u9879\u76ee\u4e0a\u4f20\u81f3`github`\\n\\n\u8fd9\u4e00\u6b65\u4e0d\u9700\u8981\u8bf4\u4ec0\u4e48\u5427\u3002\\n\\n4. \u521b\u5efa\u4e00\u4e2a\u81ea\u5df1\u7528\u6237\u540d + `.github.io`\u4e3a\u540d\u79f0\u7684`special repository ` \u6765\u4f7f\u7528 `Github Pages`\uff0c\u6bd4\u5982\u6211\u7684 GitHub \u7528\u6237\u540d\u4e3a chovrio\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4ed3\u5e93\u540d\u5c31\u53eb`chovrio.github.io`\\n\\n5. \u521b\u5efa\u4ee4\u724c\\n\\n   1. \u6253\u5f00 GitHub\uff0c\u70b9\u51fb\u53f3\u4e0a\u89d2\u81ea\u5df1\u7684\u5934\u50cf\uff0c\u70b9\u51fb settings\\n\\n   ![image-20230721233501316](./img/github-action/image-20230721233501316.png)\\n\\n   2. \u70b9\u51fb\u5de6\u4e0b\u89d2 `developer settings`\\n\\n   ![image-20230721233519552](./img/github-action/image-20230721233519552.png)\\n\\n   3. \u5728\u5de6\u4fa7\u8fb9\u680f\u4e2d\uff0c\u5355\u51fb `Personal access tokens\uff08\u4e2a\u4eba\u8bbf\u95ee\u4ee4\u724c\uff09`\u3002\\n\\n   4. \u5355\u51fb `Generate new token\uff08\u751f\u6210\u65b0\u4ee4\u724c\uff09`\u751f\u6210\u7ecf\u5178\u7684 tokens\uff0c\u4e0d\u8981\u9009\u62e9\u7ec6\u7c92\u5316\u7684\u3002![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](./img/github-action/0c30036f-1205-4a53-a9d3-76d2837ce688.png)\\n\\n   5. \u8f93\u5165\u540d\u79f0\u5e76\u52fe\u9009 `repo`\\n\\n      ![image-20230721234753466](./img/github-action/image-20230721234753466.png)\\n\\n   6. \u62c9\u5230\u6700\u4e0b\u9762\uff0c\u70b9\u51fb `Generate token`\uff0c\u5e76\u5c06\u751f\u6210\u7684 token \u4fdd\u5b58\u8d77\u6765\\n\\n      ![image-token](./img/github-action/image-token.png)\\n\\n      ![image-20230721235002716](./img/github-action/image-20230721235002716.png)\\n\\n   7. \u6253\u5f00\u4f60\u7684 Github \u9879\u76ee\uff0c\u70b9\u51fb `settings`\uff0c\u70b9\u51fb `Secrets and variables`->`Actions` -> `new repository secret`\u3002\\n\\n      1. \u586b\u5199\u540d\u79f0\u548c`Secret`\\n\\n      ![image-20230721235151996](./img/github-action/image-20230721235151996.png)\\n\\n      2. \u70b9\u51fb `Add secret`\\n\\n6. \u521b\u5efa\u65b0\u6587\u4ef6`my-website-demo/.github/workflows/main.yml`\\n\\n- \u666e\u901a\u7248\u672c\\n  - `Github Pages`\u4e0d\u8003\u8651\u90e8\u7f72\u5176\u5b83\u9759\u6001\u9875\u9762\uff0c\u901a\u8fc7`https://[username].github.io/` \u76f4\u63a5\u8bbf\u95ee\u8be5\u9875\u9762\\n\\n```yaml\\n# \u6784\u5efa\u7684\u540d\u79f0\uff0c\u968f\u610f\\nname: Build and Deploy\\non: # \u76d1\u542c main \u5206\u652f\u4e0a\u7684 push \u4e8b\u4ef6\\n  push:\\n    branches:\\n      - main\\njobs:\\n  build-and-deploy:\\n    runs-on: ubuntu-latest # \u6784\u5efa\u73af\u5883\u4f7f\u7528 ubuntu\\n    steps:\\n      - name: Checkout\\n        uses: actions/checkout@v3\\n        with:\\n          persist-credentials: false\\n\\n      - name: Install and Build # \u4e0b\u8f7d\u4f9d\u8d56 \u6253\u5305\u9879\u76ee\\n        run: |\\n          # \u521d\u59cb\u5316docusaurus\u7528\u7684\u4ec0\u4e48\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5c31\u4fdd\u7559\u54ea\u4e00\u4e2a\\n          # \u7528 npm\\t\\n          npm install\\n          npm run build\\n          # \u7528 pnpm\\n          npm install pnpm -g\\n          pnpm install\\n          pnpm run build\\n      - name: Deploy # \u5c06\u6253\u5305\u5185\u5bb9\u53d1\u5e03\u5230 github page\\n        uses: JamesIves/github-pages-deploy-action@v4 # \u4f7f\u7528\u522b\u4eba\u5199\u597d\u7684 actions\\n        with: # \u81ea\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\\n          token: ${{ secrets.DEPLOY_KEY }} # DEPLOY_KEY \u662f\u6211\u7684 secret \u540d\u79f0\uff0c\u9700\u8981\u66ff\u6362\u6210\u4f60\u7684\\n          branch: main\\n          folder: build\\n          repository-name: chovrio/chovrio.github.io # \u8fd9\u662f\u6211\u7684 github page \u4ed3\u5e93\\n          target-folder: / # \u6253\u5305\u7684\u6587\u4ef6\u5c06\u653e\u5230\u6839\u76ee\u5f55\u4e0b\\n```\\n\\n- \u7279\u6b8a\u7248\u672c\\n\\n  - `Github Pages`\u4e0b\u8fd8\u60f3\u5b58\u653e\u5176\u5b83\u7684\u9759\u6001\u9875\u9762\\n\\n  ```yaml\\n  name: Build and Deploy\\n  on: # \u76d1\u542c main \u5206\u652f\u4e0a\u7684 push \u4e8b\u4ef6\\n    push:\\n      branches:\\n        - main\\n  # \u73af\u5883\u53d8\u91cf\uff0c\u6784\u5efa\u65f6\u4f1a\u6ce8\u5165 process.env.DEPLOYMENT_ENV\uff0c\u56e0\u4e3a\u540e\u7eed\u540c\u65f6\u4f1a\u90e8\u7f72\u5728vercel\u4e0a\uff0c\u901a\u8fc7\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\u533a\u5206 vercel \u73af\u5883\u548c github action \u73af\u5883\\n  env:\\n    DEPLOYMENT_ENV: \'chovrio.github.io\'\\n  jobs:\\n    build-and-deploy:\\n      runs-on: ubuntu-latest # \u6784\u5efa\u73af\u5883\u4f7f\u7528 ubuntu\\n      steps:\\n        - name: Checkout\\n          uses: actions/checkout@v3\\n          with:\\n            persist-credentials: false\\n\\n        - name: Install and Build # \u4e0b\u8f7d\u4f9d\u8d56 \u6253\u5305\u9879\u76ee\\n          run: |\\n            npm install\\n            npm run build\\n        - name: Deploy # \u5c06\u6253\u5305\u5185\u5bb9\u53d1\u5e03\u5230 github page\\n          uses: JamesIves/github-pages-deploy-action@v4 # \u4f7f\u7528\u522b\u4eba\u5199\u597d\u7684 actions\\n          with: # \u81ea\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\\n            token: ${{ secrets.DEPLOY_KEY }} # DEPLOY_KEY \u662f\u6211\u7684 secret \u540d\u79f0\uff0c\u9700\u8981\u66ff\u6362\u6210\u4f60\u7684\\n            branch: main\\n            folder: build\\n            repository-name: chovrio/chovrio.github.io # \u8fd9\u662f\u6211\u7684 github page \u4ed3\u5e93\\n            target-folder: docusaurus-demo # \u6253\u5305\u7684\u6587\u4ef6\u5c06\u653e\u5230GitHub Pages\u7684docusaurus-demo \u76ee\u5f55\u4e0b\\n  ```\\n\\n  - \u4fee\u6539`docusaurus.config.js`\u7684\u90e8\u5206\u4ee3\u7801\\n\\n  ```js\\n  let favicon, baseUrl;\\n  if (process.env.NODE_ENV === \\"development\\") {\\n    favicon = \\"img/favicon.ico\\";\\n    baseUrl = \\"/\\";\\n  } else {\\n    if (process.env.DEPLOYMENT_ENV === \\"chovrio.github.io\\") {\\n      favicon = \\"/img/favicon.ico\\";\\n      // \u8fd9\u4e2a\u5730\u65b9\u7684 url \u5fc5\u987b\u548cyml\u6587\u4ef6\u91cc\u9762\u7684\u76ee\u5f55\u4e00\u6837\\n      baseUrl = \\"docusaurus-demo\\";\\n    } else {\\n      favicon = \\"img/favicon.ico\\";\\n      baseUrl = \\"/\\";\\n    }\\n  }\\n  const config = {\\n      ...\\n      favicon,\\n      baseUrl,\\n      ...\\n  }\\n  ```\\n\\n8. \u63d0\u4ea4\u4ee3\u7801\u5230`github`\u4ed3\u5e93\uff0c\u5728\u4ed3\u5e93\u7684`Actions`\u9875\u9762\u53ef\u4ee5\u770b\u5230\u6784\u5efa\u6d41\u7a0b\u3002\\n\\n![image-20230722000454612](./img/github-action/image-20230722000454612.png)\\n\\n9. \u8dd1\u5b8c ci \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5728\u81ea\u5df1\u7684`Github Pages`\u4e0a\u4f1a\u51fa\u73b0\u4e00\u4e9b\u4ee3\u7801\\n\\n![image-20230722000649814](./img/github-action/image-20230722000649814.png)\\n\\n10. \u6b64\u65f6\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u8fde\u63a5\u8bbf\u95ee\u81ea\u5df1\u7684\u7f51\u9875\\n\\n    - \u666e\u901a\u7248\uff1ahttps://[username].github.io/\\n      - \u7279\u6b8a\u7248\u672c\uff1ahttps://[username].github.io/docusaurus-demo/\\n\\n    ![image-20230722001223058](./img/github-action/image-20230722001223058.png)\\n\\n11. \u6211\u4eec\u518d\u4f7f\u7528[vercel](https://vercel.com/dashboard)\u90e8\u7f72\u8fd9\u4e2a\u7f51\u7ad9\\n\\n    1. \u767b\u5f55\u540e Add new project\uff0c\u627e\u5230\u521a\u521a\u90a3\u4e2a\u9879\u76ee \u70b9\u51fb import -> Deploy\\n    2. \u901a\u8fc7 vercel \u90e8\u7f72\u540e\u7684\u7f51\u5740\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u5230\u6211\u4eec\u7684\u9759\u6001\u9875\u9762\\n\\n    ![image-20230722001523705](./img/github-action/image-20230722001523705.png)\\n\\n\u6e90\u7801\\n\\n[my-website-demo](https://github.com/chovrio/my-website-demo)\\n\\n## \u6ce8\u610f\\n\\n[docusaurus](https://docusaurus.io/zh-CN/)\u662f\u4e00\u4e2a\u914d\u7f6e\u578b\u6781\u5f3a\u7684\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668\uff0c\u5982\u679c\u60f3\u8981\u6295\u5165\u4f7f\u7528\u53ef\u4ee5\u81ea\u5df1\u770b\u5b98\u65b9\u6587\u6863\uff0c\u53e6\u5916\uff0c\u6b64\u6559\u7a0b\u76ee\u7684\u4ec5\u4ec5\u662f\u4e00\u70b9\u70b9\u7b80\u5355\u7684 GitHub Actions\uff0c\u5982\u679c\u60f3\u641e\u4e2a\u4eba\u535a\u5ba2\uff0chexo\uff0cvitepress\uff0cvuepress \u7b49\u7b49\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668\u90fd\u662f\u5f88\u4e0d\u9519\u7684\u9009\u62e9\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u81ea\u5df1\u624b\u6413\u3002"},{"id":"cli","metadata":{"permalink":"/festudy/blog/cli","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/\u4ece\u96f6\u5f00\u53d1\u4e00\u6b3e\u81ea\u5df1\u7684\u811a\u624b\u67b6.md","source":"@site/blog/\u4ece\u96f6\u5f00\u53d1\u4e00\u6b3e\u81ea\u5df1\u7684\u811a\u624b\u67b6.md","title":"\u4ece\u96f6\u5f00\u53d1\u4e00\u6b3e\u81ea\u5df1\u7684\u811a\u624b\u67b6","description":"\u8fd9\u662f\u6211\u5173\u4e8e\u811a\u624b\u67b6\u5f00\u53d1\u7684\u7b2c\u4e00\u7bc7\u535a\u6587\u3002","date":"2023-09-28T09:34:51.000Z","formattedDate":"September 28, 2023","tags":[{"label":"cli","permalink":"/festudy/blog/tags/cli"}],"readingTime":18.36,"hasTruncateMarker":false,"authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"frontMatter":{"title":"\u4ece\u96f6\u5f00\u53d1\u4e00\u6b3e\u81ea\u5df1\u7684\u811a\u624b\u67b6","description":"\u8fd9\u662f\u6211\u5173\u4e8e\u811a\u624b\u67b6\u5f00\u53d1\u7684\u7b2c\u4e00\u7bc7\u535a\u6587\u3002","slug":"cli","authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"tags":["cli"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"\u4e00\u4e2a\u7b80\u5355\u7684 Github Action \u4f7f\u7528\u6559\u7a0b","permalink":"/festudy/blog/github action ci"},"nextItem":{"title":"\u624b\u5199\u524d\u7aef\u57cb\u70b9sdk","permalink":"/festudy/blog/tracker sdk"}},"content":"## \u524d\u8a00\\r\\n\\r\\n\u4e00\u4e2a\u666e\u666e\u901a\u901a\u7684\u811a\u624b\u67b6\uff0c\u5305\u542b\u90e8\u5206\u5bf9\u5de5\u7a0b\u5316\uff0crollup \u7684\u8fd0\u7528\uff0c\u4ee5\u53ca\u4e00\u4e24\u4e2a\u4e2a\u4eba\u89c9\u5f97\u633a\u597d\u7528\u7684\u5c0f\u529f\u80fd\\r\\n\\r\\n## \u6e90\u7801\\r\\n\\r\\n[chovrio-cli](https://github.com/chovrio/chovrio-cli)\\r\\n\\r\\n[demo-cli](https://github.com/chovrio/demo-cli)\\r\\n\\r\\n## \u9879\u76ee\u5f00\u53d1\u73af\u5883\u642d\u5efa\\r\\n\\r\\n**\u5feb\u901f\u5f00\u53d1\u53ef\u4ee5\u8003\u8651\u8bd5\u4e00\u8bd5 modernjs \u4e0d\u7528\u81ea\u5df1\u642d\u5efa\u73af\u5883**\\r\\n\\r\\n### \u9996\u5148\u521b\u5efa\u6587\u4ef6\u5939\u5e76\u7528`vscode`\u6253\u5f00\\r\\n\\r\\n```shell\\r\\nmkdir cli-demo # \u521b\u5efa\u9879\u76ee\u6587\u4ef6\u5939\\r\\ncd cli-demo # \u8fdb\u5165\u9879\u76ee\u6587\u4ef6\u5939\\r\\ncode . # \u4f7f\u7528vscode\u6253\u5f00(\u5982\u679c\u5b89\u88c5vscode\u7684\u65f6\u5019\u6ca1\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u53ef\u80fd\u4f1a\u62a5\u9519\uff0c\u624b\u52a8\u6253\u5f00\u4e5f\u53ef)\\r\\npnpm init # \u751f\u6210package.json\u6587\u4ef6\\r\\nmkdir packages # \u521b\u5efa\u5305\u6587\u4ef6\u5939(\u8981\u91c7\u7528monorepo\u7684\u65b9\u5f0f\u8fdb\u884c\u7ba1\u7406)\\r\\ncd packages\\r\\nmkdir chovrio # \u521b\u5efa\u811a\u624b\u67b6\u6587\u4ef6\u5939\\r\\nmkdir plugins # \u521b\u5efa\u63d2\u4ef6\u6587\u4ef6\u5939\\r\\ncd chovrio\\r\\npnpm init\\r\\ncd ..\\r\\ncd plugins\\r\\npnpm init\\r\\n```\\r\\n\\r\\n\u5f00\u59cb\u642d\u5efa\u5f00\u53d1\u73af\u5883\uff0c\u9996\u5148\u6211\u4eec\u8981\u4ece\u4e00\u5f00\u59cb\u5c31\u660e\u786e\u6280\u672f\u6808\uff0c\u6211\u8fd9\u91cc\u91c7\u7528\u7684\u662f rollup + typescript \u5e76\u4e14\u4ee5 monorepo \u7684\u65b9\u5f0f\u8fdb\u884c\u7ba1\u7406(\u867d\u7136\u6682\u65f6\u6ca1\u60f3\u8981\u5199 plugin\uff0c\u5177\u4f53\u539f\u56e0\u6587\u4e2d\u5e94\u8be5\u4f1a\u8bf4\u5230)\u3002\\r\\n\\r\\n### \u5de5\u7a0b\u5316\\r\\n\\r\\n#### eslint\\r\\n\\r\\n```shell\\r\\npnpm add typescript @types/node -D\\r\\npnpm add eslint -D\\r\\nnpx eslint --init\\r\\n```\\r\\n\\r\\n\u4e0b\u9762\u662f\u6211\u7684\u4e00\u4e9b\u914d\u7f6e\\r\\n\\r\\n![image-20230312193314090](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230312193314090.png)\\r\\n\\r\\n#### prettier\\r\\n\\r\\n\u5b89\u88c5\\r\\n\\r\\n```shell\\r\\npnpm add prettier eslint-config-prettier eslint-plugin-prettier -D\\r\\n```\\r\\n\\r\\n\u521b\u5efa`.prettierrc`\u6587\u4ef6\\r\\n\\r\\n```.prettierrc\\r\\n// \u4e00\u4e9b\u914d\u7f6e,\u53ef\u81ea\u5b9a\u4e49\\r\\n{\\r\\n  \\"semi\\": false,\\r\\n  \\"tabWidth\\": 2,\\r\\n  \\"trailingComma\\": \\"none\\",\\r\\n  \\"singleQuote\\": true,\\r\\n  \\"arrowParens\\": \\"avoid\\"\\r\\n}\\r\\n```\\r\\n\\r\\n\u914d\u7f6e\u53c2\u8003 [prettier \u5b98\u7f51](https://prettier.io/docs/en/configuration.html) [\u6398\u91d1\u6587\u7ae0](https://juejin.cn/post/6938687606687432740)\\r\\n\\r\\n#### git \u63d0\u4ea4\u89c4\u8303\\r\\n\\r\\n```shell\\r\\npnpm add lint-staged husky -D\\r\\npnpm pkg set scripts.prepare=\\"husky install\\"\\r\\n```\\r\\n\\r\\n\u521b\u5efa`.gitignore`\u6587\u4ef6\\r\\n\\r\\n```.gitignode\\r\\nnode_modules\\r\\n```\\r\\n\\r\\n```shell\\r\\ngit init\\r\\npnpm prepare # \u521d\u59cb\u5316husky\\r\\nnpx husky add .husky/pre-commit \\"npx lint-staged\\"\\r\\n```\\r\\n\\r\\n**pre-commit** \u65f6\u6267\u884c **npx lint-staged** \u6307\u4ee4\\r\\n\\r\\n\u6839\u76ee\u5f55\u521b\u5efa **.lintstagedrc.json** \u6587\u4ef6\u63a7\u5236\u68c0\u67e5\u548c\u64cd\u4f5c\u65b9\u5f0f\\r\\n\\r\\n```lintstagedrc.json\\r\\n{\\r\\n    \\"*.{js,jsx,ts,tsx}\\": [\\"prettier --write .\\", \\"eslint  --fix\\"],\\r\\n    \\"*.md\\": [\\"prettier --write\\"]\\r\\n}\\r\\n```\\r\\n\\r\\n#### git \u63d0\u4ea4\u89c4\u8303:commitlint\\r\\n\\r\\n\u89c4\u8303\u4f9d\u8d56\\r\\n\\r\\n```shell\\r\\npnpm add commitlint @commitlint/config-conventional -D\\r\\nnpx husky add .husky/commit-msg \'npx --no-install commitlint --edit \\"$1\\"\'\\r\\n```\\r\\n\\r\\n\u9ed8\u8ba4\u662f angular \u7684\u63d0\u4ea4\u89c4\u8303\uff0c\u4e00\u822c\u9ed8\u8ba4\u5c31\u591f\u7528\u4e86\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\\r\\n\\r\\n\u8f85\u52a9\u63d0\u4ea4\u4f9d\u8d56\\r\\n\\r\\n```shell\\r\\npnpm add commitizen cz-conventional-changelog -D\\r\\npnpm pkg set scripts.commit=\\"git add . && git-cz\\" # package.json \u4e2d\u6dfb\u52a0 commit \u6307\u4ee4, \u6267\u884c `git-cz` \u6307\u4ee4\\r\\n```\\r\\n\\r\\n\u521b\u5efa\u6587\u4ef6`commitlint.config.ts` \u8fd9\u91cc\u91c7\u7528\u9ed8\u8ba4\u89c4\u8303\\r\\n\\r\\n```ts\\r\\nmodule.exports = {\\r\\n  extends: [\\"@commitlint/config-conventional\\"],\\r\\n};\\r\\n```\\r\\n\\r\\n\u6211\u4eec\u5728`packages/chovrio`\u4e0b\u65b0\u5efa`index.ts`\\r\\n\\r\\n```ts\\r\\nconsole.log(\\"hello world\\");\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\u6211\u4eec\u8fd0\u884c\u547d\u4ee4`pnpm commit`\\r\\n\\r\\n![image-20230313144433340](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313144433340.png)\\r\\n\\r\\n\u66f4\u591a\u8be6\u7ec6\u914d\u7f6e\u7684\u8bdd\u53ef\u4ee5\u53bb\u770b\u770b`lint-staged`\u3001`commitlint`\u3001`commitizen`\u7684\u6587\u6863\\r\\n\\r\\n### monorepo \u548c ts\\r\\n\\r\\n#### monorepo(\u867d\u7136\u56e0\u4e3a\u4e1c\u897f\u4e0d\u591a\uff0cmonorepo \u6ca1\u600e\u4e48\u7528\u4e0a\uff0c\u4f46\u8fd8\u662f\u5148\u5f04\u4e0a)\\r\\n\\r\\n\u5728\u6839\u76ee\u5f55\u65b0\u5efa\u6587\u4ef6`pnpm-workspace.yaml`\\r\\n\\r\\n```yaml\\r\\npackages:\\r\\n  - \\"packages/*\\"\\r\\n```\\r\\n\\r\\n\u4fee\u6539`chovrio`\u548c`plugins`\u4e0b\u7684`package.json`\u7684`name`\u5206\u522b\u4e3a`chovrio`\u548c`@chovrio/plugins`\\r\\n\\r\\n\u5728`chovrio`\u548c`plugins`\u6587\u4ef6\u5939\u4e0b\u90fd\u8fd0\u884c`npx tsc --init`\u751f\u6210`tsconfig.json`\u6587\u4ef6\\r\\n\\r\\n### Rollup \u96c6\u6210\\r\\n\\r\\n\u6211\u4eec\u5c31\u4e00\u6b65\u4e00\u6b65\u642d\u5efa\u5427\\r\\n\\r\\n#### rollup \u914d\u7f6e\u6587\u4ef6\\r\\n\\r\\n`-w`\u8868\u793a\u5b89\u88c5\u5230`workspace(\u6839\u5de5\u4f5c\u7a7a\u95f4)`\u7136\u540e\u9879\u76ee\u7684\u5b50\u5305\u90fd\u80fd\u4f7f\u7528\u8fd9\u4e2a\u4f9d\u8d56(\u4e0d\u77e5\u9053\u8fd9\u6837\u7406\u89e3\u6709\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898),\u5728\u54ea\u4e2a\u5305\u91cc\u9762\u5b89\u88c5\u90fd\u4f1a\u5b89\u88c5\u5230\u6839\u5305\\r\\n\\r\\n```shell\\r\\npnpm add rollup -wD\\r\\npnpm pkg set scripts.build=\\"rollup --config rollup.config.ts --configPlugin typescript\\" # \u914d\u7f6e\u63d2\u4ef6 typescript\\r\\ncd .\\\\packages\\\\chovrio\\\\\\r\\nmkdir src\\r\\ncd src\\r\\nmkdir core\\r\\nmkdir utils\\r\\nmkdir types\\r\\nmkdir command\\r\\n```\\r\\n\\r\\n\u5c06\u4e4b\u524d\u6d4b\u8bd5 git \u6d41\u7a0b\u65f6\u5728 chovrio \u76ee\u5f55\u4e0b\u7684\u521b\u5efa\u7684 index.ts \u6587\u4ef6\u79fb\u52a8\u5230 core \u76ee\u5f55\u91cc\u9762\u3002\\r\\n\\r\\n\u5728`chovrio`\u76ee\u5f55\u4e0b\u9762\u521b\u5efa`rollup.config.ts`\\r\\n\\r\\n```ts\\r\\nimport path from \\"path\\";\\r\\nimport { defineConfig } from \\"rollup\\";\\r\\n\\r\\nconst cliConfig = defineConfig({\\r\\n  // \u5165\u53e3\u6587\u4ef6\\r\\n  input: \\"./src/core/index.ts\\",\\r\\n  // \u8f93\u51fa\u76ee\u5f55\\r\\n  output: {\\r\\n    file: path.resolve(__dirname, \\"./dist/cli.js\\"),\\r\\n  },\\r\\n  // \u7528\u5230\u7684\u63d2\u4ef6\\r\\n  plugins: [],\\r\\n});\\r\\nexport default defineConfig([cliConfig]);\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\u6211\u4eec\u8fd0\u884c`pnpm build`\u4f1a\u53d1\u73b0\u4e0d\u80fd\u8bc6\u522b`rollup.config.ts`\\r\\n\\r\\n![image-20230313151813786](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313151813786.png)\\r\\n\\r\\n\u6211\u4eec\u4fee\u6539`tsconfig.json`\\r\\n\\r\\n```ts\\r\\n{\\r\\n  \\"extends\\": \\"./tsconfig.base.json\\",\\r\\n  // \u8fd9\u91cc\u544a\u8bc9typescript\u8981\u7f16\u8bd1rollup\u7684\u914d\u7f6e\u6587\u4ef6\\r\\n  \\"include\\": [\\"./rollup.config.ts\\"],\\r\\n  \\"compilerOptions\\": {\\r\\n    \\"esModuleInterop\\": true,\\r\\n    \\"declaration\\": false,\\r\\n    \\"resolveJsonModule\\": true\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u65b0\u5efa\u6587\u4ef6`tsconfig.base.json`\\r\\n\\r\\n```ts\\r\\n{\\r\\n  \\"compilerOptions\\": {\\r\\n    \\"target\\": \\"ES2020\\",\\r\\n    \\"module\\": \\"ESNext\\",\\r\\n    \\"moduleResolution\\": \\"node\\",\\r\\n    \\"strict\\": true,\\r\\n    \\"declaration\\": true,\\r\\n    \\"noImplicitOverride\\": true,\\r\\n    \\"noUnusedLocals\\": true,\\r\\n    \\"esModuleInterop\\": true,\\r\\n    \\"useUnknownInCatchVariables\\": false\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u8fd9\u91cc\u9009\u62e9\u5728 tsconfig.ts \u4e2d\u96c6\u6210 tsconfig.base.json \u662f\u4e3a\u4e86\u51cf\u5c11\u4ee3\u7801\u91cf\\r\\n\\r\\n\u8fd0\u884c`pnpm build`\u4f1a\u53d1\u73b0\u62a5\u9519\uff0c\u56e0\u4e3a\u6211\u4eec\u6253\u5305\u7684\u662f ts \u6587\u4ef6\uff0crollup \u9ed8\u8ba4\u53ea\u80fd\u6253\u5305 js \u6587\u4ef6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4e00\u4e9b\u63d2\u4ef6\u6765\u6269\u5c55 rollup \u7684\u529f\u80fd\\r\\n\\r\\n![image-20230313152646512](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313152646512.png)\\r\\n\\r\\n#### \u6253\u5305 ts \u6587\u4ef6\\r\\n\\r\\n```shell\\r\\npnpm add @rollup/plugin-typescript -wD\\r\\n```\\r\\n\\r\\n\u5b89\u88c5\u540e\u4fee\u6539`rollup.config.ts`\u6587\u4ef6\u5982\u4e0b\\r\\n\\r\\n```ts\\r\\nimport path from \\"path\\";\\r\\nimport ts from \\"@rollup/plugin-typescript\\";\\r\\nimport { defineConfig } from \\"rollup\\";\\r\\n\\r\\nconst cliConfig = defineConfig({\\r\\n  // \u5165\u53e3\u6587\u4ef6\\r\\n  input: \\"./src/core/index.ts\\",\\r\\n  // \u8f93\u51fa\u76ee\u5f55\\r\\n  output: {\\r\\n    file: path.resolve(__dirname, \\"./dist/cli.js\\"),\\r\\n  },\\r\\n  // \u7528\u5230\u7684\u63d2\u4ef6\\r\\n  plugins: [ts({ tsconfig: path.resolve(__dirname, \\"./tsconfig.json\\") })],\\r\\n});\\r\\nexport default defineConfig([cliConfig]);\\r\\n```\\r\\n\\r\\n\u518d\u6b21\u8fd0\u884c`pnpm build`\uff0c\u4f1a\u53d1\u73b0\u53c8\u62a5\u9519\u4e86\\r\\n\\r\\n![image-20230313153729486](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313153729486.png)\\r\\n\\r\\n\u56e0\u4e3a`__dirname`\u662f`commonjs`\u89c4\u8303\u91cc\u9762\u7684\uff0c\u5728`esmodule`\u4e2d\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u7528\u522b\u7684\u65b9\u5f0f\u4f7f\u7528`__dirname`\uff0c\u4e00\u884c\u5c31\u89e3\u51b3\u4e86\\r\\n\\r\\n```ts\\r\\nconst __dirname = fileURLToPath(new URL(\\".\\", import.meta.url));\\r\\n```\\r\\n\\r\\n\u6211\u60f3\u8fc7\u76f4\u63a5\u7528`process.cwd()`\u6765\u4ee3\u66ff`__dirname`\uff0c\u4f46\u662f\u6211\u53d1\u73b0\u7528`fileURLToPath`\u548c`URL`\u7684\u6bd4\u8f83\u591a\uff0c\u4e8e\u662f\u6211\u53bb\u95ee\u4e86\u95ee bing\ud83d\ude43\\r\\n\\r\\n![image-20230313155711738](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313155711738.png)\\r\\n\\r\\n\u518d\u6b21\u6253\u5305\u5c31\u80fd\u901a\u8fc7\u4e86\\r\\n\\r\\n![image-20230313155801693](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313155801693.png)\\r\\n\\r\\n#### \u538b\u7f29\u4ee3\u7801\u548c\u8bfb\u53d6 json \u6587\u4ef6\\r\\n\\r\\n\u6211\u4eec\u518d\u4f7f\u7528\u4e00\u4e2a\u63d2\u4ef6\u7528\u6765\u538b\u7f29\u6253\u5305\u540e\u7684\u4ee3\u7801\\r\\n\\r\\n```shell\\r\\npnpm add @rollup/plugin-terser @rollup/plugin-json -wD\\r\\n```\\r\\n\\r\\n```ts\\r\\nimport path from \\"path\\";\\r\\nimport { defineConfig } from \\"rollup\\";\\r\\nimport ts from \\"@rollup/plugin-typescript\\";\\r\\nimport terser from \\"@rollup/plugin-terser\\";\\r\\nimport json from \\"@rollup/plugin-json\\";\\r\\nimport { fileURLToPath } from \\"url\\";\\r\\nconst __dirname = fileURLToPath(new URL(\\".\\", import.meta.url));\\r\\nconst cliConfig = defineConfig({\\r\\n  // \u5165\u53e3\u6587\u4ef6\\r\\n  input: \\"./src/core/index.ts\\",\\r\\n  // \u8f93\u51fa\u76ee\u5f55\\r\\n  output: {\\r\\n    file: path.resolve(__dirname, \\"./dist/cli.js\\"),\\r\\n  },\\r\\n  // \u7528\u5230\u7684\u63d2\u4ef6\\r\\n  plugins: [\\r\\n    ts({ tsconfig: path.resolve(__dirname, \\"./tsconfig.json\\") }),\\r\\n    terser({\\r\\n      toplevel: true,\\r\\n    }),\\r\\n    json(),\\r\\n  ],\\r\\n});\\r\\nexport default defineConfig([cliConfig]);\\r\\n```\\r\\n\\r\\n```shell\\r\\npnpm pkg set scripts.build:dev=\\"rollup --config rollup.config.ts --configPlugin typescript --watch\\" # \u5f00\u53d1\u9636\u6bb5\u7684\u6253\u5305\u547d\u4ee4\\r\\n```\\r\\n\\r\\nrollup \u7684\u914d\u7f6e\u6682\u65f6\u5c31\u5230\u8fd9\u513f\u4e86\\r\\n\\r\\n### \u811a\u624b\u67b6\u5f00\u53d1\\r\\n\\r\\n\u811a\u624b\u67b6\u5f00\u53d1\u7684\u57fa\u7840\u5305\u633a\u591a\u7684\uff0c\u6211\u8fd9\u91cc\u9009\u62e9\u7684\u662f commander\uff0c\u6bd4\u8f83\u5927\u4f17\\r\\n\\r\\n\u6ce8\u610f\u8fd9\u4e2a\u547d\u4ee4\u662f\u5728 chovrio \u76ee\u5f55\u4e0b\u6267\u884c\u7684\u6ca1\u6709\u52a0`-w`\u8fd9\u4e2a\u4f9d\u8d56\u662f\u53ea\u6709 chovrio \u8fd9\u4e2a\u9879\u76ee\u4f7f\u7528\u7684\uff0c\u4e0d\u7528\u653e\u5728\u5de5\u4f5c\u7a7a\u95f4\u3002\\r\\n\\r\\nrollup \u7684\u63d2\u4ef6\u5565\u7684\u653e\u5728\u5de5\u4f5c\u7a7a\u95f4\u662f\u56e0\u4e3a\u5982\u679c\u8981\u5f00\u53d1\u5176\u5b83\u5305\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u5b50\u5305\u4e2d\u4f7f\u7528\uff0c\u4e0d\u7528\u518d\u6b21\u5b89\u88c5\u4f9d\u8d56\\r\\n\\r\\n```shell\\r\\npnpm add commander -D\\r\\npnpm build:dev\\r\\n```\\r\\n\\r\\n\u6211\u4eec\u5148\u4e0d\u4f7f\u7528 commander\uff0c\u6211\u4eec\u5148\u8ba9\u6211\u4eec\u7684\u547d\u4ee4\u6267\u884c\u8d77\u6765\\r\\n\\r\\n\u65b0\u589e`chovrio/bin/demo.js`\u5982\u4e0b\\r\\n\\r\\n```ts\\r\\n#!/usr/bin/env node\\r\\nfunction start() {\\r\\n  return import(\\"../dist/cli.js\\");\\r\\n}\\r\\nstart();\\r\\n```\\r\\n\\r\\n\u5728`package.json`\u4e2d\u589e\u52a0\u6846\u9009\u4ee3\u7801\\r\\n\\r\\n![image-20230313162456162](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313162456162.png)\\r\\n\\r\\n\u6267\u884c`npm link`\u8fd9\u6837\u53ef\u4ee5\u628a`bin`\u4e2d\u7684\u547d\u4ee4\u914d\u7f6e\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u60f3\u5f53\u4e8e\u6bcf\u6b21\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165`demo`\uff0c\u90fd\u4f1a\u94fe\u63a5\u5230`demo.js`\u8fd9\u4e2a\u6587\u4ef6\uff0c\u5e76\u4e14\u53bb\u6267\u884c\u5b83\uff0c\u4f46\u662f js \u6587\u4ef6\u5728\u547d\u4ee4\u884c\u4e2d\u5e76\u4e0d\u80fd\u76f4\u63a5\u6267\u884c\uff0c\u9700\u8981 node \u73af\u5883`#!/usr/bin/env node`\uff0c\\r\\n\\r\\n![image-20230313161925403](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313161925403.png)\\r\\n\\r\\n\u5b9e\u9645\u4e0a\u6211\u4eec\u6bcf\u6b21\u8fd0\u7528\u5305\u7ba1\u7406\u5de5\u5177\u7684\u65f6\u5019\u90fd\u4f1a\u81ea\u52a8\u53bb\u68c0\u6d4b`package.json`\u4e2d\u662f\u5426\u6709`bin`\u8fd9\u4e2a\u914d\u7f6e\uff0c\u5982\u679c\u6709\u4f1a\u81ea\u52a8\u6267\u884c\u7c7b\u4f3c`npm link`\u7684\u547d\u4ee4\u5c06\u547d\u4ee4\u5199\u5165\u73af\u5883\u53d8\u91cf\u3002\\r\\n\\r\\n\u6211\u4eec\u5148`npm link`\u518d\u6267\u884c`demo` **\u6ce8\u610f\uff0c\u5f97\u5728\u811a\u624b\u67b6\u6587\u4ef6\u5939\u4e0b\u9762\u6267\u884c**\\r\\n\\r\\n![image-20230313162537117](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313162537117.png)\\r\\n\\r\\n\u811a\u624b\u67b6\u529f\u80fd\u7684\u6dfb\u52a0\u5c31\u5f88\u5343\u5947\u767e\u602a\u4e86\uff0c\u6211\u8fd9\u91cc\u5c31\u5199\u4e24\u4e2a\u4e2a\u4eba\u89c9\u5f97\u7a0d\u5fae\u6709\u4e00\u70b9\u610f\u601d\u7684\u529f\u80fd\u5427\u3002\\r\\n\\r\\n- \u811a\u624b\u67b6\u914d\u7f6e\u6587\u4ef6\u7684\u4e00\u79cd\u5b9e\u73b0\u601d\u8def\\r\\n- \u90e8\u7f72\u6587\u4ef6\u5230\u670d\u52a1\u5668\\r\\n\\r\\n#### \u4e3b\u6587\u4ef6\\r\\n\\r\\n\u8fd9\u91cc\u5c31\u76f4\u63a5 cv \u4e86\uff0c\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u60f3\u8981\u96c6\u6210\u63d2\u4ef6(\u867d\u7136\u8fd8\u6ca1\u5199)\uff0c\u6240\u4ee5\u6211\u5199\u6210\u7684\u4e00\u4e2a\u7c7b\uff0c\u66f4\u52a0\u76f4\u89c2\\r\\n\\r\\n```ts\\r\\n// chovrio/core/index.ts\\r\\nimport { Command, program } from \\"commander\\";\\r\\nimport { version } from \\"../../package.json\\";\\r\\nclass Chovrio {\\r\\n  program: Command;\\r\\n  commands: Array<(program: Command) => void>;\\r\\n  constructor() {\\r\\n    this.program = program;\\r\\n    this.commands = [];\\r\\n    this.init();\\r\\n    this.program.option(\\"-v, --version\\").action(() => {\\r\\n      console.log(version);\\r\\n    });\\r\\n    this.program.parse();\\r\\n  }\\r\\n  init() {\\r\\n    this.commands.forEach((command) => {\\r\\n      command(program);\\r\\n    });\\r\\n  }\\r\\n}\\r\\nconst cli = new Chovrio();\\r\\ncli.program.version(version);\\r\\n```\\r\\n\\r\\n#### \u811a\u624b\u67b6\u914d\u7f6e\u6587\u4ef6\\r\\n\\r\\n\u76ee\u524d\u5c31\u53ea\u80fd\u662f`demo.config.js`\u6587\u4ef6\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u652f\u6301 ts \u6587\u4ef6\uff0c\u6ce8\u610f\u6587\u4ef6\u4f4d\u7f6e\u5f97\u662f\u547d\u4ee4\u6267\u884c\u7684\u8def\u5f84\\r\\n\\r\\n\u65b0\u5efa`utils/parse.ts`\\r\\n\\r\\n```ts\\r\\nimport fs from \\"fs\\";\\r\\nimport type { Config } from \\"../types\\";\\r\\n// \u83b7\u5f97\u6a21\u677f\u6587\u4ef6\u5e76\u89e3\u6790\u6210\u5bf9\u8c61\\r\\nexport default function parse() {\\r\\n  const config = fs\\r\\n    .readFileSync(`${process.cwd()}/demo.config.js`, \\"utf-8\\")\\r\\n    .replace(/[\\\\s|\\\\n]/g, \\"\\");\\r\\n  const reg = /\\\\{(.*)\\\\}/;\\r\\n  if (reg.test(config)) {\\r\\n    const arr = reg.exec(config);\\r\\n    if (arr !== null) {\\r\\n      const config: Config = new Function(\\"return \\" + arr[0])();\\r\\n      return config;\\r\\n    }\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u65b0\u5efa`utils/__dirname`\\r\\n\\r\\n```ts\\r\\nimport { fileURLToPath } from \\"url\\";\\r\\nexport const __dirname = fileURLToPath(new URL(\\".\\", import.meta.url));\\r\\n```\\r\\n\\r\\n\u65b0\u5efa`types/config.ts`\\r\\n\\r\\n```ts\\r\\nimport type { RollupOptions } from \\"rollup\\";\\r\\nexport interface Config {\\r\\n  rollupOptions?: RollupOptions;\\r\\n  deploy?: {\\r\\n    position: string;\\r\\n  };\\r\\n}\\r\\n```\\r\\n\\r\\n\u65b0\u5efa`types/index.ts`\\r\\n\\r\\n```ts\\r\\nexport * from \\"./config\\";\\r\\n```\\r\\n\\r\\n\u8fd9\u91cc\u7c7b\u578b\u90fd\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5bfc\u51fa\u662f\u4e3a\u4e86\u540e\u9762\u65b9\u4fbf\u6253\u5305\u6210\u7c7b\u578b\u58f0\u660e\u6587\u4ef6\\r\\n\\r\\n\u65b0\u5efa`command/deploy.ts`\\r\\n\\r\\n```ts\\r\\nimport parse from \\"../utils/parse\\";\\r\\nimport type { Command } from \\"commander\\";\\r\\nexport default function deploy(program: Command) {\\r\\n  program\\r\\n    .command(\\"deploy\\")\\r\\n    .description(\\"deploy a project to server\\")\\r\\n    .action(async () => {\\r\\n      const config = parse();\\r\\n      console.log(config);\\r\\n    });\\r\\n}\\r\\n```\\r\\n\\r\\n\u4fee\u6539`core/index.ts`\\r\\n\\r\\n```ts\\r\\nimport { Command, program } from \\"commander\\";\\r\\nimport { version } from \\"../../package.json\\";\\r\\nimport deploy from \\"../command/deploy\\";\\r\\nclass Chovrio {\\r\\n  program: Command;\\r\\n  commands: Array<(program: Command) => void>;\\r\\n  constructor() {\\r\\n    this.program = program;\\r\\n    this.commands = [deploy];\\r\\n    this.init();\\r\\n    this.program.option(\\"-v, --version\\").action(() => {\\r\\n      console.log(version);\\r\\n    });\\r\\n    this.program.parse();\\r\\n  }\\r\\n  init() {\\r\\n    this.commands.forEach((command) => {\\r\\n      command(program);\\r\\n    });\\r\\n  }\\r\\n}\\r\\nconst cli = new Chovrio();\\r\\ncli.program.version(version);\\r\\n```\\r\\n\\r\\n\u521b\u5efa\u914d\u7f6e\u6587\u4ef6`demo.config.js`\\r\\n\\r\\n```js\\r\\nexport default {\\r\\n  name: \\"chovrio\\",\\r\\n  age: 19,\\r\\n};\\r\\n```\\r\\n\\r\\n\u6267\u884c\u547d\u4ee4`demo deploy`\u53ef\u4ee5\u770b\u5230\\r\\n\\r\\n![image-20230313185051977](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313185051977.png)\\r\\n\\r\\n\u76ee\u524d\u8fd9\u79cd\u5b57\u7b26\u4e32\u8f6c\u5bf9\u8c61\u7684\u65b9\u5f0f\u53ea\u80fd\u89e3\u6790 js \u6587\u4ef6\uff0c\u540e\u7eed\u5e94\u8be5\u4f1a\u6539\u6210\u522b\u7684\u65b9\u6cd5\u7528\u6765\u652f\u6301 ts \u6587\u4ef6\uff0c\u4e0d\u8fc7\u76ee\u524d\u7684\u6548\u679c esmodule \u548c commonjs \u89c4\u8303\u7684\u5bfc\u51fa\u90fd\u53ef\u4ee5\u89e3\u6790\\r\\n\\r\\n#### \u90e8\u7f72\u6587\u4ef6\u5230\u670d\u52a1\u5668\\r\\n\\r\\n\u5728\u4e0a\u4e00\u6b65\u6211\u4eec\u5df2\u7ecf\u521b\u5efa\u597d\u4e86`deploy`\u547d\u4ee4\\r\\n\\r\\n\u5148\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5199\u8fd9\u4e2a\u90e8\u7f72\u6587\u4ef6\u7684\u547d\u4ee4\u5427\uff0c\u56e0\u4e3a\u6211\u7684\u670d\u52a1\u5668\u8dd1`ci/co`\u6709\u70b9....\uff0c\u55ef\uff0c\u53c8\u4e0d\u60f3\u6bcf\u6b21\u90fd\u624b\u52a8\u4e0a\u4f20\u3002\\r\\n\\r\\n\u6211\u4eec\u901a\u8fc7`node-ssh`\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\\r\\n\\r\\n```shell\\r\\npnpm add node-ssh\\r\\n```\\r\\n\\r\\n\u53c8\u56e0\u4e3a\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\u80af\u5b9a\u8981\u7528\u5230\u7aef\u53e3\u53f7\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u4f60\u4e5f\u4e0d\u60f3\u81ea\u5df1\u7684\u4fe1\u606f\u88ab\u66b4\u9732\u5427 \ud83d\ude08\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u7528\u5230`dotenv`\\r\\n\\r\\n```shell\\r\\npnpm add dotenv\\r\\n```\\r\\n\\r\\n\u5728\u4f60\u51c6\u5907\u6267\u884c\u811a\u624b\u67b6\u547d\u4ee4\u7684\u540c\u7ea7\u76ee\u5f55\u4e0b\u521b\u5efa`.env`\u6587\u4ef6\\r\\n\\r\\n```properties\\r\\nhost=xxxxx # \u7aef\u53e3\u53f7\\r\\nuser=xxxxx # \u7528\u6237\u540d \u8fd9\u91cc\u6ca1\u7528 username\u7684\u539f\u56e0\u662f\u6211\u672c\u5730\u9ed8\u8ba4\u7528\u6237\u540d\u4f1a\u662f chovrio\\r\\npassword=xxxxx # \u5bc6\u7801\\r\\n```\\r\\n\\r\\n\u65b0\u5efa`utils/env.ts`\\r\\n\\r\\n```ts\\r\\nimport * as dotenv from \\"dotenv\\";\\r\\ndotenv.config();\\r\\nexport default process.env;\\r\\n```\\r\\n\\r\\n\u5b89\u88c5\u4e24\u4e2a\u7f8e\u5316\u547d\u4ee4\u884c\u7684\u5de5\u5177\\r\\n\\r\\n```shell\\r\\npnpm add ora picocolors\\r\\n```\\r\\n\\r\\nora \u53ef\u4ee5\u8ba9\u6211\u4eec loading \u7684\u65f6\u5019\u597d\u770b\u4e00\u4e9b\uff0cpicocolors \u53ef\u4ee5\u6539\u53d8\u8f93\u51fa\u7684\u6587\u5b57\u989c\u8272\\r\\n\\r\\n\u4fee\u6539`commander/deploy`\\r\\n\\r\\n```ts\\r\\nimport parse from \\"../utils/parse\\";\\r\\nimport type { Command } from \\"commander\\";\\r\\nimport ora from \\"ora\\";\\r\\nimport pc from \\"picocolors\\";\\r\\nimport { NodeSSH } from \\"node-ssh\\";\\r\\nimport env from \\"../utils/env\\";\\r\\nexport default function deploy(program: Command) {\\r\\n  program\\r\\n    // \u547d\u4ee4\\r\\n    .command(\\"deploy\\")\\r\\n    // \u547d\u4ee4\u63cf\u8ff0\\r\\n    .description(\\"deploy a project to server\\")\\r\\n    // \u89e3\u6790\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e \u8981\u6267\u884c\u7684\u64cd\u4f5c\\r\\n    .action(async () => {\\r\\n      const config = parse();\\r\\n      const ssh = new NodeSSH();\\r\\n      console.log(config);\\r\\n      // 1.\u8fde\u63a5\u670d\u52a1\u5668\\r\\n      // 1.1 \u5b58\u5728.env\u6587\u4ef6\u4e14\u5177\u6709\u6570\u636e\u5c31\u8bfb\u53d6\u6587\u4ef6\u8fde\u63a5\\r\\n      if (env.user && env.password && env.host) {\\r\\n        const connectSpinner = ora(pc.blue(`connect server...`)).start();\\r\\n        await ssh.connect({\\r\\n          host: env.host,\\r\\n          username: env.user,\\r\\n          password: env.password,\\r\\n        });\\r\\n        connectSpinner.stop();\\r\\n        console.log(\\"\u670d\u52a1\u5668\u8fde\u63a5\u6210\u529f\\");\\r\\n        // \u9000\u51fa\u7ec8\u7aef\\r\\n        process.exit(0);\\r\\n      }\\r\\n    });\\r\\n}\\r\\n```\\r\\n\\r\\n\u73b0\u5728\u6211\u4eec\u6267\u884c`demo deploy`\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u6548\u679c(\u8fd9\u91cc\u6ca1\u94fe\u63a5\u4e0a\u65f6\u662f\u6709\u52a8\u753b)\\r\\n\\r\\n![image-20230313191104485](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313191104485.png)\\r\\n\\r\\n\u6211\u4eec\u73b0\u5728\u518d\u5199\u53e6\u4e00\u79cd\u903b\u8f91\uff0c\u5c31\u662f\u7528\u6237\u89c9\u5f97.env \u6587\u4ef6\u4e5f\u4e0d\u5b89\u5168\uff0c\u4e07\u4e00\u4e0d\u5c0f\u5fc3\u5fd8\u8bb0\u5ffd\u7565\u4e86\u4e0a\u4f20\u5230 github \u540e\u5c31\u5c34\u5c2c\u4e86\uff0c\u4e8e\u662f\u65b0\u589e\u4e00\u4e2a\u672a\u68c0\u6d4b\u5230 env \u6587\u4ef6\u624b\u52a8\u8f93\u5165\u7684\u529f\u80fd\uff0c\u6211\u4eec\u8981\u501f\u52a9\u4e00\u4e2a\u5305`readline-sync`,node \u539f\u751f\u7684`readline`\u597d\u50cf\u9ed8\u8ba4\u662f\u5f02\u6b65\u4f1a\uff0c\u548c`ora`\u642d\u914d\u5728\u4e00\u8d77\u4f7f\u7528\u633a\u5c2c\u7684\u3002\\r\\n\\r\\n```shell\\r\\npnpm add readline-sync\\r\\n```\\r\\n\\r\\n```ts\\r\\n// deploy.ts\\r\\nimport parse from \\"../utils/parse\\";\\r\\nimport type { Command } from \\"commander\\";\\r\\nimport ora from \\"ora\\";\\r\\nimport pc from \\"picocolors\\";\\r\\nimport { NodeSSH } from \\"node-ssh\\";\\r\\nimport readline from \\"readline-sync\\";\\r\\nimport env from \\"../utils/env\\";\\r\\nexport default function deploy(program: Command) {\\r\\n  program\\r\\n    // \u547d\u4ee4\\r\\n    .command(\\"deploy\\")\\r\\n    // \u547d\u4ee4\u63cf\u8ff0\\r\\n    .description(\\"deploy a project to server\\")\\r\\n    // \u89e3\u6790\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e \u8981\u6267\u884c\u7684\u64cd\u4f5c\\r\\n    .action(async () => {\\r\\n      const config = parse();\\r\\n      const ssh = new NodeSSH();\\r\\n      let host, username, password;\\r\\n      console.log(config);\\r\\n      // 1.\u8fde\u63a5\u670d\u52a1\u5668\\r\\n      // 1.1 \u5b58\u5728.env\u6587\u4ef6\u4e14\u5177\u6709\u6570\u636e\u5c31\u8bfb\u53d6\u6587\u4ef6\u8fde\u63a5\\r\\n      if (env.user && env.password && env.host) {\\r\\n        host = env.host;\\r\\n        username = env.user;\\r\\n        password = env.password;\\r\\n      } else {\\r\\n        // 1.2 \u4e0d\u5b58\u5728\u5c31\u91c7\u53d6\u8f93\u5165\u65b9\u5f0f\u8fde\u63a5\\r\\n        host = readline.question(`Your server ip address${pc.blue(\\"(host)\\")}:`);\\r\\n        username = readline.question(\\r\\n          `The user name you want to log in to${pc.blue(\\"(username)\\")}:`\\r\\n        );\\r\\n        password = readline.question(`Your password${pc.blue(\\"(password)\\")}:`);\\r\\n      }\\r\\n      const connectSpinner = ora(pc.blue(`connect server...`)).start();\\r\\n      try {\\r\\n        await ssh.connect({\\r\\n          host,\\r\\n          username,\\r\\n          password,\\r\\n        });\\r\\n        console.log(\\"\u6570\u636e\u5e93\u8fde\u63a5\u6210\u529f\\");\\r\\n      } catch (err) {\\r\\n        console.log(\\"\u6570\u636e\u9519\u8bef\uff0c\u8fde\u63a5\u5931\u8d25\\", err.message);\\r\\n      }\\r\\n      connectSpinner.stop();\\r\\n      process.exit(0);\\r\\n    });\\r\\n}\\r\\n```\\r\\n\\r\\n![image-20230313191743218](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313191743218.png)\\r\\n\\r\\n\u8fd9\u91cc\u540e\u9762\u80af\u5b9a\u4f1a\u62a5\u9519\u7684\uff0c\u8fde\u63a5\u4e0d\u4e0a\u3002\\r\\n\\r\\n\u8fd9\u91cc\u8fde\u63a5\u6570\u636e\u5e93\u6211\u4eec\u5df2\u7ecf\u505a\u597d\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4e0a\u4f20\u6587\u4ef6\u5230\u670d\u52a1\u5668\u4e86\uff0c\\r\\n\\r\\n\u6211\u4eec\u5148\u5220\u9664\u539f\u672c\u6587\u4ef6\u5939(\u5c31\u4e0d\u5168\u6587\u4ef6\u590d\u5236\u4e86\uff0c\u4e0d\u7136\u592a\u957f\u4e86)\\r\\n\\r\\n\u8fd9\u91cc\u7684 config \u5c31\u662f\u6211\u4eec\u4e4b\u524d\u5199\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6587\u4ef6\u91cc\u9762\u7684 deploy.position \u5c31\u662f\u6211\u4eec\u8981\u4e0a\u4f20\u7684\u4f4d\u7f6e\\r\\n\\r\\n```ts\\r\\nconst deleteSpinner = ora(pc.blue(`delete folder...`)).start();\\r\\nconst remotePath = config?.deploy?.position || \\"\\";\\r\\nawait ssh.execCommand(`rm -rf ${remotePath}`);\\r\\ndeleteSpinner.stop();\\r\\nconsole.log(pc.green(\\"\u5220\u9664\u6587\u4ef6\u6210\u529f~\\"));\\r\\n```\\r\\n\\r\\n\u73b0\u5728\u5728\u6211\u7684\u670d\u52a1\u5668\u7684`/home/test/hahaha`\u76ee\u5f55\u4e0b\u6709\u4e00\u4e2a cli \u6587\u4ef6\u5939\u3002\u6211\u4eec\u8981\u4e0a\u4f20\u65b0\u6587\u4ef6\u5230`hahaha`\u8fd9\u4e2a\u6587\u4ef6\u5939\u91cc\u9762![image-20230313192923456](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313192923456.png)\\r\\n\\r\\n\u8fd9\u662f\u6211\u7684\u914d\u7f6e\u6587\u4ef6\\r\\n\\r\\n```js\\r\\n// demo.config.js\\r\\nexport default {\\r\\n  deploy: {\\r\\n    position: \\"/home/test/hahaha\\",\\r\\n  },\\r\\n};\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\u6267\u884c` demo deploy`\\r\\n\\r\\n![image-20230313193535742](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313193535742.png)\\r\\n\\r\\n\u6700\u4e0a\u9762\u7684\u5bf9\u8c61\u662f\u6211\u4eec\u6253\u5370\u7684 config\uff0c\u670d\u52a1\u5668\u4e0a\u7684 hahaha \u6587\u4ef6\u5939\u5df2\u7ecf\u6ca1\u4e86\\r\\n\\r\\n![image-20230313193611741](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313193611741.png)\\r\\n\\r\\n\u6211\u4eec\u6700\u540e\u518d\u4e0a\u4f20\u7a0b\u5e8f\u6267\u884c\u4f4d\u7f6e\u4e0b\u7684 dist \u6587\u4ef6\u5939\u4e0a\u53bb\\r\\n\\r\\n```ts\\r\\n// 3.\u4e0a\u4f20\u6587\u4ef6\\r\\nconst uploadSpinner = ora(pc.blue(`upload folder...`)).start();\\r\\nconst status = await ssh.putDirectory(process.cwd() + \\"/dist\\", remotePath, {\\r\\n  recursive: true,\\r\\n  concurrency: 10,\\r\\n});\\r\\nuploadSpinner.stop();\\r\\nif (status) {\\r\\n  console.log(pc.green(\\"\u6587\u4ef6\u4e0a\u4f20\u670d\u52a1\u5668\u6210\u529f~\\"));\\r\\n} else {\\r\\n  console.log(pc.red(\\"\u6587\u4ef6\u4e0a\u4f20\u670d\u52a1\u5668\u5931\u8d25\\"));\\r\\n}\\r\\nprocess.exit(0);\\r\\n```\\r\\n\\r\\n\u6574\u4e2a\u6587\u4ef6 deploy \u6587\u4ef6\\r\\n\\r\\n```ts\\r\\n// deploy.ts\\r\\nimport parse from \\"../utils/parse\\";\\r\\nimport type { Command } from \\"commander\\";\\r\\nimport ora from \\"ora\\";\\r\\nimport pc from \\"picocolors\\";\\r\\nimport { NodeSSH } from \\"node-ssh\\";\\r\\nimport readline from \\"readline-sync\\";\\r\\nimport env from \\"../utils/env\\";\\r\\nexport default function deploy(program: Command) {\\r\\n  program\\r\\n    // \u547d\u4ee4\\r\\n    .command(\\"deploy\\")\\r\\n    // \u547d\u4ee4\u63cf\u8ff0\\r\\n    .description(\\"deploy a project to server\\")\\r\\n    // \u89e3\u6790\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e \u8981\u6267\u884c\u7684\u64cd\u4f5c\\r\\n    .action(async () => {\\r\\n      const config = parse();\\r\\n      const ssh = new NodeSSH();\\r\\n      let host, username, password;\\r\\n      // 1.\u8fde\u63a5\u670d\u52a1\u5668\\r\\n      // 1.1 \u5b58\u5728.env\u6587\u4ef6\u4e14\u5177\u6709\u6570\u636e\u5c31\u8bfb\u53d6\u6587\u4ef6\u8fde\u63a5\\r\\n      if (env.user && env.password && env.host) {\\r\\n        host = env.host;\\r\\n        username = env.user;\\r\\n        password = env.password;\\r\\n      } else {\\r\\n        // 1.2 \u4e0d\u5b58\u5728\u5c31\u91c7\u53d6\u8f93\u5165\u65b9\u5f0f\u8fde\u63a5\\r\\n        host = readline.question(`Your server ip address${pc.blue(\\"(host)\\")}:`);\\r\\n        username = readline.question(\\r\\n          `The user name you want to log in to${pc.blue(\\"(username)\\")}:`\\r\\n        );\\r\\n        password = readline.question(`Your password${pc.blue(\\"(password)\\")}:`);\\r\\n      }\\r\\n      const connectSpinner = ora(pc.blue(`connect server...`)).start();\\r\\n      try {\\r\\n        await ssh.connect({\\r\\n          host,\\r\\n          username,\\r\\n          password,\\r\\n        });\\r\\n        connectSpinner.stop();\\r\\n        console.log(pc.green(\\"\u670d\u52a1\u5668\u8fde\u63a5\u6210\u529f~\\"));\\r\\n      } catch (err) {\\r\\n        connectSpinner.stop();\\r\\n        console.log(pc.red(\\"\u6570\u636e\u9519\u8bef\uff0c\u8fde\u63a5\u5931\u8d25\\" + err.message));\\r\\n      }\\r\\n      // 2.\u5220\u9664\u539f\u6709\u6587\u4ef6\u5939\u5185\u5bb9\\r\\n      const deleteSpinner = ora(pc.blue(`delete folder...`)).start();\\r\\n      const remotePath = config?.deploy?.position || \\"\\";\\r\\n      await ssh.execCommand(`rm -rf ${remotePath}`);\\r\\n      deleteSpinner.stop();\\r\\n      console.log(pc.green(\\"\u5220\u9664\u6587\u4ef6\u6210\u529f~\\"));\\r\\n      // 3.\u4e0a\u4f20\u6587\u4ef6\\r\\n      const uploadSpinner = ora(pc.blue(`upload folder...`)).start();\\r\\n      const status = await ssh.putDirectory(\\r\\n        process.cwd() + \\"/dist\\",\\r\\n        remotePath,\\r\\n        {\\r\\n          recursive: true,\\r\\n          concurrency: 10,\\r\\n        }\\r\\n      );\\r\\n      uploadSpinner.stop();\\r\\n      if (status) {\\r\\n        console.log(pc.green(\\"\u6587\u4ef6\u4e0a\u4f20\u670d\u52a1\u5668\u6210\u529f~\\"));\\r\\n      } else {\\r\\n        console.log(pc.red(\\"\u6587\u4ef6\u4e0a\u4f20\u670d\u52a1\u5668\u5931\u8d25\\"));\\r\\n      }\\r\\n      process.exit(0);\\r\\n    });\\r\\n}\\r\\n```\\r\\n\\r\\n\u518d\u6b21\u6267\u884c`demo deploy`\\r\\n\\r\\n![image-20230313193945895](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313193945895.png)\\r\\n\\r\\n![image-20230313194028137](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313194028137.png)\\r\\n\\r\\n\u6b64\u65f6\u4e0a\u4f20\u6587\u4ef6\u7684\u903b\u8f91\u5c31\u5df2\u7ecf\u5b8c\u5168\u5b9e\u73b0\u4e86\u3002\\r\\n\\r\\n\u6b64\u65f6\u6211\u4eec\u6267\u884c`pnpm build`\u4f1a\u62a5\u9519\\r\\n\\r\\n![image-20230313194848537](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313194848537.png)\\r\\n\\r\\n\u4e0d\u80fd\u8bc6\u522b\u5230 ts \u6587\u4ef6\uff0c\u6211\u4eec\u7684 plugin \u4e2d\u8bfb\u53d6\u7684\u662f`chovrio/tsconfig.js`\\r\\n\\r\\n\u6211\u4eec\u4fee\u6539\u5b83\u5982\u4e0b\uff0c\u5c31\u52a0\u5165\u4e86\u4e3b\u6587\u4ef6\u5230 include \u91cc\u9762\\r\\n\\r\\n```json\\r\\n{\\r\\n  \\"extends\\": \\"./tsconfig.base.json\\",\\r\\n  \\"include\\": [\\"./rollup.config.ts\\", \\"./src/core/index.ts\\"],\\r\\n  \\"compilerOptions\\": {\\r\\n    \\"esModuleInterop\\": true,\\r\\n    \\"declaration\\": false,\\r\\n    \\"resolveJsonModule\\": true\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u6211\u4eec\u518d\u6b21\u6267\u884c\u6253\u5305\u4f1a\u53d1\u73b0\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u7684\u95ee\u9898\\r\\n\\r\\n![image-20230313195301266](https://chart-r0m2qgkmn-astrues.vercel.app/cli/image-20230313195301266.png)\\r\\n\\r\\n\u6682\u65f6\u6ca1\u60f3\u5230\u8fd9\u4e2a\u95ee\u9898\u600e\u4e48\u89e3\u51b3\uff0c\u8ddf\u7740\u6587\u6863\u8d70\u4e5f\u6ca1\u89e3\u51b3\uff0c\u4e0d\u8fc7\u5f00\u53d1\u540e\u662f\u6ca1\u95ee\u9898\u7684\u76f4\u63a5\u4e0a\u4f20 bin \u548c dist \u76ee\u5f55\u53d1\u5305\u662f\u80fd\u7528\u7684"},{"id":"tracker sdk","metadata":{"permalink":"/festudy/blog/tracker sdk","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/\u624b\u5199\u57cb\u70b9sdk\u5305.md","source":"@site/blog/\u624b\u5199\u57cb\u70b9sdk\u5305.md","title":"\u624b\u5199\u524d\u7aef\u57cb\u70b9sdk","description":"\u4e00\u4e2a\u7b80\u5355\u7684tracker sdk","date":"2023-09-28T09:34:51.000Z","formattedDate":"September 28, 2023","tags":[{"label":"cli","permalink":"/festudy/blog/tags/cli"}],"readingTime":13.53,"hasTruncateMarker":false,"authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"frontMatter":{"title":"\u624b\u5199\u524d\u7aef\u57cb\u70b9sdk","description":"\u4e00\u4e2a\u7b80\u5355\u7684tracker sdk","slug":"tracker sdk","authors":[{"name":"chovrio","title":"\u65e0","url":"https://github.com/chovrio","image_url":"https://github.com/chovrio.png","imageURL":"https://github.com/chovrio.png"}],"tags":["cli"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"\u4ece\u96f6\u5f00\u53d1\u4e00\u6b3e\u81ea\u5df1\u7684\u811a\u624b\u67b6","permalink":"/festudy/blog/cli"},"nextItem":{"title":"\u7528 nextjs \u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u524d\u53f0","permalink":"/festudy/blog/\u7528nextjs\u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u9879\u76ee"}},"content":"## \u5de5\u5177\u5305\u7684\u5f00\u53d1\\r\\n\\r\\n### \u9879\u76ee\u57fa\u7840\u7ed3\u6784\u642d\u5efa\\r\\n\\r\\n**\u9879\u76ee\u4f9d\u8d56\uff1atypescript + rollup**\\r\\n\\r\\n```shell\\r\\n\\tpnpm inin # \u53ef\u7528npm yarn\\r\\n\\tpnpm add @types/node -D # node\u7684\u4e00\u4e9b\u7c7b\u578b \u53ef\u4ee5\u4e0d\u88c5\\r\\n\\tpnpm add rollup -D # \u6253\u5305\u5de5\u5177\\r\\n\\tpnpm add typescript -D # \u8bed\u8a00\\r\\n\\tpnpm add rollup-plugin-dts -D\\r\\n \\tpnpm add rollup-plugin-typescript2 -D\\r\\n \\t\\r\\n\\tpnpm add typescript rollup @types/node rollup-plugin-dts rollup-plugin-typescript2 -D # \u4e00\u6b65\u5b89\u88c5\\r\\n```\\r\\n\\r\\n\u5b89\u88c5\u597d\u4f9d\u8d56\u540e\u6267\u884c ` npx tsc --init` \u751f\u6210tsconfig.json\u6587\u4ef6\\r\\n\\r\\n\u624b\u52a8\u521b\u5efarollup.config.js\u6587\u4ef6\uff0c\u5e76\u914d\u7f6e\\r\\n\\r\\n```js\\r\\nimport path from \\"path\\";\\r\\nimport ts from \\"rollup-plugin-typescript2\\";\\r\\nimport dts from \\"rollup-plugin-dts\\";\\r\\nimport { fileURLToPath } from \\"node:url\\";\\r\\nconst __filenameNew = fileURLToPath(import.meta.url);\\r\\nconst __dirnameNew = path.dirname(__filenameNew);\\r\\nexport default [\\r\\n  // \u6253\u5305ts\u6587\u4ef6\u751f\u6210js\\r\\n  {\\r\\n    // \u5165\u53e3\u6587\u4ef6\u8def\u5f84\\r\\n    input: \\"./src/core/index.ts\\",\\r\\n    // \u6253\u5305\u751f\u6210\u6587\u4ef6\u5b58\u50a8\u4f4d\u7f6e\\r\\n    output: [\\r\\n      // \u6253\u5305\u751f\u6210esmodule\u89c4\u8303js\u6587\u4ef6\\r\\n      {\\r\\n        file: path.resolve(__dirnameNew, \\"./dist/index.esm.js\\"),\\r\\n        // \u751f\u6210\u6587\u4ef6\u7684\u89c4\u8303\u7c7b\u578b\\r\\n        format: \\"es\\",\\r\\n      },\\r\\n      // \u6253\u5305\u751f\u6210commanjs\u89c4\u8303js\u6587\u4ef6\\r\\n      {\\r\\n        file: path.resolve(__dirnameNew, \\"./dist/index.cjs.js\\"),\\r\\n        format: \\"cjs\\",\\r\\n      },\\r\\n      // \u6253\u5305\u751f\u6210umd\u89c4\u8303js\u6587\u4ef6\\r\\n      {\\r\\n        file: path.resolve(__dirnameNew, \\"./dist/index.js\\"),\\r\\n        // \u5168\u5c40\u53d8\u91cf\u540d\\r\\n        name: \\"Tracker\\",\\r\\n        format: \\"umd\\",\\r\\n      },\\r\\n        // \u7acb\u5373\u6267\u884c\u51fd\u6570 \u8fd9\u4e2a\u6ca1\u6709\u4ec0\u4e48\u5fc5\u8981\\r\\n      {\\r\\n        format: \\"iife\\",\\r\\n        name: \\"Tracker\\",\\r\\n        file: \\"./dist/index.iife.js\\",\\r\\n      },\\r\\n    ],\\r\\n    plugins: [ts()],\\r\\n  },\\r\\n  // \u6253\u5305ts\u6587\u4ef6\u751f\u6210.d.ts\u6587\u4ef6\\r\\n  {\\r\\n    input: \\"./src/core/index.ts\\",\\r\\n    output: {\\r\\n      file: path.resolve(__dirnameNew, \\"./dist/index.d.ts\\"),\\r\\n    },\\r\\n    plugins: [dts()],\\r\\n  },\\r\\n];\\r\\n\\r\\n```\\r\\n\\r\\n\u914d\u7f6epackage.json\u6587\u4ef6\u7684scripts\u811a\u672c\\r\\n\\r\\n```shell\\r\\n\\tpnpm pkg set scripts.build=\\"rollup -c\\"\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\u6211\u4eec\u6267\u884c `pnpm build` \u4f1a\u53d1\u73b0\u6709\u4ee5\u4e0b\u62a5\u9519\\r\\n\\r\\n![image-20230211111631761](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211111631761.png)\\r\\n\\r\\n\u6839\u636e\u63d0\u793a\u6211\u4eec\u5728package.json\u4e2d \u6dfb\u52a0\\r\\n\\r\\n```json\\r\\n{\\r\\n ...\\r\\n \\"type\\":\\"module\\"\\r\\n ...\\r\\n}\\r\\n```\\r\\n\\r\\n\u518d\u6b21\u6253\u5305\u53c8\u4f1a\u6709\u62a5\u9519\\r\\n\\r\\n![image-20230211111919039](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211111919039.png)\\r\\n\\r\\n\u6240\u4ee5\u6211\u4eec\u5c06tsconfig.json\u4e2d\u7684 ` \\"module\\":\\"commanjs\\"`\u6539\u4e3a` \\"module\\":\\"ESNEXT\\"`\\r\\n\\r\\n\u518d\u6b21\u6253\u5305\u5c31\u4e0d\u4f1a\u6709\u62a5\u9519\u4e86(\u6ce8\u610f\u5728\u5165\u53e3\u6587\u4ef6 core/index.ts \u968f\u4fbf\u5199\u70b9\u5185\u5bb9\uff0c\u4e0d\u7136\u7a7a\u6587\u4ef6\u662f\u6253\u5305\u4e0d\u4e86\u7684)\\r\\n\\r\\n![image-20230211112030189](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211112030189.png)\\r\\n\\r\\n\u6b64\u65f6\u9879\u76ee\u7684\u57fa\u672c\u7ed3\u6784\u5982\u4e0b\uff0c\u4e5f\u7b97\u57fa\u672c\u642d\u5efa\u597d\u4e86\u67b6\u5b50\uff0c\u53ef\u4ee5\u5f80\u91cc\u9762\u586b\u5145\u5185\u5bb9\u4e86\\r\\n\\r\\n![image-20230211112201720](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211112201720.png)\\r\\n\\r\\n### SDK\u5305\u5f00\u53d1\\r\\n\\r\\n\u9996\u5148\u6211\u4eec\u5728` types/index.ts`\u5199\u5165\u4ee5\u4e0b\u7c7b\u578b\\r\\n\\r\\n```typescript\\r\\n/**\\r\\n * @requestUrl \u63a5\u53e3\u5730\u5740\\r\\n * @historyTracker history\u4e0a\u62a5\\r\\n * @hashTracker hash\u4e0a\u62a5\\r\\n * @domTracker \u643a\u5e26Tracker-key \u70b9\u51fb\u4e8b\u4ef6\u4e0a\u62a5\\r\\n * @sdkVersionsdk\u7248\u672c\\r\\n * @extra\u900f\u4f20\u5b57\u6bb5\\r\\n * @jsError js \u548c promise \u62a5\u9519\u5f02\u5e38\u4e0a\u62a5\\r\\n */\\r\\n\\r\\nexport interface DefaultOptons {\\r\\n  uuid: string | undefined;\\r\\n  requestUrl: string | undefined;\\r\\n  historyTracker: boolean;\\r\\n  hashTracker: boolean;\\r\\n  domTracker: boolean;\\r\\n  sdkVersion: string | number;\\r\\n  extra: Record<string, any> | undefined;\\r\\n  jsError: boolean;\\r\\n}\\r\\n\\r\\n//\u5fc5\u4f20\u53c2\u6570 requestUrl\\r\\nexport interface Options extends Partial<DefaultOptons> {\\r\\n  requestUrl: string;\\r\\n}\\r\\n\\r\\n```\\r\\n\\r\\n\u5728` core/index.ts`\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\\r\\n\\r\\n```typescript\\r\\nimport type { DefaultOptons, Options } from \\"../types/index\\";\\r\\nimport pkg from \\"../../package.json\\";\\r\\n\\r\\nexport default class Tracker {\\r\\n  public data: Options;\\r\\n  constructor(options: Options) {\\r\\n    // \u6309\u4f20\u5165\u914d\u7f6e\u4fee\u6539\u9ed8\u8ba4\u914d\u7f6e\\r\\n    this.data = Object.assign(this.initDef(), options);\\r\\n  }\\r\\n  private initDef(): DefaultOptons {\\r\\n    return <DefaultOptons>{\\r\\n      historyTracker: false,\\r\\n      hashTracker: false,\\r\\n      domTracker: false,\\r\\n      jsError: false,\\r\\n      sdkVersion: pkg.version,\\r\\n    };\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u56e0\u4e3a\u4f7f\u7528 ` import` \u662f\u65e0\u6cd5\u5bfc\u5165 `.json` \u6587\u4ef6\u7684\u6240\u4ee5\u4ee3\u7801\u7b2c\u4e8c\u884c\u4f1a\u62a5\u9519\uff0c\u6211\u4eec\u9700\u8981\u5728`tsconfig.json`\u4e2d\u8bbe\u7f6e\\r\\n\\r\\n```json\\r\\n{\\r\\n    ...\\r\\n    \\"compilerOptions\\" : {\\r\\n        \\"moduleResolution\\": \\"node\\", // \u8bbe\u7f6e\u6a21\u5757\u89e3\u6790\u7b56\u7565\u4e3anode \u4e5f\u53ef\u4ee5\u4f7f\u7528--moduleResolution\u6765\u6307\u5b9a,\u4f46\u5f97\u7528 tsc\u5de5\u5177\\r\\n        \\"resolveJsonModule\\": true, // \u628ajson\u6587\u4ef6\u89c6\u4f5c\u6a21\u5757\\r\\n    }\\r\\n    ...\\r\\n}\\r\\n```\\r\\n\\r\\n\u5173\u4e8e\u89e3\u6790\u7b56\u7565\u6709\u4e00\u7bc7\u4e0d\u9519\u7684\u6587\u7ae0 [tsconfig\u4e4bmoduleResolution\u8be6\u89e3](https://blog.csdn.net/weixin_40013817/article/details/127200965)\\r\\n\\r\\n\u4e5f\u53ef\u4ee5\u91c7\u7528\u7b2c\u4e8c\u79cd\u89e3\u51b3\u529e\u6cd5\uff0c\u5728\u6839\u76ee\u5f55\u65b0\u5efa\u4e00\u4e2a` type.d.ts`\u6587\u4ef6\\r\\n\\r\\n```typescript\\r\\n// type.d.ts\\r\\n\\r\\ndeclare module \'*.json\' {\\r\\n    const value: any;\\r\\n    export default value;\\r\\n}\\r\\n```\\r\\n\\r\\n\u8fd9\u6837\u6211\u4eec\u4e5f\u53ef\u4ee5\u5bfc\u5165json\u6587\u4ef6\uff0c\u4f46\u662f\u6ca1\u6709\u4ee3\u7801\u63d0\u793a\u5e94\u8be5\u3002\\r\\n\\r\\n\u4f46\u662frollup\u5982\u679c\u8981\u6253\u5305json\u6587\u4ef6\u6211\u4eec\u5fc5\u987b\u8981\u501f\u52a9\u63d2\u4ef6\u3002\\r\\n\\r\\n```shell\\r\\n\\tpnpm add @rollup/plugin-json -D\\r\\n```\\r\\n\\r\\n\u5e76\u5728rollup.config.js\u4e2d\u914d\u7f6e\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u505a\u4ecb\u7ecd\u4e86\uff0c\u76f4\u63a5\u5f15\u5165\u914d\u7f6e\u5373\u53ef\\r\\n\\r\\n\u56e0\u4e3a\u6d4f\u89c8\u5668\u6709\u4e24\u79cd\u8def\u7531\u65b9\u5f0f\uff1a`hash\u8def\u7531`\u548c`\u666e\u901a\u8def\u7531`\uff0chash\u8def\u7531\u5c31\u662f\u5e26\u951a\u70b9\u7684\\r\\n\\r\\n\u6211\u4eec\u5148\u5199\u666e\u901a\u8def\u7531\u7684\u57cb\u70b9\\r\\n\\r\\n#### \u666e\u901a\u8def\u7531\u76d1\u542c\\r\\n\\r\\n##### SDK\u5185\u5bb9\\r\\n\\r\\n\u9996\u5148\uff0c\u5728Tracker\u7c7b\u91cc\u9762\u65b0\u589e\u4e24\u4e2a\u4e2a\u79c1\u6709\u65b9\u6cd5 `installTracker` \u53ca `captureEvents` \u5e76\u5728\u6784\u9020\u5668\u4e2d\u8c03\u7528 `installTracker` \u6b64\u65f6`core/index.ts`\u4ee3\u7801\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\nimport type { DefaultOptons, Options } from \\"../types/index\\";\\r\\nimport { version } from \\"../../package.json\\";\\r\\n\\r\\nexport default class Tracker {\\r\\n  public data: Options;\\r\\n  constructor(options: Options) {\\r\\n    // \u6309\u4f20\u5165\u914d\u7f6e\u4fee\u6539\u9ed8\u8ba4\u914d\u7f6e\\r\\n    this.data = Object.assign(this.initDef(), options);\\r\\n    this.installTracker();\\r\\n  }\\r\\n  private initDef(): DefaultOptons {\\r\\n    return <DefaultOptons>{\\r\\n      historyTracker: false,\\r\\n      hashTracker: false,\\r\\n      domTracker: false,\\r\\n      jsError: false,\\r\\n      sdkVersion: version,\\r\\n    };\\r\\n  }\\r\\n  private captureEvents<T>(EventList: string[], targetKey: string, data?: T) {\\r\\n    EventList.forEach((event) => {\\r\\n      console.log(event);\\r\\n    });\\r\\n  }\\r\\n  private installTracker() {\\r\\n    if (this.data.historyTracker) {\\r\\n      this.captureEvents(\\r\\n        [\\"pushState\\", \\"replaceState\\", \\"popstate\\"],\\r\\n        \\"history-pv\\",\\r\\n        {\\r\\n          code: 10001,\\r\\n          message: \\"\u7528\u6237\u6d4f\u89c8\u8bb0\u5f55 \\",\\r\\n        }\\r\\n      );\\r\\n    }\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u5728\u8fd9\u91cc\u6211\u4eec\u76d1\u542c\u4e86 `\\"pushState\\", \\"replaceState\\", \\"popstate\\"`\u4e09\u4e2a\u4e8b\u4ef6(\u53ea\u8981Tracker\u5b9e\u4f8b\u4e00\u65e6\u521b\u5efa)\uff0c\u5c31\u4e0d\u505a\u6d4b\u8bd5\u4e86\uff0c\u76d1\u542c\u5230\u4e86\u4e8b\u4ef6\u5c31\u5f97\u4e0a\u62a5(\u53ef\u4ee5\u505a\u5386\u53f2\u6d4f\u89c8\u8bb0\u5f55)\u3002\u6240\u4ee5\u6211\u4eecTracker\u7c7b\u4e2d\u65b0\u589e\u4e00\u4e2a\u4e0a\u62a5\u51fd\u6570 `reportTracker` \\r\\n\\r\\n```typescript\\r\\n// core/index.ts\\r\\n  private reportTracker<T>(data: T) {\\r\\n    const params = Object.assign(this.data, data, { time: new Date() });\\r\\n    let headers = {\\r\\n      type: \\"application/x-www-form-urlencoded\\",\\r\\n    };\\r\\n    let blob = new Blob([JSON.stringify(params)], headers);\\r\\n    navigator.sendBeacon(this.data.requestUrl, blob);\\r\\n  }\\r\\n```\\r\\n\\r\\n\u8be5\u51fd\u6570\u4f7f\u7528\u4e86Blob\u4ee5\u53canavigator.sendBeacon\uff0c\u7b80\u5355\u8bf4\u4e00\u4e0b\u5b83\u4eec\u7684\u4f5c\u7528\uff0cblob\u53ef\u4ee5\u5c06\u6570\u636e\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u6d41\uff0c\u8f6c\u6362\u540e\u7684\u6570\u636e\u4e0e\u4e4b\u524d\u6570\u636e\u7684\u5bf9\u6bd4\u56fe\uff0c\u8fd9\u6837\u5728\u53d1\u9001\u7f51\u7edc\u8bf7\u6c42\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u51cf\u5c11\u6570\u636e\u5927\u5c0f\uff0c\u63d0\u9ad8\u8bf7\u6c42\u901f\u5ea6(\u6587\u4ef6\u7684\u5206\u7247\u4e0a\u4f20\u4e5f\u53ef\u4ee5\u4f7f\u7528Blob)\u3002navigator.sendBeacon\u4e5f\u662f\u4e3a\u4e86\u4e0a\u62a5\u63d0\u901f\u7684\uff0c\u540c\u65f6\u53ef\u4ee5\u4fdd\u8bc1\u4f1a\u628a\u6570\u636e\u53d1\u51fa\u53bb\uff0c\u4e0d\u62d6\u5ef6\u5378\u8f7d\u6d41\u7a0b\u3002\u8fd9\u91cc\u6709\u4e24\u7bc7\u6587\u7ae0\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u770b\u4e00\u770b\uff0c[JS \u4e2d\u7684 Navigator.sendBeacon() \u662f\u5e72\u4ec0\u4e48\u7684\uff1f](https://zhuanlan.zhihu.com/p/435549202)\u3001[Javascript\u4e2dBlob\u4ecb\u7ecd](https://blog.csdn.net/yaojiqic/article/details/125090825)\\r\\n\\r\\n![image-20230211121433794](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211121433794.png)\\r\\n\\r\\n\u5199\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u4e0d\u5f97\u4e0d\u5199\u4e00\u4e9b\u670d\u52a1\u7aef\u4ee3\u7801\u6765\u8fdb\u884c\u6d4b\u8bd5\u4e86\uff0c\u56e0\u4e3a\u8fd9\u91cc\u53ea\u662f\u6d4b\u8bd5\uff0c\u6240\u4ee5\u6211\u4eec\u4e00\u5207\u4ece\u7b80\\r\\n\\r\\n##### \u670d\u52a1\u7aef\u4ee3\u7801\\r\\n\\r\\n\u6211\u4eec\u5728tracker\u6587\u4ef6\u5939\u540c\u7ea7\u65b0\u5efa\u4e00\u4e2aserver\u6587\u4ef6\u5939\\r\\n\\r\\n```shell\\r\\n\\tcd ..\\r\\n\\tmkdir server\\r\\n\\tcd server\\r\\n\\tpnpm init\\r\\n\\tpnpm add nodemon -D\\r\\n\\tpnpm add koa @koa/cors koa-router \\r\\n\\tpnpm pkg set scripts.start=\\"nodemon index.js\\"\\r\\n```\\r\\n\\r\\n`server/index.js`\u4ee3\u7801\u5982\u4e0b\\r\\n\\r\\n```javascript\\r\\nconst koa = require(\\"koa\\");\\r\\nconst Router = require(\\"koa-router\\");\\r\\nconst cors = require(\\"@koa/cors\\");\\r\\nconst app = new koa();\\r\\nconst router = new Router();\\r\\nrouter.post(\\"/tracker/update\\", (ctx) => {\\r\\n  console.log(ctx.request);\\r\\n  ctx.body = \\"\u4e0a\u62a5\u6210\u529f\\";\\r\\n});\\r\\napp.use(cors());\\r\\napp.use(router.routes()).use(router.allowedMethods());\\r\\napp.listen(3000, () => {\\r\\n  console.log(\\"server running at http://localhost:3000\\");\\r\\n});\\r\\n\\r\\n```\\r\\n\\r\\n\u5199\u597d\u670d\u52a1\u7aef\u4ee3\u7801\u540e\u76f4\u63a5`pnpm start`\u8fd0\u884c\uff0c\u7136\u540e\u65b0\u5efa\u6d4b\u8bd5\u6587\u4ef6\u5939\\r\\n\\r\\n```shell\\r\\n\\tcd ..\\r\\n\\tmkdir test\\r\\n```\\r\\n\\r\\n\u521b\u5efa`index.html`\\r\\n\\r\\n```html\\r\\n<!DOCTYPE html>\\r\\n<html lang=\\"en\\">\\r\\n  <head>\\r\\n    <meta charset=\\"UTF-8\\" />\\r\\n    <meta http-equiv=\\"X-UA-Compatible\\" content=\\"IE=edge\\" />\\r\\n    <meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\" />\\r\\n    <title>Document</title>\\r\\n  </head>\\r\\n  <body>\\r\\n    <button>\u8def\u7531\u8df3\u8f6c</button>\\r\\n    <script src=\\"./index.js\\" type=\\"module\\"><\/script>\\r\\n    <script>\\r\\n      const btn = document.querySelector(\\"button\\");\\r\\n      btn.onclick = () => {\\r\\n        history.pushState({ name: \\"chovrio\\" }, \\"test\\", \\"/tracker\\");\\r\\n      };\\r\\n    <\/script>\\r\\n  </body>\\r\\n</html>\\r\\n\\r\\n```\\r\\n\\r\\n\u521b\u5efa`index.js`\\r\\n\\r\\n```js\\r\\nimport Tracker from \\"../tracker/dist/index.js\\";\\r\\nnew Tracker({\\r\\n  historyTracker: true,\\r\\n});\\r\\n\\r\\n```\\r\\n\\r\\n\u6211\u4eec\u5f00\u59cb\u6d4b\u8bd5\uff0c\u53d1\u73b0\u5f53\u6211\u4eec\u70b9\u51fb\u6309\u94ae\u8fdb\u884c\u8def\u7531\u8df3\u8f6c\u7684\u65f6\u5019\uff0cupdate\u8bf7\u6c42\u5e76\u6ca1\u6709\u53d1\u51fa\uff0c\u5f53\u6211\u4eec\u8fdb\u884c\u6d4f\u89c8\u5668\u8def\u7531\u524d\u8fdb\u540e\u9000\u7684\u65f6\u5019\uff0c\u8bf7\u6c42\u53d1\u51fa\u4e86\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u4e8b\u4ef6\u7c7b\u578b\u90fd\u662fpopstate\uff0creplaceState\u548cpushState\u4e8b\u4ef6\u90fd\u6ca1\u6709\u6267\u884c\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3awindow\u4e0a\u6ca1\u6709\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u3002\\r\\n\\r\\n![image-20230211153929585](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211153929585.png)\\r\\n\\r\\n##### \u81ea\u5b9a\u4e49\u4e8b\u4ef6\\r\\n\\r\\n\u5728`utils/createEvent.ts`\u4e2d\u5199\u5165\u4ee5\u4e0b\u4ee3\u7801\\r\\n\\r\\n```typescript\\r\\nexport const createHistoryEvent = <T extends keyof History>(type: T) => {\\r\\n  // \u9996\u5148\u83b7\u5f97\u539f\u51fd\u6570\\r\\n  const origin = history[type];\\r\\n  // \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\\r\\n  return function (this: any) {\\r\\n    // \u65b0\u51fd\u6570\u7684this\u4e3a\u539f\u51fd\u6570\\r\\n    const res = origin.apply(this, arguments);\\r\\n    // \u65b0\u5efa\u4e00\u4e2a\u4e8b\u4ef6\u4e3a\u4f20\u5165\u53c2\u6570\\r\\n    const e = new Event(type);\\r\\n    // \u901a\u8fc7window\u6d3e\u53d1\u8fd9\u4e2a\u4e8b\u4ef6(\u53ea\u6709\u6d3e\u53d1\u540e\u624d\u80fd\u76d1\u542c\u5230)\\r\\n    window.dispatchEvent(e);\\r\\n    // \u8fd4\u56de\u65b0\u51fd\u6570\\r\\n    return res;\\r\\n  };\\r\\n};\\r\\n```\\r\\n\\r\\n\u7136\u540e\u6211\u4eec\u5728`core/index.ts`\u7684`Tracker`\u7c7b\u4e2d\u521d\u59cb\u5316\u9ed8\u8ba4\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u5c31\u521b\u5efa\u6d3e\u53d1\u65b0\u7684\u8def\u7531\u4e8b\u4ef6\uff0c\u6539\u5199\u540e`initDef`\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\n  private initDef(): DefaultOptons {\\r\\n    window.history[\\"pushState\\"] = createHistoryEvent(\\"pushState\\");\\r\\n    window.history[\\"replaceState\\"] = createHistoryEvent(\\"replaceState\\");\\r\\n    return <DefaultOptons>{\\r\\n      historyTracker: false,\\r\\n      hashTracker: false,\\r\\n      domTracker: false,\\r\\n      jsError: false,\\r\\n      sdkVersion: version,\\r\\n    };\\r\\n  }\\r\\n```\\r\\n\\r\\n\u7136\u540e\u6211\u4eec\u91cd\u65b0\u8fdb\u884c\u6253\u5305\uff0c\u518d\u6b21\u6d4b\u8bd5\u5c31\u6709\u6548\u679c\u4e86\\r\\n\\r\\n![image-20230211155814402](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211155814402.png)\\r\\n\\r\\n\u666e\u901a\u8def\u7531\u57cb\u70b9\u6682\u65f6over\\r\\n\\r\\n#### hash\u8def\u7531\u76d1\u542c\\r\\n\\r\\n**hash\u8def\u7531\u57cb\u70b9\u5b9e\u73b0\u5c31\u975e\u5e38\u7b80\u5355\u4e86**\uff0c\u56e0\u4e3a`window`\u672c\u8eab\u5c31\u62e5\u6709`hashChange`\u4e8b\u4ef6\uff0c\u5e76\u4e14\u56e0\u4e3a\u53ea\u662f\u951a\u70b9\u540e\u5185\u5bb9\u7684\u6539\u53d8\uff0c\u6d4f\u89c8\u5668\u5e76\u4e0d\u4f1a\u5237\u65b0,\u6211\u4eec\u5728`installTracker`\u51fd\u6570\u4e2d\u65b0\u589e\u5224\u65ad\u3002\u91cd\u65b0\u6253\u5305\\r\\n\\r\\n```typescript\\r\\n  private installTracker() {\\r\\n\\t// \u524d\u9762\u5185\u5bb9\u5c31\u4e0d\u91cd\u590d\u590d\u5236\u4e86\\r\\n    if (this.data.hashTracker) {\\r\\n      this.captureEvents([\\"hashchange\\"], \\"hash-pv\\", {\\r\\n        code: 10001,\\r\\n        type: \\"hash-history\\",\\r\\n        message: \\"\u7528\u6237\u6d4f\u89c8\u8bb0\u5f55 \\",\\r\\n      });\\r\\n    }\\r\\n  }\\r\\n```\\r\\n\\r\\n\u6d4b\u8bd5\u901a\u8fc7\u3002\u8bb0\u5f97`new Tracker\u5b9e\u4f8b\u7684\u65f6\u5019\u628a hashTracker \u8bbe\u7f6e\u4e3atrue`\\r\\n\\r\\n![image-20230211160827461](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211160827461.png)\\r\\n\\r\\n#### dom\u4e8b\u4ef6\u76d1\u542c\\r\\n\\r\\n##### \u6539\u5199\u7c7b\u578b\\r\\n\\r\\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u660e\u786e\u4ec0\u4e48\u6837\u7684\u5143\u7d20\u53d1\u751f\u4ec0\u4e48\u4e8b\u4ef6\u624d\u4ea7\u751f\u57cb\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u4fee\u6539`types/index.ts`\u4e0b\u7684 `DefaultOptions` \\r\\n\\r\\n```typescript\\r\\nexport interface DefaultOptons {\\r\\n  uuid: string | undefined;\\r\\n  requestUrl: string | undefined;\\r\\n  historyTracker: boolean;\\r\\n  hashTracker: boolean;\\r\\n  domTracker: boolean;\\r\\n  sdkVersion: string | number;\\r\\n  extra: Record<string, any> | undefined;\\r\\n  jsError: boolean;\\r\\n  elementEvent?: Array<keyof WindowEventMap>;\\r\\n  elementKey?: Array<string>;\\r\\n}\\r\\n```\\r\\n\\r\\n\u7136\u540e\u6211\u4eec\u5728`installTracker`\u4e2d\u65b0\u589e\u5224\u65ad\\r\\n\\r\\n```typescript\\r\\n    if (this.data.domTracker) {\\r\\n      this.targetKeyReport();\\r\\n    }\\r\\n```\\r\\n\\r\\n##### \u65b0\u589e\u65b9\u6cd5\\r\\n\\r\\n\u7136\u540e\u65b0\u589e\u4e8b\u4ef6\u76d1\u542c\uff0c\u8fd9\u91cc\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662fO(n^2)\uff0c\u6709\u4e9b\u590d\u6742\uff0c\u4f46\u662f\u4e00\u822c\u76d1\u542c\u4e8b\u4ef6\u548c\u76d1\u542c\u7c7b\u578b\u4e0d\u591a\\r\\n\\r\\n```typescript\\r\\n  private targetKeyReport() {\\r\\n    this.data.elementEvent?.forEach((event) => {\\r\\n      window.addEventListener(event, (e) => {\\r\\n        const target = e.target as HTMLElement;\\r\\n        this.data.elementKey?.forEach((key) => {\\r\\n          const targetKey = target.getAttribute(key);\\r\\n          if (targetKey)\\r\\n            this.reportTracker({\\r\\n              event,\\r\\n              targetKey,\\r\\n              data: {\\r\\n                code: 10003,\\r\\n                type: \\"dom\\",\\r\\n                message: \\"\u7528\u6237\u64cd\u4f5c\u8bb0\u5f55 \\",\\r\\n              },\\r\\n            });\\r\\n        });\\r\\n      });\\r\\n    });\\r\\n  }\\r\\n```\\r\\n\\r\\n\u91cd\u65b0\u6253\u5305\u4e00\u4e0b\u518d\u6b21\u6d4b\u8bd5 \u8fd9\u91cc\u6211\u4eec\u76f8\u5f53\u4e8e\u76d1\u542c\u4e86click\u4e8b\u4ef6\uff0c\u548c\u53d1\u751f\u4e8b\u4ef6\u5143\u7d20\u8eab\u4e0a\u662f\u5426\u5b58\u5728eat\u5c5e\u6027\\r\\n\\r\\n```js\\r\\n// index.js\\r\\nimport Tracker from \\"./dist/index.js\\";\\r\\nconst tracker = new Tracker({\\r\\n  requestUrl: \\"http://localhost:3000/tracker/update\\",\\r\\n  historyTracker: true,\\r\\n  hashTracker: true,\\r\\n  domTracker: true,\\r\\n  elementEvent: [\\"click\\"],\\r\\n  elementKey: [\\"eat\\"],\\r\\n});\\r\\n\\r\\n```\\r\\n\\r\\n```html\\r\\n<!DOCTYPE html>\\r\\n<html lang=\\"en\\">\\r\\n  <head>\\r\\n    <meta charset=\\"UTF-8\\" />\\r\\n    <meta http-equiv=\\"X-UA-Compatible\\" content=\\"IE=edge\\" />\\r\\n    <meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\" />\\r\\n    <title>Document</title>\\r\\n  </head>\\r\\n  <body>\\r\\n    <button eat=\\"\u5403\u996d\\">\u8def\u7531\u8df3\u8f6c</button>\\r\\n    <script src=\\"./index.js\\" type=\\"module\\"><\/script>\\r\\n    <script>\\r\\n      const btn = document.querySelector(\\"button\\");\\r\\n      btn.onclick = () => {\\r\\n        console.log(111);\\r\\n      };\\r\\n    <\/script>\\r\\n  </body>\\r\\n</html>\\r\\n\\r\\n```\\r\\n\\r\\n![image-20230211170511341](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211170511341.png)\\r\\n\\r\\n#### \u5168\u5c40\u9519\u8bef\u76d1\u542c(\u91cd\u8981)\\r\\n\\r\\n\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053\uff0c\u6d4f\u89c8\u5668\u73af\u5883\u4e0b\u4f1a\u51fa\u73b0\u7684\u9519\u8bef\u7c7b\u578b\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u4e24\u79cd\u3002\u5f02\u6b65\u9519\u8bef\u548c\u540c\u6b65\u9519\u8bef\u3002\u5f02\u6b65\u9519\u8bef\u5927\u90e8\u5206\u90fd\u4ea7\u751f\u81ea\u7f51\u7edc\u8bf7\u6c42\uff0c\u800c\u540c\u6b65\u9519\u8bef\u5219\u662f\u53d1\u751f\u5728\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b\u4e2d\u3002\u6355\u83b7\u9519\u8bef\u662f\u4e00\u4ef6\u975e\u5e38\u91cd\u8981\u7684\u4e8b\u60c5(\u4f60\u4e5f\u4e0d\u60f3\u7f51\u7ad9\u7a81\u7136\u5d29\u6389\u5427)\u3002\u5f53\u6211\u4eec\u8fd9\u91cc\u53ea\u662f\u505a\u7684\u9519\u8bef\u4e0a\u62a5\u3002\\r\\n\\r\\n##### \u4e86\u89e3\u5982\u4f55\u76d1\u542c\u9519\u8bef\\r\\n\\r\\n\u6211\u4eec\u6539\u5199`index.html`\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff0c\u70b9\u51fb\u6309\u94ae\u5373\u53ef\u4ea7\u751f\u9519\u8bef\u5e76\u76d1\u542c\u5230\u3002\u53ea\u8981\u662f\u5728`promise`\u4e2d\u6355\u83b7\u5230\u7684\u9519\u8bef\u4e8b\u4ef6\u90fd\u662f`unhandledrejection`\uff0c\u5728\u8fd9\u91cc\u4f7f\u7528fetch\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\\r\\n\\r\\n```html\\r\\n<!DOCTYPE html>\\r\\n<html lang=\\"en\\">\\r\\n  <head>\\r\\n    <meta charset=\\"UTF-8\\" />\\r\\n    <meta http-equiv=\\"X-UA-Compatible\\" content=\\"IE=edge\\" />\\r\\n    <meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\" />\\r\\n    <title>Document</title>\\r\\n  </head>\\r\\n  <body>\\r\\n    <button eat=\\"\u5403\u996d\\">\u8def\u7531\u8df3\u8f6c</button>\\r\\n    <script src=\\"./index.js\\" type=\\"module\\"><\/script>\\r\\n    <script>\\r\\n      const btn = document.querySelector(\\"button\\");\\r\\n      btn.onclick = () => {\\r\\n        fetch(\\"http://111111\\");\\r\\n        throw new Error(\\"\u9519\u8bef\u53d1\u751f\u4e86\\");\\r\\n      };\\r\\n      window.addEventListener(\\"unhandledrejection\\", (e) => {\\r\\n        console.log(\\"\u6211\u662freject\\", e);\\r\\n      });\\r\\n      window.addEventListener(\\"error\\", (e) => {\\r\\n        console.log(\\"\u6211\u662ferror\\", e);\\r\\n      });\\r\\n    <\/script>\\r\\n  </body>\\r\\n</html>\\r\\n\\r\\n```\\r\\n\\r\\n##### \u76d1\u542c\u9519\u8bef\\r\\n\\r\\n\u6211\u4eec\u5728`installTracker`\u51fd\u6570\u4e2d\u65b0\u589e\u5224\u65ad`jsError`\u662f\u5426\u5f00\u542f\\r\\n\\r\\n```typescript\\r\\n    if (this.data.jsError) {\\r\\n      this.jsError();\\r\\n    }\\r\\n```\\r\\n\\r\\n\u518d\u5728Tracker\u4e2d\u65b0\u589e\u51e0\u4e2a\u51fd\u6570\\r\\n\\r\\n```typescript\\r\\n  private errorEvent() {\\r\\n    window.addEventListener(\\"error\\", (event) => {\\r\\n      this.reportTracker({\\r\\n        event: \\"error\\",\\r\\n        targetKey: \\"\u540c\u6b65\u9519\u8bef\\",\\r\\n        data: {\\r\\n          code: 10004,\\r\\n          message: event.message,\\r\\n        },\\r\\n      });\\r\\n    });\\r\\n  }\\r\\n  private promiseReject() {\\r\\n    window.addEventListener(\\"unhandledrejection\\", (event) => {\\r\\n      event.promise.catch((error) => {\\r\\n        this.reportTracker({\\r\\n          event: \\"promise\\",\\r\\n          targetKey: \\"\u5f02\u6b65\u9519\u8bef\\",\\r\\n          error: {\\r\\n            code: 10005,\\r\\n            message: error,\\r\\n          },\\r\\n        });\\r\\n      });\\r\\n    });\\r\\n  }\\r\\n  private jsError() {\\r\\n    this.errorEvent();\\r\\n    this.promiseReject();\\r\\n  }\\r\\n```\\r\\n\\r\\n\u518d\u6b21\u8fdb\u884c\u6253\u5305\u8fdb\u884c\u6d4b\u8bd5(\u6ce8\u610f\u5728`index.js`\u4e2d\u8bbe\u7f6e`jsError:true`)\\r\\n\\r\\n![image-20230211224728217](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211224728217.png)\\r\\n\\r\\n## \u670d\u52a1\u7aef\u4ee3\u7801\u7684\u5b9e\u73b0\\r\\n\\r\\n\u670d\u52a1\u7aef\u53ea\u9700\u8981\u5199\u597d\u57fa\u672c\u4ee3\u7801\u5c31\u80fd\u8dd1\u4e86\uff0c\u81f3\u4e8e\u83b7\u5f97\u6570\u636e\u540e\u600e\u4e48\u5904\u7406\u5c31\u5168\u51ed\u559c\u597d\u4e86\uff0c\u57fa\u672c\u4ee3\u7801\u5982\u4e0b\\r\\n\\r\\n```js\\r\\nconst koa = require(\\"koa\\");\\r\\nconst Router = require(\\"koa-router\\");\\r\\nconst cors = require(\\"@koa/cors\\");\\r\\nconst path = require(\\"path\\");\\r\\nconst app = new koa();\\r\\nconst bodyParser = require(\\"koa-bodyparser\\");\\r\\nconst router = new Router();\\r\\nrouter.post(\\"/tracker/update\\", (ctx) => {\\r\\n  console.log(ctx.request.body);\\r\\n  const body = ctx.request.body;\\r\\n  for (const key in body) {\\r\\n    console.log(key);\\r\\n    console.log(body[key]);\\r\\n  }\\r\\n  ctx.body = \\"\u4e0a\u62a5\u6210\u529f\\";\\r\\n});\\r\\napp.use(cors()).use(bodyParser());\\r\\napp.use(router.routes()).use(router.allowedMethods());\\r\\napp.listen(3000, () => {\\r\\n  console.log(\\"server running at http://localhost:3000\\");\\r\\n});\\r\\n\\r\\n```\\r\\n\\r\\n\u6570\u636e\u5185\u5bb9\u5c55\u793a\\r\\n\\r\\n![image-20230211231633625](https://aesthetic-stroopwafel-621be5.netlify.app/tracker/image-20230211231633625.png)"},{"id":"/\u7528nextjs\u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u9879\u76ee","metadata":{"permalink":"/festudy/blog/\u7528nextjs\u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u9879\u76ee","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/\u7528nextjs\u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u9879\u76ee.md","source":"@site/blog/\u7528nextjs\u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u9879\u76ee.md","title":"\u7528 nextjs \u642d\u5efa\u4e2a\u4eba\u535a\u5ba2\u524d\u53f0","description":"\u524d\u8a00","date":"2023-09-28T09:34:51.000Z","formattedDate":"September 28, 2023","tags":[],"readingTime":27.22,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"prevItem":{"title":"\u624b\u5199\u524d\u7aef\u57cb\u70b9sdk","permalink":"/festudy/blog/tracker sdk"}},"content":"## \u524d\u8a00\\r\\n\\r\\n\u4e8c\u6708\u524d\u7684\u5c0f\u534a\u4e2a\u6708\u6211\u4e00\u76f4\u5728\u642d\u5efa\u81ea\u5df1\u7684\u4e2a\u4eba\u535a\u5ba2\u7684\u524d\u53f0\uff0c\u6280\u672f\u6808\u9009\u7528\u7684\u662f`nextjs`(\u56e0\u4e3a\u76f8\u8f83`vue`\u6211\u66f4\u559c\u6b22`react`\uff0c\u867d\u7136\u5b66\u7684\u90fd\u4e0d\u548b\u5730 \ud83d\ude25)\u3002\u56e0\u4e3a\u662f\u4e2a\u4eba\u9879\u76ee\uff0c\u6211\u6bd4\u8f83\u559c\u6b22\u4f7f\u7528\u8f83\u65b0\u7684\u4e1c\u897f\uff0c\u4f7f\u7528\u4e86`next13`\u8fd8\u5728`beta`\u9636\u6bb5\u7684`app`\u76ee\u5f55\u3002\u4f46\u662f\u505a\u5230\u540e\u9762\u6211\u53d1\u73b0\u7528`app`\u76ee\u5f55\u6211\u5f88\u96be\u786e\u5b9a\u81ea\u5df1\u7528\u7684\u5230\u5e95\u662f\u60f3\u4ee5\u54ea\u79cd\u6e32\u67d3\u6a21\u5f0f\u8fdb\u884c\u9875\u9762\u6e32\u67d3\uff0c\u5927\u90e8\u5206\u9875\u9762\u90fd\u662f`CSR(\u5ba2\u6237\u7aef\u6e32\u67d3)`\uff0c\u597d\u50cf\u6211\u4f7f\u7528`nextjs`\u8fd9\u4ef6\u4e8b\u60c5\u672c\u8eab\u5c31\u662f\u6ca1\u6709\u610f\u4e49\u4e00\u822c\u3002\u4e8e\u662f\u6211\u6253\u7b97\u4e0d\u91c7\u7528`app`\u76ee\u5f55\u91cd\u6784\u4e00\u4e0b\u8fd9\u4e2a\u524d\u53f0\u9879\u76ee\\r\\n\\r\\n## \u76ee\u524d\u6548\u679c\u56fe\\r\\n\\r\\n\u6837\u5f0f\u662f\u4eff`hexo`\u4e00\u4e2a\u4e3b\u9898 [hexo \u535a\u5ba2](https://chovrio.club/hexo/)\\r\\n\\r\\n[\u524d\u53f0\u535a\u5ba2\u76ee\u524d\u7ebf\u4e0a\u5730\u5740](https://blog.chovrio.club)\\r\\n\\r\\n<img src=\\"https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230214223700049.png\\" alt=\\"image-20230214223700049\\"  />\\r\\n\\r\\n<img src=\\"https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230214230450198.png\\" alt=\\"image-20230214230450198\\" style={{zoom:\\"50%\\"}} />\\r\\n\\r\\n<img src=\\"https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230214230613740.png\\" alt=\\"image-20230214230613740\\" style={{zoom:\\"50%\\"}} />\\r\\n\\r\\n<img src=\\"https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230214230646663.png\\" alt=\\"image-20230214230646663\\" style={{zoom:\\"50%\\"}} />\\r\\n\\r\\n## \u63d0\u9192\\r\\n\\r\\n\u8be5\u535a\u5ba2\u9879\u76ee\u4e0d\u662f\u7eaf\u7cb9\u901a\u8fc7`SSR`\u5c55\u793a`md`\u6587\u4ef6\u7684\u9879\u76ee\uff0c\u662f`SSR`\u548c`CSR`\u6df7\u5408\u7684\u3002\u6587\u7ae0\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7\u63a5\u53e3\u83b7\u53d6\u7684\u3002\u6211\u76ee\u524d\u7684\u670d\u52a1\u7aef\u9879\u76ee\u5728\u8fd9\u513f[blog-server](https://github.com/chovrio/blog-server)\uff0c\u5982\u679c\u53ea\u662f\u60f3\u8ddf\u7740\u6587\u7ae0\u4e86\u89e3\u4e00\u4e0b`SSR`\u7684\u8bdd\uff0c\u53ef\u4ee5\u8003\u8651\u76f4\u63a5\u4f7f\u7528\u3002\u9700\u8981\u5728\u6839\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a`.env`\u6587\u4ef6\u8bbe\u7f6e\u4e00\u4e9b\u914d\u7f6e\\r\\n\\r\\n```properties\\r\\nAPP_PORT = 8000 # \u670d\u52a1\u8fd0\u884c\u7aef\u53e3\\r\\nMONGO_HOST = 127.0.0.1 # mongodb\u6570\u636e\u5e93\u6240\u5728\u670d\u52a1\u5668 127.0.0.1 \u8868\u793a\u5c31\u5728\u672c\u673a\\r\\nMONGO_PORT = 27017 # mongodb\u7aef\u53e3\u53f7\\r\\nMONGO_DB = blog # \u6570\u636e\u5e93\u540d\u79f0\\r\\nJWT_SECRET = \u79cb # JWT\u9274\u6743\u7684\u4ee4\u724c\\r\\nSERVER_RUNNiNG = http://127.0.0.1:8000 # \u9879\u76ee\u8fd0\u884c\u5730\u5740 \u5f00\u53d1\u73af\u5883\\r\\nSERVER_RUNNiNG_PROD = https://blog-server.chovrio.club # \u9879\u76ee\u8fd0\u884c\u5730\u5740\u751f\u4ea7\u73af\u5883 \u4f46\u662f\u6211\u8fd8\u6ca1\u914d\u7f6e\u6253\u5305\u5de5\u5177\u6ca1\u6709\u505a\u533a\u5206\uff0c\u5f97\u624b\u52a8\u533a\u5206\\r\\n```\\r\\n\\r\\n\u4f46\u5982\u679c\u4f60\u4e5f\u60f3\u642d\u4e00\u4e2a\u7c7b\u4f3c\u7684\u535a\u5ba2\u7684\u8bdd\uff0c\u6211\u8fd8\u662f\u5efa\u8bae\u81ea\u5df1\u5199\u670d\u52a1\u7aef\u3002\u6216\u8005\u5c31\u4e0d\u91c7\u53d6\u8fd9\u79cd\u65b9\u5f0f\u3002\u76f4\u63a5\u5c06`md`\u6587\u4ef6\u653e\u5728\u4e00\u4e2a\u4e13\u95e8\u7684\u76ee\u5f55\u7136\u540e\u901a\u8fc7`fs`\u6a21\u5757\u53bb\u8bfb\u53d6\u5c31\u662f\u4e86(\u8fd9\u6837\u6027\u80fd\u4f1a\u597d\u4e00\u4e9b)\u3002\u6211\u5199\u670d\u52a1\u7aef\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u60f3\u901a\u8fc7\u540e\u53f0\u9879\u76ee\u6765\u7ba1\u7406\u6587\u7ae0\u548c\u5904\u7406\u4e00\u4e9b\u5176\u4ed6\u4fe1\u606f\uff0c\u6bd4\u5982\u6570\u636e\u57cb\u70b9\u4e4b\u7c7b\u7684\u3002\\r\\n\\r\\n\u8be5\u6587\u4e0d\u4f1a\u6d89\u53ca\u5230`nextjs`\u7684\u8be6\u7ec6\u8bb2\u89e3\u3002\u4f46\u662f\u5c31\u7b97\u662f\u6ca1\u4e86\u89e3\u8fc7`nextjs`\u7684\u5c0f\u767d\uff0c\u53ea\u8981\u8ddf\u7740\u6b65\u9aa4\u8d70\u4e5f\u662f\u80fd\u642d\u5efa\u51fa\u6765\u7684(\u5e94\u8be5\u5427)\u3002\\r\\n\\r\\n## \u9879\u76ee\u642d\u5efa\\r\\n\\r\\n### \u521b\u5efa\u9879\u76ee\\r\\n\\r\\nnext \u9879\u76ee\u5c31\u76f4\u63a5\u4f7f\u7528\u811a\u624b\u67b6\u642d\u5efa\uff0c\u6211\u8bd5\u8fc7\u7684\u811a\u624b\u67b6\u6709`create-next-app`\u548c`vite`\uff0c\u8fd9\u91cc\u6211\u5c31\u76f4\u63a5\u7528`create-next-app`\u4e86\\r\\n\\r\\n```shell\\r\\npnpm create next-app\\r\\n```\\r\\n\\r\\n\u4e00\u8def\u56de\u8f66\u5373\u53ef\uff0c\u5148\u4e0d\u5c1d\u8bd5\u65b0\u9c9c\u7684\u4e1c\u897f\u3002\u9879\u76ee\u76ee\u5f55\u5982\u4e0b\u3002\\r\\n\\r\\n<img src=\\"https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230214230934651.png\\" alt=\\"image-20230214230934651\\" style={{zoom:\\"80%\\"}} />![image-20230214234238411](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230214234238411.png)\\r\\n\\r\\n\u6211\u4eec\u5148\u5220\u9664`styles/Home.module.less`\u6587\u4ef6\uff0c\u6e05\u7a7a`styles/globals.css`\u6587\u4ef6\u5e76\u4fee\u6539`pages/index.tsx`\u4e0b\u9762\u7684\u4ee3\u7801\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\n\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n}\\r\\nconst Home: FC<IProps> = (props) => {\\r\\n  const { children } = props;\\r\\n  return <div>hello next</div>;\\r\\n};\\r\\nexport default Home;\\r\\nHome.displayName = \\"Home\\";\\r\\n```\\r\\n\\r\\n\u8fd0\u884c`pnpm dev`\u8bbf\u95ee`localhost:3000`\u53ef\u4ee5\u770b\u5230\u9875\u9762\u4e2d\u53ea\u6709\u4e00\u4e2a`hello next`.\\r\\n\\r\\n### \u9996\u9875`SEO`\u4f18\u5316\\r\\n\\r\\n\u4e2a\u4eba\u8ba4\u4e3a`SSR`\u6bd4\u4f20\u7edf`SPA`\u5e94\u7528\u7684\u4f18\u52bf\u4e3b\u8981\u4f53\u73b0\u4e8e`SEO`\u548c\u9996\u5c4f\u6e32\u67d3\u901f\u7387\u3002\\r\\n\\r\\n\u4fee\u6539`pages/_document.tsx`\u6587\u4ef6\u7684\u5185\u5bb9\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\nimport { Html, Head, Main, NextScript } from \\"next/document\\";\\r\\n\\r\\nexport default function Document() {\\r\\n  return (\\r\\n    <Html lang=\\"en\\">\\r\\n      {/* \u79fb\u52a8\u7aef\u9002\u914d */}\u7f51\u7ad9\u6807\u9898\\r\\n      <title>{process.env.NEXT_PUBLIC_TITLE}</title>\\r\\n      <Head>\\r\\n        {/* \u7f51\u9875\u63cf\u8ff0 */}\\r\\n        <meta name=\\"description\\" content=\\"chovrio\'blog\\" />\\r\\n        {/* \u7f51\u9875\u5173\u952e\u8bcd */}\\r\\n        <meta name=\\"keywords\\" content=\\"chovrio blog chovrio\'blog next\u535a\u5ba2\\" />\\r\\n        {/* \u79fb\u52a8\u7aef\u9002\u914d */}\\r\\n        <meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\" />\\r\\n        {/* \u7f51\u7ad9\u7684icon\u56fe\u6807 */}\\r\\n        <link rel=\\"icon\\" href=\\"/favicon.ico\\" />\\r\\n      </Head>\\r\\n      <body>\\r\\n        <Main />\\r\\n        <NextScript />\\r\\n      </body>\\r\\n    </Html>\\r\\n  );\\r\\n}\\r\\n```\\r\\n\\r\\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728`title`\u6807\u7b7e\u4e2d\u6211\u4eec\u4f7f\u7528\u4e86`process.env.NEXT_PUBLIC_TITLE`\uff0c\u8fd9\u884c\u4ee3\u7801\u4f1a\u53bb\u8bfb\u53d6\u6211\u4eec\u6839\u76ee\u5f55\u4e0b\u7684`.env*.(environment)`\u4e0b\u9762\u952e\u4e3a`NEXT_PUBLIC_TITLE`\u7684\u503c\u3002\u6240\u4ee5\u6211\u4eec\u5f97\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u9762\u65b0\u5efa\u4e00\u4e2a`.env`\u6587\u4ef6\uff0c\u5e76\u586b\u5165\u4ee5\u4e0b\u914d\u7f6e\u3002\u5f53\u7136\u4e0a\u9762`SEO`\u4e2d\u7684\u7f51\u7ad9\u63cf\u8ff0\u5173\u952e\u5b57\u4ee5\u53ca\u4e0b\u9762\u7684\u535a\u5ba2\u7f51\u7ad9\u6807\u9898\u90fd\u53ef\u4ee5\u81ea\u5df1\u968f\u610f\u5199\uff0c\u4e0d\u5fc5\u6309\u7167\u6211\u7684\u6765\u3002\\r\\n\\r\\n```properties\\r\\nNEXT_PUBLIC_TITLE = chovrio\'blog\\r\\n```\\r\\n\\r\\n### .env \u6587\u4ef6(\u6709\u57fa\u7840\u53ef\u76f4\u63a5\u8df3\u8fc7)\\r\\n\\r\\n\u7b80\u5355\u8bb2\u8ff0\u4e00\u4e0b\u5728`nextjs`\u4e2d\u5e94\u8be5\u5982\u4f55\u53bb\u4f7f\u7528`.env`\u914d\u7f6e\u6587\u4ef6\u3002\u6709\u56db\u79cd`.env`\u3001`.env.local`\u3001`.env.production`\u3001`.env.development`\u3002\\r\\n\\r\\n#### .env\\r\\n\\r\\n\u6240\u6709\u73af\u5883\u4e0b\u90fd\u53ef\u4f7f\u7528\uff0c\u4f18\u5148\u7ea7\u6700\u4f4e\\r\\n\\r\\n#### .env.development\u3001.env.production\\r\\n\\r\\n\u4f18\u5148\u7ea7\u9ad8\u4e8e.env\uff0c\u4f4e\u4e8e.env.local\uff0c\u53ea\u80fd\u8fd0\u884c\u4e0e\u7279\u5b9a\u7684\u73af\u5883\u3002\\r\\n\\r\\n#### .env.local\\r\\n\\r\\n\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u6240\u6709\u73af\u5883\u4e0b\u90fd\u53ef\u4ee5\u4f7f\u7528\\r\\n\\r\\n#### \u4e66\u5199.env \u6587\u4ef6\\r\\n\\r\\n```properties\\r\\nNAME = chovrio # \u53ea\u80fd\u5728\u670d\u52a1\u7aef\u4f7f\u7528\\r\\nNEXT_PUBLIC_NAME = choviro # \u670d\u52a1\u7aef\u5ba2\u6237\u7aef\u90fd\u53ef\u4ee5\u4f7f\u7528 \u5fc5\u987b\u4ee5 NEXT_PUBLIC \u5f00\u5934\\r\\n\\r\\n# \u4e0b\u9762\u662f\u4f1a\u7528\u5230\u7684\u4e00\u4e9b\u914d\u7f6e \u8bb0\u5f97\u628a # \u540e\u9762\u7684\u5185\u5bb9\u90fd\u5220\u6389\\r\\nNEXT_PUBLIC_TITLE = chovrio\'blog # \u9996\u9875\u6807\u9898\\r\\nNEXT_PUBLIC_DESCRIPTION = \u4e00\u4e2a\u57fa\u4e8enextjs\u7684\u7b80\u6613\u535a\u5ba2 # \u535a\u5ba2\u63cf\u8ff0\\r\\nNEXT_PUBLIC_BASEURL_DEV = http://localhost:3000 # \u5f00\u53d1\u6a21\u5f0f\u4e0b\u7684\u63a5\u53e3\u5730\u5740\uff0c\u56e0\u4e3a\u662f\u670d\u52a1\u7aef\u6e32\u67d3\u6240\u4ee5\u6ca1\u6709\u6d4f\u89c8\u5668\u8de8\u57df\u95ee\u9898\\r\\nNEXT_PUBLIC_BASEURL_PROD = https://blog-server.chovrio.club # \u751f\u4ea7\u6a21\u5f0f\u4e0b\u7684\u63a5\u53e3\u5730\u5740\uff0c\u767d\u540d\u5355\u53ea\u6709\u6211\u81ea\u5df1\u7684\u7f51\u7ad9\uff0c\u6240\u4ee5\u751f\u4ea7\u6a21\u5f0f\u4e0b\u4f60\u4eec\u4f1a\u62a5\u9519\u7684\\r\\nNEXT_PUBLIC_NAME = chovrio # \u8c01\u7684\u535a\u5ba2\uff0c\u5f80\u540e\u7684\u4ee3\u7801\u4f1a\u6839\u636e\u8fd9\u4e2aname\u53bb\u83b7\u5f97\u6587\u7ae0\\r\\nNEXT_PUBLIC_CONTENT = \u8ba4\u9519\u4eba\u5f88\u4e0d\u793c\u8c8c # \u4e2a\u4eba\u63cf\u8ff0\\r\\nNEXT_PUBLIC_GITHUB = https://github.com/chovrio # github\u5730\u5740\\r\\n\\r\\n# \u56e0\u4e3a\u521a\u5f00\u59cb\u5199\u7684\u65f6\u5019\u60f3\u7684\u6709\u70b9\u591a\uff0c\u8fd9\u4e2a\u524d\u53f0\u535a\u5ba2\u5c31\u663e\u5f97\u6709\u4e9b\u7578\u5f62\u4e86\u3002\\r\\n```\\r\\n\\r\\n### \u4e66\u5199\u9996\u9875\\r\\n\\r\\n#### \u80cc\u666f\u56fe\u7247\u53ca\u63cf\u8ff0\\r\\n\\r\\n\u6b64\u65f6\u6211\u4eec`pnpm dev`\u4f1a\u53d1\u73b0\u9875\u9762\u7684 title \u5df2\u7ecf\u53d8\u6210`.env`\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u8fd8\u539f\u9996\u9875\u4e86\\r\\n\\r\\n\u56e0\u4e3a\u6211\u8fd9\u91cc\u662f\u7528\u7684`scss`\u6765\u7f16\u5199`css`\u6837\u5f0f\u7684\u6240\u4ee5\u6211\u4eec\u5148\u4e0b\u8f7d`scss`\uff0c\u4e5f\u53ef\u4ee5\u91c7\u7528`less`\u6216\u8005`css`\u4e0d\u5fc5\u5b8c\u5168\u548c\u6211\u4e00\u81f4\\r\\n\\r\\n```shell\\r\\npnpm add sass -D\\r\\n```\\r\\n\\r\\n\u56e0\u4e3a`nextjs`\u811a\u624b\u67b6\u5e95\u5c42\u505a\u4e86\u914d\u7f6e\uff0c\u5b89\u88c5\u597d\u540e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528`sass`\uff0c\u4e0d\u7528\u518d\u505a\u5176\u4ed6\u914d\u7f6e\\r\\n\\r\\n\u4fee\u6539`pages/index.tsx`\u7684\u4ee3\u7801\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\n\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n}\\r\\nconst Home: FC<IProps> = (props) => {\\r\\n  const { children } = props;\\r\\n  return (\\r\\n    <div>\\r\\n      <div className=\\"home\\">\\r\\n        <h2 className=\\"description\\">{process.env.NEXT_PUBLIC_DESCRIPTION}</h2>\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Home;\\r\\nHome.displayName = \\"Home\\";\\r\\n```\\r\\n\\r\\n\u518d\u5728`styles`\u76ee\u5f55\u4e0b\u65b0\u589e`Home.scss`\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\\r\\n\\r\\n```scss\\r\\n.home {\\r\\n  width: 100vw;\\r\\n  height: 100vh;\\r\\n  background-size: cover;\\r\\n  background-position: center center;\\r\\n  background-image: url(/xia.jpg);\\r\\n  color: #fff;\\r\\n  .description {\\r\\n    position: absolute;\\r\\n    width: 100%;\\r\\n    text-align: center;\\r\\n    top: 40vh;\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u5728`public`\u76ee\u5f55\u4e0b\u6dfb\u52a0\u81ea\u5df1\u60f3\u7528\u7684\u80cc\u666f\u56fe\u7247\u5e76\u5728`Home.scss`\u4e2d\u5f15\u7528\uff0c\u6211\u8fd9\u91cc\u662f`xia.png`\u56e0\u4e3a\u6211\u633a\u559c\u6b22\u90a3\u4e2a\u6a31\u82b1\u6548\u679c\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u56fe\u7247\u548c\u5b83\u5f88\u914d\\r\\n\\r\\n\u7136\u540e\u5728`pages/_app.tsx`\u6587\u4ef6\u4e0b\u5f15\u5165\u6837\u5f0f\uff0c\u6240\u6709\u7684\u6837\u5f0f\u6587\u4ef6\u90fd\u53ea\u80fd\u5728`_app.tsx`\u91cc\u9762\u5f15\u5165\uff0c\u4e0d\u80fd\u76f4\u63a5\u5728`idnex.tsx`\u4e2d\u5f15\u5165\\r\\n\\r\\n```typescript\\r\\nimport \\"@/styles/Home.scss\\";\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\u7684\u6548\u679c\u56fe\u5982\u4e0b\uff0c\u6211\u4eec\u53d1\u73b0\u6709\u8fb9\u8ddd\u3002\\r\\n\\r\\n![image-20230216150758051](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216150758051.png)\\r\\n\\r\\n\u4fee\u6539`styles`\u76ee\u5f55\u4e0b\u7684`globals.css`\u4e3a`globals.scss`\uff0c\u8bb0\u5f97\u5728`_app.tsx`\u4e2d\u4fee\u6539\u5f15\u5165\u7684\u540d\u79f0\u3002\u7136\u540e\u5c31\u6ca1\u6709\u5185\u5916\u8fb9\u8ddd\u4e86\\r\\n\\r\\n```scss\\r\\n// globals.scss\\r\\n* {\\r\\n  padding: 0;\\r\\n  margin: 0;\\r\\n}\\r\\n```\\r\\n\\r\\n#### \u7ad9\u70b9\u540d\u79f0\u53ca\u8df3\u52a8\u7684\u7bad\u5934\\r\\n\\r\\n##### \u7ad9\u70b9\u540d\u79f0\\r\\n\\r\\n\u6211\u4eec\u5728\u6839\u76ee\u5f55\u65b0\u5efa`components`\u6587\u4ef6\u5939\uff0c\u65b0\u5efa`Title/index.tsx`\u7ec4\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\n\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n}\\r\\nconst Title: FC<IProps> = (props) => {\\r\\n  return (\\r\\n    <div className=\\"title\\">\\r\\n      <div className=\\"name\\">{process.env.NEXT_PUBLIC_TITLE}</div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Title;\\r\\nTitle.displayName = \\"Title\\";\\r\\n```\\r\\n\\r\\n##### \u8df3\u52a8\u7684\u7bad\u5934\\r\\n\\r\\n\u5728`components`\u76ee\u5f55\u4e0b\u65b0\u5efa`Down/index.tsx`\uff0c\u5185\u5bb9\u5982\u4e0b\\r\\n\\r\\n```typescript\\r\\nimport Image from \\"next/image\\";\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n}\\r\\nconst Down: FC<IProps> = (props) => {\\r\\n  return (\\r\\n    <div className=\\"down\\">\\r\\n      <Image src={\\"/down.png\\"} alt={\\"\u5411\u4e0b\\"} width={30} height={30} />\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Down;\\r\\nDown.displayName = \\"Down\\";\\r\\n```\\r\\n\\r\\n\u7ec4\u4ef6\u5199\u597d\u4e86\uff0c\u6211\u4eec\u5728`pages/index.tsx`\u4e2d\u5f15\u7528\\r\\n\\r\\n```typescript\\r\\nimport Down from \\"@/components/Down\\";\\r\\nimport Title from \\"@/components/Title\\";\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n}\\r\\nconst Home: FC<IProps> = (props) => {\\r\\n  const { children } = props;\\r\\n  return (\\r\\n    <div>\\r\\n      <div className=\\"home\\">\\r\\n        <Title />\\r\\n        <h2 className=\\"description\\">{process.env.NEXT_PUBLIC_DESCRIPTION}</h2>\\r\\n        <Down />\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Home;\\r\\nHome.displayName = \\"Home\\";\\r\\n```\\r\\n\\r\\n\u5e76\u4fee\u6539`Home.scss`\u5982\u4e0b\\r\\n\\r\\n```scss\\r\\n.home {\\r\\n  width: 100vw;\\r\\n  height: 100vh;\\r\\n  background-size: cover;\\r\\n  background-position: center center;\\r\\n  background-image: url(/xia.jpg);\\r\\n  color: #fff;\\r\\n  .title {\\r\\n    height: 55px;\\r\\n    font-size: 26px;\\r\\n    font-weight: 700;\\r\\n    display: flex;\\r\\n    line-height: 55px;\\r\\n    .name {\\r\\n      flex: 1;\\r\\n      padding-left: 10px;\\r\\n    }\\r\\n  }\\r\\n  .description {\\r\\n    position: absolute;\\r\\n    width: 100%;\\r\\n    text-align: center;\\r\\n    top: 40vh;\\r\\n  }\\r\\n  .down {\\r\\n    position: absolute;\\r\\n    bottom: 20px;\\r\\n    left: 50%;\\r\\n    transform: translateX(-50%);\\r\\n    animation: move 1.5s ease infinite alternate;\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n  }\\r\\n  @keyframes move {\\r\\n    0% {\\r\\n      bottom: 20px;\\r\\n      opacity: 0.4;\\r\\n    }\\r\\n    50% {\\r\\n      bottom: 36px;\\r\\n      opacity: 1;\\r\\n    }\\r\\n    100% {\\r\\n      bottom: 20px;\\r\\n      opacity: 0.4;\\r\\n    }\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\u6548\u679c\u56fe\u5982\u4e0b\\r\\n\\r\\n![image-20230216152336495](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216152336495.png)\\r\\n\\r\\n### \u5c01\u88c5 axios\\r\\n\\r\\n\u4e0b\u9762\u7684\u5185\u5bb9\u9700\u8981\u4f7f\u7528\u5230\u7f51\u7edc\u8bf7\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u5148\u7b80\u5355\u7684\u5c01\u88c5\u4e00\u4e0b`axios`\uff0c\u5728\u6839\u76ee\u5f55\u65b0\u5efa\u4e00\u4e2a`service`\u6587\u4ef6\u5939\uff0c\u56e0\u4e3a\u5c01\u88c5\u4e0d\u662f\u91cd\u70b9\uff0c\u8fd9\u91cc\u6211\u5c31\u76f4\u63a5\u8d34\u4ee3\u7801\u4e86(\u597d\u50cf\u4e00\u76f4\u90fd\u662f\u5728\u8d34\u4ee3\u7801 \ud83d\ude34)\\r\\n\\r\\n```typescript\\r\\nimport axios from \\"axios\\";\\r\\nimport type { AxiosRequestConfig, AxiosInstance, AxiosResponse } from \\"axios\\";\\r\\nclass Request {\\r\\n  instance: AxiosInstance;\\r\\n  constructor(config: AxiosRequestConfig) {\\r\\n    this.instance = axios.create(config);\\r\\n  }\\r\\n  // \u516c\u5171\u7684\u8bf7\u6c42\u7684\u65b9\u6cd5\\r\\n  request<T = any>(config: AxiosRequestConfig): Promise<AxiosResponse<T>> {\\r\\n    return new Promise((resolve, reject) => {\\r\\n      // \u5f00\u59cb\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\\r\\n      this.instance\\r\\n        .request<T>(config)\\r\\n        .then((res) => {\\r\\n          resolve(res);\\r\\n        })\\r\\n        .catch((err) => {\\r\\n          reject(err);\\r\\n        });\\r\\n    });\\r\\n  }\\r\\n  get<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"get\\" });\\r\\n  }\\r\\n  post<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"post\\" });\\r\\n  }\\r\\n  delete<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"delete\\" });\\r\\n  }\\r\\n  put<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"put\\" });\\r\\n  }\\r\\n}\\r\\n\\r\\n// eslint-disable-next-line import/no-anonymous-default-export\\r\\nexport default new Request({\\r\\n  baseURL:\\r\\n    process.env.NODE_ENV === \\"development\\"\\r\\n      ? process.env.NEXT_PUBLIC_BASEURL_DEV\\r\\n      : process.env.NEXT_PUBLIC_BASEURL_PROD,\\r\\n  timeout: 10000,\\r\\n});\\r\\n```\\r\\n\\r\\n### `nextjs`\u7684\u51e0\u79cd\u6e32\u67d3\u6a21\u5f0f\\r\\n\\r\\n\u5728\u8d34\u4ee3\u7801\u4e4b\u524d\u4e0d\u5f97\u4e0d\u5148\u8bf4`nextjs`\u7684\u51e0\u79cd\u6e32\u67d3\u6a21\u5f0f\uff0c\u4e0d\u7136\u7eaf\u5c0f\u767d\u53ef\u80fd\u4f1a\u770b\u7684\u4e91\u91cc\u96fe\u91cc\u7684\u3002\\r\\n\\r\\n#### 1.SSR(\u670d\u52a1\u7aef\u6e32\u67d3)\\r\\n\\r\\n\u9996\u5148\u5c31\u662f`ssr`\u6e32\u67d3\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u5728\u6587\u4ef6\u4e2d\u540c\u6b65\u5bfc\u51fa`getServerSideProps`\u8fd9\u4e2a\u51fd\u6570\u5e76\u5728\u91cc\u9762\u8fdb\u884c\u4e00\u4e9b\u83b7\u53d6\u5728\u9875\u9762\u4e2d\u60f3\u8981\u4f7f\u7528\u7684\u6570\u636e\u7684\u64cd\u4f5c,\u7136\u540e\u5c06\u6570\u636e\u8fd4\u56de\u5230 props \u4e2d\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0a\u9762\u7684\u9875\u9762\u7ec4\u4ef6\u7684`props`\u4e2d\u83b7\u5f97\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u5e76\u4e14\u662f\u5728\u9875\u9762\u6e32\u67d3\u524d\u5c31\u83b7\u5f97\u3002\\r\\n\\r\\n```typescript\\r\\nexport const getServerSideProps: GetStaticProps = async (ctx) => {\\r\\n  // ctx\u662f\u4e0a\u4e0b\u6587\uff0c\u91cc\u9762\u6709\u975e\u5e38\u591a\u6211\u4eec\u7528\u5f97\u4e0a\u7684\u5c5e\u6027\uff0c\u6bd4\u5982\u8def\u7531\u53c2\u6570\u3002\\r\\n  // \u5047\u5982\u6211\u5728\u8fd9\u91cc\u53d1\u9001\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42 \u7f51\u9875\u8def\u7531\u5982\u4e0b http://localhost:3000?name=chovrio\\r\\n  const res = await axios.get(`http://127.0.0.1:3000/api/userinfo\')\\r\\n  return {\\r\\n    props: {\\r\\n    \\tuser:res\\r\\n    },\\r\\n  };\\r\\n};\\r\\n\\r\\n```\\r\\n\\r\\n#### 2.SSG(\u9759\u6001\u9875\u9762\u751f\u6210)\\r\\n\\r\\n\u8fd9\u79cd\u6e32\u67d3\u6a21\u5f0f\u4f1a\u5728\u6211\u4eec`pnpm build`\u7684\u65f6\u5019\u81ea\u52a8\u5c06\u9875\u9762\u521b\u5efa\u597d\uff0c\u76f8\u5f53\u4e8e\u5c31\u662f\u7eaf\u7cb9\u7684\u9759\u6001\u9875\u9762\u4e86\u3002\u751f\u6210\u9875\u9762\u53ef\u4ee5\u5728`.next/servcer/pages`\u4e0b\u9762\u627e\u5bfb\u5230\u3002\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u5728`getStaticProps`\u8fd9\u4e2a\u51fd\u6570\u91cc\u9762\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\u5c06\u6570\u636e\u6ce8\u5165\u5230\u9875\u9762\u4e2d\uff0c\u4f46\u662f\u6570\u636e\u53ea\u548c\u6253\u5305\u65f6\u4fdd\u6301\u4e00\u81f4\uff0c\u5c31\u7b97\u540e\u9762\u8fd9\u4e2a\u63a5\u53e3\u6570\u636e\u6539\u53d8\u4e86\u3002\u751f\u6210\u7684\u9759\u6001\u9875\u9762\u4e5f\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\\r\\n\\r\\n```typescript\\r\\nexport const getStaticProps: GetStaticProps = async (context: any) => {\\r\\n  const res = await axios.get(`http://127.0.0.1:3000/api/userinfo\')\\r\\n  return {\\r\\n    props: {\\r\\n    \\tuser:res\\r\\n    },\\r\\n  };\\r\\n};\\r\\n```\\r\\n\\r\\n#### 3.ISG(\u9759\u6001\u589e\u91cf\u518d\u751f)\\r\\n\\r\\n\u8fd9\u79cd\u6e32\u67d3\u6a21\u5f0f\u548c SSG \u5176\u5b9e\u5f88\u50cf\uff0c\u552f\u4e00\u7684\u4e0d\u540c\u70b9\u5c31\u662f\uff0c\u8fd9\u79cd\u6e32\u67d3\u6a21\u5f0f\u7684\u9875\u9762\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u66f4\u65b0\u6570\u636e\u7684\u65f6\u95f4\\r\\n\\r\\n```typescript\\r\\nexport const getStaticProps: GetStaticProps = async (context: any) => {\\r\\n  const res = await axios.get(`http://127.0.0.1:3000/api/userinfo\')\\r\\n  return {\\r\\n    props: {\\r\\n    \\tuser:res\\r\\n    },\\r\\n    revalidate: 60,// \u5355\u4f4ds \u8fd9\u91cc\u8868\u793a 60s \u66f4\u65b0\u4e00\u6b21\u9875\u9762\u6570\u636e\\r\\n  };\\r\\n};\\r\\n```\\r\\n\\r\\n#### 4.CSR(\u5ba2\u6237\u7aef\u6e32\u67d3)\\r\\n\\r\\n\u5c31\u662f\u4f20\u7edf\u7684\u5ba2\u6237\u7aef\u6e32\u67d3\uff0c\u6211\u4eec\u76f4\u63a5\u5728\u6587\u4ef6\u91cc\u9762\u5199\u4ee3\u7801\u5c31\u662f\u4e86\uff0c\u6bd4\u5982\u6570\u636e\u5728\u9875\u9762\u52a0\u8f7d\u7684\u65f6\u5019\u83b7\u53d6\\r\\n\\r\\n```typescript\\r\\nconst Test: FC<IProps> = (props) => {\\r\\n    useEffect(()=>{\\r\\n        axios.get(......)\\r\\n    })\\r\\n  return (\\r\\n    <div>test</div>\\r\\n  );\\r\\n};\\r\\n```\\r\\n\\r\\n### \u6587\u7ae0\u5217\u8868\\r\\n\\r\\n\u8fd9\u91cc\u6211\u4eec\u6765\u5199\u6587\u7ae0\u7684\u5217\u8868\uff0c\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u4e1c\u897f\u3002\\r\\n\\r\\n![image-20230216151213763](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216151213763.png)\\r\\n\\r\\n\u6211\u4eec\u4f9d\u65e7\u5728`components`\u4e0b\u9762\u65b0\u5efa\u7ec4\u4ef6`Articles/index.tsx`\uff0c\u7136\u540e\u56e0\u4e3a\u6211\u53ef\u80fd\u4f1a\u5728\u540e\u53f0\u64cd\u4f5c\u6587\u7ae0\u3002\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528`ISG`\u6e32\u67d3\u6a21\u5f0f\uff0c\u5e76\u4e14\u8ba9\u5b83\u6bcf\u534a\u4e2a\u5c0f\u65f6\u66f4\u65b0\u4e00\u6b21\u6570\u636e\u3002\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\\r\\n\\r\\n#### types/articles.ts\\r\\n\\r\\n\u65b0\u5efa\u6587\u4ef6\u53ca\u6587\u4ef6\u5939\uff0c\u5b9a\u4e49\u6587\u7ae0\u7684\u7c7b\u578b\uff0c\u8fd9\u91cc\u662f\u63a5\u53e3\u8fd4\u56de\u7684\u6587\u7ae0\u7c7b\u578b\\r\\n\\r\\n```typescript\\r\\nexport interface IArticle {\\r\\n  _id: string;\\r\\n  name: string;\\r\\n  author: string;\\r\\n  tags: string[];\\r\\n  createTime: number;\\r\\n  updateTime: number;\\r\\n}\\r\\nexport interface IResult<T> {\\r\\n  code: number;\\r\\n  message: string;\\r\\n  result: T;\\r\\n}\\r\\n```\\r\\n\\r\\n#### service/article.ts\\r\\n\\r\\n\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u914d\u7f6e\u7684`name`\u6765\u83b7\u5f97\u6587\u7ae0\u5217\u8868\\r\\n\\r\\n```typescript\\r\\nimport instance from \\".\\";\\r\\nimport type { IArticle, IResult } from \\"@/types/article\\";\\r\\n\\r\\nexport const getAllArticle = async () => {\\r\\n  const res = await instance.get<IResult<IArticle[]>>({\\r\\n    url: `/essay/acquire-fe?name=${process.env.NEXT_PUBLIC_NAME}`,\\r\\n  });\\r\\n  return res.data;\\r\\n};\\r\\n```\\r\\n\\r\\n#### pages/index.tsx\\r\\n\\r\\n\u9996\u9875\u7684\u4e3b\u6587\u4ef6\uff0c\u4f7f\u7528\u4e86`getStaticProps`\u51fd\u6570\uff0c\u5728\u5176\u4e2d\u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42\uff0c\u5e76\u5c06\u8fd4\u56de\u7684\u6570\u636e\u6ce8\u5165\u5230\u4e86 props \u4e2d\uff0c\u7136\u540e\u518d\u5c06\u6570\u636e\u6ce8\u5165\u5230`Articles`\u7ec4\u4ef6\\r\\n\\r\\n```typescript\\r\\n// pages/index.tsx\\r\\nimport Articles from \\"@/components/Articles\\";\\r\\nimport Down from \\"@/components/Down\\";\\r\\nimport Title from \\"@/components/Title\\";\\r\\nimport { getAllArticle } from \\"@/service/article\\";\\r\\nimport { IArticle } from \\"@/types/article\\";\\r\\nimport { GetStaticProps } from \\"next\\";\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n  articles: IArticle[];\\r\\n}\\r\\nconst Home: FC<IProps> = (props) => {\\r\\n  const { children, articles } = props;\\r\\n  return (\\r\\n    <div>\\r\\n      <div className=\\"home\\">\\r\\n        <Title />\\r\\n        <h2 className=\\"description\\">{process.env.NEXT_PUBLIC_DESCRIPTION}</h2>\\r\\n        <Down />\\r\\n      </div>\\r\\n      <div className=\\"bottom\\">\\r\\n        <Articles articles={articles} />\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Home;\\r\\nHome.displayName = \\"Home\\";\\r\\nexport const getStaticProps: GetStaticProps = async (ctx) => {\\r\\n  const allArticle = await getAllArticle();\\r\\n  return {\\r\\n    props: {\\r\\n      articles: allArticle.result,\\r\\n    },\\r\\n    revalidate: 60 * 60 * 30,\\r\\n  };\\r\\n};\\r\\n```\\r\\n\\r\\n#### utils/getTime\\r\\n\\r\\n\u5c06\u65f6\u95f4\u6233\u8f6c\u5316\u4e3a\u5b57\u7b26\\r\\n\\r\\n```typescript\\r\\nexport const getTime = (time: number, flag = false) => {\\r\\n  const t = new Date(time);\\r\\n  const Y = t.getFullYear();\\r\\n  const M = t.getMonth() + 1;\\r\\n  const D = t.getDate();\\r\\n  const h = t.getHours() < 10 ? \\"0\\" + t.getHours() : t.getHours();\\r\\n  const m = t.getMinutes() < 10 ? \\"0\\" + t.getMinutes() : t.getMinutes();\\r\\n\\r\\n  return flag ? `${Y}\u5e74${M}\u6708${D}\u65e5 ${h}:${m}` : `${Y}\u5e74${M}\u6708${D}\u65e5`;\\r\\n};\\r\\n```\\r\\n\\r\\n#### components/Articles/index.tsx\\r\\n\\r\\n\u901a\u8fc7\u6ce8\u5165\u7684\u6587\u7ae0\u6570\u7ec4\u6e32\u67d3\u9875\u9762\uff0c\u8fd9\u91cc\u662f`CSR`\u5ba2\u6237\u7aef\u6e32\u67d3\u6a21\u5f0f(\u6211\u4e0d\u77e5\u9053\u8fd9\u4e48\u8bf4\u5bf9\u4e0d\u5bf9\uff0c\u4f46\u662f\u7236\u7ec4\u4ef6\u91c7\u7528 SSR\uff0c\u5e76\u4e0d\u59a8\u788d\u5b50\u7ec4\u4ef6\u91c7\u7528 CSR \u65b9\u6cd5)\u3002\\r\\n\\r\\n```typescript\\r\\n// components/Articles/index.tsx\\r\\nimport { IArticle } from \\"@/types/article\\";\\r\\nimport { getTime } from \\"@/utils/getTime\\";\\r\\nimport Link from \\"next/link\\";\\r\\nimport { FC, ReactElement, useEffect, useState } from \\"react\\";\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n  articles: IArticle[];\\r\\n}\\r\\nconst Articles: FC<IProps> = (props) => {\\r\\n  const { articles } = props;\\r\\n  const [showArti, setShowArti] = useState<any[]>([]);\\r\\n  const [pages, setPages] = useState<any[]>([]);\\r\\n  useEffect(() => {\\r\\n    const arr = articles.slice(0, 3);\\r\\n    let t: any[] = [];\\r\\n    for (let i = 0; i < Math.ceil(articles.length / 3); i++) {\\r\\n      t.push(i);\\r\\n    }\\r\\n    setPages(t);\\r\\n    setShowArti(arr);\\r\\n  }, [articles]);\\r\\n  const changePage = (page: number) => {\\r\\n    const arr = articles.slice(page * 3, page * 3 + 3);\\r\\n    setShowArti(arr);\\r\\n  };\\r\\n  return (\\r\\n    <div className=\\"lists\\">\\r\\n      {showArti.length !== 0 &&\\r\\n        showArti.map((item) => (\\r\\n          <Link href={`/posts/${item._id}`} className=\\"essay\\" key={item._id}>\\r\\n            <div className=\\"Img\\"></div>\\r\\n            <div className=\\"content\\">\\r\\n              <h1 className=\\"title\\">{item.name}</h1>\\r\\n              <p>\u6807\u7b7e\uff1a{item.tags.join(\\"\uff0c\\")}</p>\\r\\n              <p>\u53d1\u8868\u4e8e\uff1a{getTime(item.createTime)}</p>\\r\\n              <p>\u66f4\u65b0\u4e8e\uff1a{getTime(item.updateTime)}</p>\\r\\n            </div>\\r\\n          </Link>\\r\\n        ))}\\r\\n      <div className=\\"pages\\">\\r\\n        {articles.length !== 0 &&\\r\\n          pages.map((_, index) => (\\r\\n            <span\\r\\n              key={Math.random()}\\r\\n              onClick={() => changePage(index)}\\r\\n              className=\\"page\\"\\r\\n            >\\r\\n              {index + 1}\\r\\n            </span>\\r\\n          ))}\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Articles;\\r\\nArticles.displayName = \\"Articles\\";\\r\\n```\\r\\n\\r\\n#### styles/bottom.scss\\r\\n\\r\\n\u5e95\u90e8\u5e03\u5c40\\r\\n\\r\\n```scss\\r\\n// styles/bottom.scss\\r\\n.bottom {\\r\\n  display: flex;\\r\\n}\\r\\n@media screen and (min-width: 1000px) and (max-width: 100vw) {\\r\\n  .bottom {\\r\\n    align-items: flex-start;\\r\\n    justify-content: center;\\r\\n  }\\r\\n}\\r\\n@media screen and (min-width: 550px) and (max-width: 1000px) {\\r\\n  .bottom {\\r\\n    flex-direction: column;\\r\\n    align-items: center;\\r\\n  }\\r\\n}\\r\\n\\r\\n@media screen and (max-width: 550px) {\\r\\n  .bottom {\\r\\n    flex-direction: column;\\r\\n    align-items: center;\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n#### styles/globals.scss\\r\\n\\r\\n\u5168\u5c40\u6837\u5f0f\uff0c\u8fd9\u91cc\u4fee\u6539\u4e86\u6eda\u52a8\u6761\u7684\u6837\u5f0f\\r\\n\\r\\n```scss\\r\\n// styles/globals.scss\\r\\n* {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  font-family: -apple-system, BlinkMacSystemFont, \\"Segoe UI\\", \\"Helvetica Neue\\",\\r\\n    Lato, Roboto, \\"PingFang SC\\", \\"Microsoft YaHei\\", sans-serif;\\r\\n}\\r\\n// \u4fee\u6539\u6eda\u52a8\u6761\u6837\u5f0f\\r\\nhtml {\\r\\n  overflow-x: hidden;\\r\\n  overflow-y: auto;\\r\\n}\\r\\n\\r\\n::-webkit-scrollbar {\\r\\n  width: 6px;\\r\\n  height: 6px;\\r\\n  overflow: auto;\\r\\n}\\r\\n::-webkit-scrollbar-thumb {\\r\\n  background-color: #e6e6e6;\\r\\n  min-height: 25px;\\r\\n  min-width: 25px;\\r\\n  border: 1px solid #e0e0e0;\\r\\n  border-radius: 99px;\\r\\n}\\r\\n::-webkit-scrollbar-track {\\r\\n  background-color: #f7f7f7;\\r\\n  border: 1px solid #efefef;\\r\\n}\\r\\n\\r\\n::-webkit-scrollbar-thumb {\\r\\n  background-color: #49b1f5;\\r\\n}\\r\\na {\\r\\n  text-decoration: none;\\r\\n  color: #000;\\r\\n}\\r\\n```\\r\\n\\r\\n#### styles/lists.scss\\r\\n\\r\\n\u6587\u7ae0\u5217\u8868\u7684\u6837\u5f0f\\r\\n\\r\\n```scss\\r\\n// styles/lists.scss\\r\\n.lists {\\r\\n  margin: 30px 10px 10px 10px;\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n  align-items: center;\\r\\n  .essay {\\r\\n    display: flex;\\r\\n    font-family: -apple-system, BlinkMacSystemFont, \\"Segoe UI\\",\\r\\n      \\"Helvetica Neue\\", Lato, Roboto, \\"PingFang SC\\", \\"Microsoft YaHei\\",\\r\\n      sans-serif;\\r\\n    height: 250px;\\r\\n    margin-top: 20px;\\r\\n    overflow: hidden;\\r\\n    box-shadow: 0 3px 8px 6px rgba(7, 17, 27, 0.05);\\r\\n    border-radius: 20px;\\r\\n    cursor: pointer;\\r\\n  }\\r\\n  .pages {\\r\\n    .page {\\r\\n      display: inline-block;\\r\\n      text-align: center;\\r\\n      line-height: 35px;\\r\\n      width: 35px;\\r\\n      height: 35px;\\r\\n      margin: 10px;\\r\\n      background: #00c4b6;\\r\\n      border-radius: 8px;\\r\\n      color: #fff;\\r\\n    }\\r\\n  }\\r\\n}\\r\\n@media screen and (min-width: 1000px) and (max-width: 100vw) {\\r\\n  .lists {\\r\\n    width: 800px;\\r\\n    .essay {\\r\\n      width: 800px;\\r\\n      .Img {\\r\\n        width: 50% !important;\\r\\n        height: 100%;\\r\\n        background: url(/xia.jpg);\\r\\n        background-size: cover;\\r\\n        background-position: center center;\\r\\n      }\\r\\n      .content {\\r\\n        width: 50%;\\r\\n        flex-direction: column;\\r\\n        text-align: left;\\r\\n        margin-top: 40px;\\r\\n        margin-left: 20px;\\r\\n        .title {\\r\\n          font-size: 24px;\\r\\n        }\\r\\n        p {\\r\\n          margin-top: 10px;\\r\\n        }\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n}\\r\\n\\r\\n@media screen and (min-width: 500px) and (max-width: 1000px) {\\r\\n  .lists {\\r\\n    width: 75vw;\\r\\n    .essay {\\r\\n      width: 700px;\\r\\n\\r\\n      .Img {\\r\\n        width: 50% !important;\\r\\n        height: 100%;\\r\\n        background: url(/xia.jpg);\\r\\n        background-size: cover;\\r\\n        background-position: center center;\\r\\n      }\\r\\n      .content {\\r\\n        width: 50%;\\r\\n        display: flex;\\r\\n        flex-direction: column;\\r\\n        text-align: left;\\r\\n        margin-top: 40px;\\r\\n        margin-left: 20px;\\r\\n        .title {\\r\\n          font-size: 24px;\\r\\n        }\\r\\n        p {\\r\\n          margin-top: 10px;\\r\\n        }\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n}\\r\\n@media screen and (max-width: 500px) {\\r\\n  .lists {\\r\\n    width: 80vw;\\r\\n    font-size: 14px;\\r\\n    .essay {\\r\\n      display: flex;\\r\\n      flex-direction: column;\\r\\n      width: 80vw;\\r\\n\\r\\n      .Img {\\r\\n        width: 100% !important;\\r\\n        height: 50% !important;\\r\\n        background: url(/xia.jpg);\\r\\n        background-size: cover;\\r\\n        background-position: center center;\\r\\n      }\\r\\n      .content {\\r\\n        width: 100%;\\r\\n        display: flex;\\r\\n        flex-direction: column;\\r\\n        text-align: left;\\r\\n        padding-top: 10px;\\r\\n        margin-left: 20px;\\r\\n        .title {\\r\\n          font-size: 24px;\\r\\n        }\\r\\n        p {\\r\\n          margin-top: 10px;\\r\\n        }\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u6700\u540e\u8bb0\u5f97\u5728`pages/_app.tsx`\u91cc\u9762\u5f15\u5165`lists.scss`\u548c`bottom.scss`\\r\\n\\r\\n\u73b0\u5728\u6211\u4eec\u7684\u9875\u9762\u957f\u8fd9\u6837\\r\\n\\r\\n![image-20230216165349345](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216165349345.png)\\r\\n\\r\\n### \u4e2a\u4eba\u4fe1\u606f\u5c0f\u5361\u7247\u4ee5\u53ca\u6a31\u82b1\u98d8\u843d\\r\\n\\r\\n#### \u6a31\u82b1\u98d8\u843d\\r\\n\\r\\n\u6253\u5f00\u94fe\u63a5\u4e0b\u8f7d\u6e90\u7801[sakura.js](https://blog.chovrio.club/sakura.js)\u653e\u5728`public`\u6587\u4ef6\u5939\u4e2d\uff0c\u7136\u540e\u5728`pages/_app.tsx`\u4e2d\u5f15\u5165\u5373\u53ef\\r\\n\\r\\n```typescript\\r\\n// pages/_app.tsx\\r\\nimport \\"@/styles/globals.scss\\";\\r\\nimport \\"@/styles/Home.scss\\";\\r\\nimport \\"@/styles/lists.scss\\";\\r\\nimport \\"@/styles/bottom.scss\\";\\r\\nimport type { AppProps } from \\"next/app\\";\\r\\nimport Script from \\"next/script\\";\\r\\n\\r\\nexport default function App({ Component, pageProps }: AppProps) {\\r\\n  return (\\r\\n    <div>\\r\\n      <Script src=\\"/sakura.js\\" />\\r\\n      <Component {...pageProps} />\\r\\n    </div>\\r\\n  );\\r\\n}\\r\\n```\\r\\n\\r\\n#### \u4e2a\u4eba\u4fe1\u606f\u5c0f\u5361\u7247\\r\\n\\r\\n**\u6ce8\u610f\u8fd9\u91cc\u7684\u4e2a\u4eba\u5934\u50cf\u662f\u6211\u5b9e\u73b0\u5b58\u50a8\u5728\u6211\u7684\u670d\u52a1\u7aef\u4ee3\u7801\u7684**\\r\\n\\r\\n\u521b\u5efa`components/Profile/index.tsx`\\r\\n\\r\\n```typescript\\r\\nimport Image from \\"next/image\\";\\r\\nimport { FC, ReactElement } from \\"react\\";\\r\\nimport styles from \\"@/styles/profile.module.scss\\";\\r\\nexport interface IProps {\\r\\n  children?: ReactElement;\\r\\n}\\r\\nconst Profile: FC<IProps> = (props) => {\\r\\n  const { children } = props;\\r\\n  const local =\\r\\n    process.env.NODE_ENV === \\"development\\"\\r\\n      ? process.env.NEXT_PUBLIC_BASEURL_DEV\\r\\n      : process.env.NEXT_PUBLIC_BASEURL_PROD;\\r\\n  return (\\r\\n    <div className={styles.profile}>\\r\\n      <Image\\r\\n        src={`${local}/avactor/chovrio.jpg`}\\r\\n        alt=\\"avactor\\"\\r\\n        width={150}\\r\\n        height={150}\\r\\n      />\\r\\n      <h2 className={styles.name}>{process.env.NEXT_PUBLIC_NAME}</h2>\\r\\n      <p className={styles.content}>{process.env.NEXT_PUBLIC_CONTENT}</p>\\r\\n      <div className={styles.cates}>\\r\\n        <div>\\r\\n          <span>\u6587\u7ae0</span>\\r\\n          <span>2</span>\\r\\n        </div>\\r\\n        <div>\\r\\n          <span>\u6807\u7b7e</span>\\r\\n          <span>4</span>\\r\\n        </div>\\r\\n      </div>\\r\\n      <button className={styles.github}>\\r\\n        <a href={process.env.NEXT_PUBLIC_GITHUB}>\u8981\u770b\u770b\u83dc\u72d7\u5417?</a>\\r\\n      </button>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Profile;\\r\\nProfile.displayName = \\"Profile\\";\\r\\n```\\r\\n\\r\\n`styles/profile.module.scss`\\r\\n\\r\\n```scss\\r\\n.profile {\\r\\n  height: 350px;\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n  text-align: center;\\r\\n  overflow: hidden;\\r\\n  box-shadow: 0 3px 8px 6px rgba(7, 17, 27, 0.05);\\r\\n  border-radius: 20px;\\r\\n  img {\\r\\n    border-radius: 50%;\\r\\n    margin: 10px auto 5px auto;\\r\\n  }\\r\\n  .name {\\r\\n    font-size: 26px;\\r\\n    font-weight: 700;\\r\\n  }\\r\\n  .content {\\r\\n    font-size: 14px;\\r\\n  }\\r\\n  .cates {\\r\\n    margin-top: 10px;\\r\\n    display: flex;\\r\\n    justify-content: space-evenly;\\r\\n    div {\\r\\n      display: flex;\\r\\n      flex-direction: column;\\r\\n      cursor: pointer;\\r\\n      &:hover {\\r\\n        color: #4fb4f5;\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n  button {\\r\\n    width: 80%;\\r\\n    height: 35px;\\r\\n    margin: auto;\\r\\n    background-color: #49b1f5;\\r\\n    font-size: 14px;\\r\\n    border: none;\\r\\n    a {\\r\\n      color: #fff;\\r\\n    }\\r\\n  }\\r\\n}\\r\\n@media screen and (min-width: 1000px) and (max-width: 100vw) {\\r\\n  .profile {\\r\\n    top: 0;\\r\\n    width: 200px;\\r\\n    margin-top: 40px;\\r\\n  }\\r\\n}\\r\\n@media screen and (min-width: 550px) and (max-width: 1000px) {\\r\\n  .profile {\\r\\n    width: 80vw;\\r\\n  }\\r\\n}\\r\\n\\r\\n@media screen and (max-width: 550px) {\\r\\n  .profile {\\r\\n    width: 80vw;\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u4fee\u6539`next.config.js`\u7684\u4e00\u4e9b\u914d\u7f6e\\r\\n\\r\\n```js\\r\\n/** @type {import(\'next\').NextConfig} */\\r\\nconst nextConfig = {\\r\\n  reactStrictMode: true,\\r\\n  // \u5141\u8bb8<Image/> \u6807\u7b7e\u5c55\u793a\u54ea\u4e9b\u6765\u6e90\u7684\u56fe\u7247\\r\\n  images: {\\r\\n    remotePatterns: [\\r\\n      // http://localhost:8000/avactor/**\\r\\n      {\\r\\n        protocol: \\"http\\",\\r\\n        hostname: \\"localhost\\",\\r\\n        port: \\"8000\\",\\r\\n        pathname: \\"/avactor/**\\",\\r\\n      },\\r\\n      {\\r\\n        protocol: \\"https\\",\\r\\n        hostname: \\"blog-server.chovrio.club\\",\\r\\n        port: \\"\\",\\r\\n        pathname: \\"/avactor/**\\",\\r\\n      },\\r\\n    ],\\r\\n  },\\r\\n};\\r\\n\\r\\nmodule.exports = nextConfig;\\r\\n```\\r\\n\\r\\n\u76ee\u524d\u6548\u679c\\r\\n\\r\\n![image-20230216172325161](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216172325161.png)\\r\\n\\r\\n### \u6587\u6863\u8be6\u7ec6\u9875\u9762\\r\\n\\r\\n\u6211\u4eec\u73b0\u5728\u70b9\u51fb\u6587\u7ae0\u5217\u8868\u7684\u6587\u7ae0\u4f1a\u53d1\u73b0\u6ca1\u6709\u8fd9\u4e2a\u9875\u9762\\r\\n\\r\\n![image-20230216172637255](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216172637255.png)\\r\\n\\r\\n\u56e0\u4e3a`nextjs`\u5e95\u5c42\u5c01\u88c5\u7684\u5f88\u5b8c\u6574\uff0cpages \u4e0b\u9762\u7684\u76ee\u5f55\u5c31\u76f8\u5f53\u4e8e\u52a8\u6001\u8def\u7531\u7684\u8def\u5f84\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u65b0\u5efa\u6587\u4ef6`pages/posts/[id].tsx`\uff0c\u56e0\u4e3a\u8fd9\u91cc\u6211\u4eec\u8981\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93`react-markdown`\u6765\u6e32\u67d3`md`\u6587\u4ef6\u3002\u6240\u4ee5\u8fd9\u4e2a\u9875\u9762\u6211\u4eec\u91c7\u7528`CSR`\\r\\n\\r\\n\u6211\u4eec\u5148\u5b89\u88c5\u4f9d\u8d56\\r\\n\\r\\n```shell\\r\\npnpm add react-markdown remark-gfm rehype-raw react-syntax-highlighter\\r\\npnpm i --save-dev @types/react-syntax-highlighter -D\\r\\n```\\r\\n\\r\\n\u5728\u6211\u6d4b\u8bd5\u7684\u65f6\u5019\uff0c\u53d1\u73b0 react-markdown \u65e0\u6cd5\u6b63\u5e38\u6e32\u67d3\uff0c\u5e76\u4e14`react-syntax-highlighter`\u4ee3\u7801\u9ad8\u4eae\u7684\u5305\u7684\u5bfc\u51fa\u65b9\u5f0f\u597d\u50cf\u4e5f\u4e0d\u517c\u5bb9\uff0c\u6240\u4ee5\u88ab\u8feb\u65e0\u5948\uff0c\u6211\u4eec\u8fd8\u662f\u5f97\u4f7f\u7528`app`\u76ee\u5f55\uff0c\\r\\n\\r\\n![image-20230216211416866](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216211416866.png)\\r\\n\\r\\n\u4fee\u6539`next.config.js`\u7684\u914d\u7f6e\u5982\u4e0b\\r\\n\\r\\n```js\\r\\n/** @type {import(\'next\').NextConfig} */\\r\\nconst nextConfig = {\\r\\n  reactStrictMode: true,\\r\\n  experimental: {\\r\\n    // \u5f00\u542f\u5b9e\u9a8c\u6027\u7684app\u76ee\u5f55\\r\\n    appDir: true,\\r\\n  },\\r\\n  images: {\\r\\n    remotePatterns: [\\r\\n      {\\r\\n        protocol: \\"http\\",\\r\\n        hostname: \\"localhost\\",\\r\\n        port: \\"8000\\",\\r\\n        pathname: \\"/avactor/**\\",\\r\\n      },\\r\\n      {\\r\\n        protocol: \\"https\\",\\r\\n        hostname: \\"blog-server.chovrio.club\\",\\r\\n        port: \\"\\",\\r\\n        pathname: \\"/avactor/**\\",\\r\\n      },\\r\\n    ],\\r\\n  },\\r\\n  async rewrites() {\\r\\n    return [\\r\\n      //\u63a5\u53e3\u8bf7\u6c42 \u524d\u7f00\u5e26\u4e0a/api/\\r\\n      {\\r\\n        source: \\"/api/:path*\\",\\r\\n        destination: `http://127.0.0.1:8000/:path*`,\\r\\n      },\\r\\n    ];\\r\\n  },\\r\\n};\\r\\nmodule.exports = nextConfig;\\r\\n```\\r\\n\\r\\n\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5bf9\u8de8\u57df\u95ee\u9898\u4e00\u5e76\u505a\u4e86\u5904\u7406\uff0c\u56e0\u4e3a\u6587\u7ae0\u8be6\u7ec6\u9875\u9762\u662f`CSR`\u4f1a\u51fa\u73b0\u8de8\u57df\u95ee\u9898\u3002\\r\\n\\r\\n\u4fee\u6539`service/index`\\r\\n\\r\\n```typescript\\r\\n//service/index.ts\\r\\nimport axios from \\"axios\\";\\r\\nimport type { AxiosRequestConfig, AxiosInstance, AxiosResponse } from \\"axios\\";\\r\\nclass Request {\\r\\n  instance: AxiosInstance;\\r\\n  constructor(config: AxiosRequestConfig) {\\r\\n    this.instance = axios.create(config);\\r\\n  }\\r\\n  // \u516c\u5171\u7684\u8bf7\u6c42\u7684\u65b9\u6cd5\\r\\n  request<T = any>(config: AxiosRequestConfig): Promise<AxiosResponse<T>> {\\r\\n    return new Promise((resolve, reject) => {\\r\\n      // \u5f00\u59cb\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\\r\\n      this.instance\\r\\n        .request<T>(config)\\r\\n        .then((res) => {\\r\\n          resolve(res);\\r\\n        })\\r\\n        .catch((err) => {\\r\\n          reject(err);\\r\\n        });\\r\\n    });\\r\\n  }\\r\\n  get<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"get\\" });\\r\\n  }\\r\\n  post<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"post\\" });\\r\\n  }\\r\\n  delete<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"delete\\" });\\r\\n  }\\r\\n  put<T = any>(config: AxiosRequestConfig) {\\r\\n    return this.request<T>({ ...config, method: \\"put\\" });\\r\\n  }\\r\\n}\\r\\n\\r\\n// eslint-disable-next-line import/no-anonymous-default-export\\r\\nconst instance = new Request({\\r\\n  baseURL:\\r\\n    process.env.NODE_ENV === \\"development\\"\\r\\n      ? process.env.NEXT_PUBLIC_BASEURL_DEV\\r\\n      : process.env.NEXT_PUBLIC_BASEURL_PROD,\\r\\n  timeout: 10000,\\r\\n});\\r\\nconst origin = new Request({\\r\\n  baseURL:\\r\\n    process.env.NODE_ENV === \\"development\\"\\r\\n      ? process.env.NEXT_PUBLIC_BASEURL_DEV_ORIGIN\\r\\n      : process.env.NEXT_PUBLIC_BASEURL_PROD,\\r\\n  timeout: 10000,\\r\\n});\\r\\n\\r\\nexport { instance, origin };\\r\\n```\\r\\n\\r\\nservice/article.ts\\r\\n\\r\\n```typescript\\r\\n// service/article.ts\\r\\nimport { instance, origin } from \\".\\";\\r\\nimport type { IArticle, IResult } from \\"@/types/article\\";\\r\\n\\r\\nexport const getAllArticle = async () => {\\r\\n  const res = await instance.get<IResult<IArticle[]>>({\\r\\n    url: `/essay/acquire-fe?name=${process.env.NEXT_PUBLIC_NAME}`,\\r\\n  });\\r\\n  return res.data;\\r\\n};\\r\\nexport const getArticleContent = async (id: string) => {\\r\\n  console.log(id);\\r\\n  const res = await origin.get({\\r\\n    url: `/essay/content-fe?name=${process.env.NEXT_PUBLIC_NAME}&id=${id}`,\\r\\n  });\\r\\n  return res.data;\\r\\n};\\r\\n```\\r\\n\\r\\napp/posts/[id]/page.tsx\\r\\n\\r\\n```typescript\\r\\n\\"use client\\";\\r\\nimport Head from \\"next/head\\";\\r\\nimport { FC, ReactElement, useEffect, useState } from \\"react\\";\\r\\nimport ReactMarkdown from \\"react-markdown\\";\\r\\nimport remarkGfm from \\"remark-gfm\\";\\r\\nimport rehypeRaw from \\"rehype-raw\\"; // \u89e3\u6790\u6807\u7b7e\uff0c\u652f\u6301html\u8bed\u6cd5\\r\\nimport { Prism as SyntaxHighlighter } from \\"react-syntax-highlighter\\"; // \u4ee3\u7801\u9ad8\u4eae\\r\\nimport { tomorrow } from \\"react-syntax-highlighter/dist/esm/styles/prism\\";\\r\\nimport { getTime } from \\"@/utils/getTime\\";\\r\\nimport { usePathname } from \\"next/navigation\\";\\r\\nimport Profile from \\"@/components/Profile\\";\\r\\nimport { getArticleContent } from \\"@/service/article\\";\\r\\nimport \\"./index.scss\\";\\r\\nimport Script from \\"next/script\\";\\r\\nconst Article = () => {\\r\\n  const [markdown, setMarkdown] = useState<string>(\\"\\");\\r\\n  const [info, setInfo] = useState<any>({});\\r\\n  const [article, setArticle] = useState<string>(\\"\\");\\r\\n  const pathname = usePathname();\\r\\n  useEffect(() => {\\r\\n    let id = pathname?.split(\\"/\\")[2] || \\"\\";\\r\\n    setArticle(id);\\r\\n  }, [pathname]);\\r\\n  useEffect(() => {\\r\\n    if (article !== \\"\\") {\\r\\n      getArticleContent(article).then((data) => {\\r\\n        setMarkdown(data.result.content);\\r\\n        setInfo(data.result.info);\\r\\n      });\\r\\n    }\\r\\n  }, [article]);\\r\\n  return (\\r\\n    <div className=\\"article\\">\\r\\n      <Script src=\\"/sakura.js\\"><\/Script>\\r\\n      <Head>\\r\\n        <title>test</title>\\r\\n        <meta name=\\"keywords\\" content={`${info.name} ${info.author}`} />\\r\\n        <meta\\r\\n          name=\\"description\\"\\r\\n          content={`${markdown} ${process.env.NEXT_PUBLIC_NAME}\u7684\u535a\u5ba2`}\\r\\n        />\\r\\n      </Head>\\r\\n      <div className=\\"title\\">\\r\\n        <h2>{info.name}</h2>\\r\\n        <div className=\\"data\\">{getTime(info.updateTime)}</div>\\r\\n        <div>\u9605\u8bfb\u91cf:\u57cb\u70b9\u672a\u4f5c</div>\\r\\n      </div>\\r\\n      <div className=\\"test\\">\\r\\n        <article className=\\"content py-8 prose  prose-h1:mt-8\\">\\r\\n          <ReactMarkdown\\r\\n            remarkPlugins={[remarkGfm]}\\r\\n            rehypePlugins={[rehypeRaw]}\\r\\n            components={{\\r\\n              code({ inline, className, children, ...props }) {\\r\\n                const match = /language-(\\\\w+)/.exec(className || \\"\\");\\r\\n                return !inline && match ? (\\r\\n                  <SyntaxHighlighter\\r\\n                    // eslint-disable-next-line react/no-children-prop\\r\\n                    children={String(children).replace(/\\\\n$/, \\"\\")}\\r\\n                    style={tomorrow as any}\\r\\n                    language={match[1]}\\r\\n                    PreTag=\\"div\\"\\r\\n                    {...props}\\r\\n                  />\\r\\n                ) : (\\r\\n                  <code className={className} {...props}>\\r\\n                    {children}\\r\\n                  </code>\\r\\n                );\\r\\n              },\\r\\n            }}\\r\\n          >\\r\\n            {markdown}\\r\\n          </ReactMarkdown>\\r\\n        </article>\\r\\n        <Profile />\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\nexport default Article;\\r\\nArticle.displayName = \\"Article\\";\\r\\n```\\r\\n\\r\\napp/posts/[id]/index.scss\\r\\n\\r\\n\u56e0\u4e3a\u662f app \u76ee\u5f55\u4e0b\u7684\u65b0\u7684\u9875\u9762\u6240\u4ee5\u6eda\u8f6e\u6837\u5f0f\u5f97\u518d\u5199\u4e00\u904d\\r\\n\\r\\n```scss\\r\\n* {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  font-family: -apple-system, BlinkMacSystemFont, \\"Segoe UI\\", \\"Helvetica Neue\\",\\r\\n    Lato, Roboto, \\"PingFang SC\\", \\"Microsoft YaHei\\", sans-serif;\\r\\n}\\r\\nhtml {\\r\\n  overflow-x: hidden;\\r\\n  overflow-y: auto;\\r\\n}\\r\\n\\r\\n::-webkit-scrollbar {\\r\\n  width: 6px;\\r\\n  height: 6px;\\r\\n  overflow: auto;\\r\\n}\\r\\n::-webkit-scrollbar-thumb {\\r\\n  background-color: #e6e6e6;\\r\\n  min-height: 25px;\\r\\n  min-width: 25px;\\r\\n  border: 1px solid #e0e0e0;\\r\\n  border-radius: 99px;\\r\\n}\\r\\n::-webkit-scrollbar-track {\\r\\n  background-color: #f7f7f7;\\r\\n  border: 1px solid #efefef;\\r\\n}\\r\\n\\r\\n::-webkit-scrollbar-thumb {\\r\\n  background-color: #49b1f5;\\r\\n}\\r\\na {\\r\\n  text-decoration: none;\\r\\n  color: #000;\\r\\n}\\r\\n\\r\\n.article {\\r\\n  background-color: #ffffff;\\r\\n  .title {\\r\\n    width: 100%;\\r\\n    height: 30vh;\\r\\n    background-size: cover;\\r\\n    background-position: center center;\\r\\n    background-image: url(/xia.jpg);\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    align-items: center;\\r\\n    justify-content: center;\\r\\n    div {\\r\\n      padding-top: 10px;\\r\\n    }\\r\\n    color: #fff;\\r\\n  }\\r\\n\\r\\n  .content {\\r\\n    width: 800px;\\r\\n    position: relative;\\r\\n    min-height: 100%;\\r\\n    line-height: 2;\\r\\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\\r\\n    box-sizing: border-box;\\r\\n    margin: 40px 10px 0 100px;\\r\\n    padding: 40px 60px;\\r\\n    box-shadow: 0 3px 8px 6px rgba(7, 17, 27, 0.05);\\r\\n    border-radius: 8px;\\r\\n    background: #fff;\\r\\n    -webkit-box-shadow: 0 3px 8px 6px rgba(7, 17, 27, 0.05);\\r\\n    box-shadow: 0 3px 8px 6px rgba(7, 17, 27, 0.05);\\r\\n    border-radius: 20px;\\r\\n    -webkit-transition: all 0.3s;\\r\\n    -moz-transition: all 0.3s;\\r\\n    -o-transition: all 0.3s;\\r\\n    -ms-transition: all 0.3s;\\r\\n    transition: all 0.3s;\\r\\n  }\\r\\n  .test {\\r\\n    width: 100%;\\r\\n    display: flex;\\r\\n    justify-content: center;\\r\\n    &:last-child {\\r\\n      position: absolute;\\r\\n    }\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n\u6700\u540e\u9875\u9762\u5982\u4e0b\\r\\n\\r\\n![image-20230216213824273](https://aesthetic-stroopwafel-621be5.netlify.app/blog-fe/image-20230216213824273.png)\\r\\n\\r\\n[\u9879\u76ee\u6e90\u7801](https://github.com/chovrio/blog-fe)\\r\\n\\r\\n\u7167\u7740\u6587\u7ae0\u5199\uff0c\u5199\u51fa\u6765`pnpm dev`\u662f\u6b63\u5e38\u7684\uff0c\u4f46\u662f\u6253\u5305\u7684\u65f6\u5019\u4f1a\u62a5\u9519\uff0c\u6211\u6682\u65f6\u6ca1\u627e\u5230\u662f\u4ec0\u4e48\u95ee\u9898\uff0c\u6240\u4ee5\u6e90\u7801\u662f\u6211\u91cd\u65b0\u7528`app`\u76ee\u5f55\u5199\u7684\u6ca1\u6709\u4f7f\u7528`pages`\uff0c\u672c\u672b\u5012\u7f6e\u4e86(\u60b2\\r\\n\\r\\n\u6539\u7740\u6539\u7740\u53c8\u51fa\u73b0 bug \u4e86\uff0c\u5934\u50cf\u8bbf\u95ee\u4e0d\u5230\u4e86\u3002\u4e0d\u8fc7\u5927\u81f4\u5185\u5bb9\u5c31\u8fd9\u4e9b\u4e86\uff0c\u4e0b\u6b21\u4fee\u6539\u4f30\u8ba1\u5f97\u4e24\u5468\u540e\u4e86\u3002\u8981\u51c6\u5907\u5f00\u5b66\u8003\u8bd5\u4e86(\u7a81\u7136\u53d1\u73b0\u6ca1\u6539\u7684\u65f6\u5019\u662f\u8fd9\u4e2a\u9879\u76ee\u6700\u5b8c\u7f8e\u7684\u65f6\u5019.......\u8d8a\u6539 bug \u8d8a\u591a\u597d\u70e6)\u3002"}]}')}}]);